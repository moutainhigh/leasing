<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
"http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<mapper namespace="projectBudget">
	<select id="queryBudgetProjectList" parameterType="map"
		resultType="map">
		SELECT TT.*
		FROM (SELECT T.*, ROWNUM RN
		FROM (SELECT fps.id scheme_id,
		FPS.SCHEME_CODE,
		FPH.ID PROJECT_ID,
		FCC.NAME CUST_NAME,
		FPH.PRO_NAME,
		FPH.PRO_CODE,
		FPH.CLERK_NAME,
		YW.FLAG PLATFORM_NAME,
		HY.FLAG INDUSTRY_FICATION
		FROM FIL_PROJECT_SCHEME FPS,
		FIL_PROJECT_HEAD FPH,
		FIL_CUST_CLIENT FCC,
		(SELECT TS.CODE, TS.FLAG
		FROM T_SYS_DATA_DICTIONARY TS
		WHERE TS.TYPE = '业务类型') YW,
		(SELECT TS.CODE, TS.FLAG
		FROM T_SYS_DATA_DICTIONARY TS
		WHERE TS.TYPE = '行业类型') HY
		WHERE FPH.CLIENT_ID = FCC.ID
		AND FPS.PROJECT_ID = FPH.ID(+)
		AND FPH.PLATFORM_TYPE = YW.CODE
		AND FPH.INDUSTRY_FICATION = HY.CODE
		<if test="CUST_NAME!=null and CUST_NAME!=''"> AND FCC.NAME LIKE '%'||#{CUST_NAME}||'%'</if>
		<if test="PROJECT_NAME !=null and PROJECT_NAME!=''">AND FPH.PRO_NAME LIKE '%'||#{PROJECT_NAME}||'%'</if>
		<if test="SYS_ORGIDS_ !=null and SYS_ORGIDS_ !=''">AND FPH.ORD_ID IN ${SYS_ORGIDS_} </if>
		<if test="SYS_CLERK_ID_ !=null and SYS_CLERK_ID_ !=''">AND FPH.CLERK_ID = #{SYS_CLERK_ID_} </if>
		<if test="SYS_ORGIDS_ !=null and SYS_ORGIDS_ !=''">AND FPH.ORD_ID IN ${SYS_ORGIDS_} </if>
		<if test="SYS_CLERK_ID_ !=null and SYS_CLERK_ID_ !=''">AND FPH.CLERK_ID = #{SYS_CLERK_ID_} </if>
		ORDER BY PROJECT_ID DESC) T
		<if test="PAGE_END !=null and PAGE_END!=''">
			WHERE <![CDATA[ROWNUM<=#{PAGE_END}]]></if>
		) TT
		<if test="PAGE_BEGIN !=null and PAGE_BEGIN!=''"> WHERE TT.RN>=#{PAGE_BEGIN}</if>

	</select>

	<select id="queryBudgetProjectListCount" parameterType="map"
		resultType="int">
		SELECT COUNT(1)
		FROM FIL_PROJECT_SCHEME FPS,
		FIL_PROJECT_HEAD FPH,
		FIL_CUST_CLIENT FCC,
		(SELECT TS.CODE, TS.FLAG
		FROM T_SYS_DATA_DICTIONARY TS
		WHERE TS.TYPE = '业务类型') YW,
		(SELECT TS.CODE, TS.FLAG
		FROM T_SYS_DATA_DICTIONARY TS
		WHERE TS.TYPE = '行业类型') HY
		WHERE FPH.CLIENT_ID = FCC.ID
		AND FPS.PROJECT_ID = FPH.ID(+)
		AND FPH.PLATFORM_TYPE = YW.CODE
		AND FPH.INDUSTRY_FICATION = HY.CODE
		<if test="SYS_ORGIDS_ !=null and SYS_ORGIDS_ !=''">AND FPH.ORD_ID IN ${SYS_ORGIDS_} </if>
		<if test="SYS_CLERK_ID_ !=null and SYS_CLERK_ID_ !=''">AND FPH.CLERK_ID = #{SYS_CLERK_ID_} </if>
		<if test="CUST_NAME!=null and CUST_NAME!=''"> AND FCC.NAME LIKE '%'||#{CUST_NAME}||'%'</if>
		<if test="PROJECT_NAME !=null and PROJECT_NAME!=''">AND FPH.PRO_NAME LIKE '%'||#{PROJECT_NAME}||'%'</if>
		<if test="SYS_ORGIDS_ !=null and SYS_ORGIDS_ !=''">AND FPH.ORD_ID IN ${SYS_ORGIDS_} </if>
		<if test="SYS_CLERK_ID_ !=null and SYS_CLERK_ID_ !=''">AND FPH.CLERK_ID = #{SYS_CLERK_ID_} </if>
	</select>

	<select id="queryShowEstimates" parameterType="map" resultType="map">

		SELECT FPS.FINANCE_TOPRIC,
		FPS.LEASE_TOPRIC,
		FPS.SCHEME_CLOB,
		FPS.LEASE_TERM,
		FPS.LEASE_PERIOD,
		FPS.START_PERCENT,
		FPS.PAY_WAY,
		FPS.MANAGEMENT_FEETYPE,
		FPS.CALCULATE,
		FPS.POUNDAGE_WAY,
		FPS.YEAR_TYPE,
		FPS.YEAR_INTEREST,
		FPS.BAIL_PERCENT,
		FPS.POUNDAGE_RATE,
		FPS.DEAL_MODE,
		FPS.COMPANY_PERCENT,
		FPS.POUNDAGE_PRICE,
		FPS.INSURANCE_PERCENT,
		FPS.DISCOUNT_MONEY,
		FPS.DB_BAIL_PERCENT,
		FPS.INSURANCE_MONEY,
		TT.PRICE MONTH_PRICE,
		TT.RATE RATE_PRICE
		FROM FIL_PROJECT_SCHEME FPS,
		(SELECT T.PAY_ID,
		SUM(DECODE(T.ITEM_NAME, '租金', T.ITEM_MONEY)) PRICE,
		SUM(DECODE(T.ITEM_NAME, '利息', T.ITEM_MONEY)) RATE
		FROM FIL_RENT_PLAN_DETAIL_SCHEME T
		WHERE T.PAY_ID = #{PROJECT_SCHEME_ID}
		GROUP BY T.PAY_ID) TT
		WHERE FPS.PROJECT_ID = #{PROJECT_ID}
		AND TT.PAY_ID(+)=FPS.ID
		AND FPS.ID = #{PROJECT_SCHEME_ID}
	</select>
</mapper>