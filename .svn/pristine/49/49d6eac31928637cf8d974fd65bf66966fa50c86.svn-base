<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
"http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<mapper namespace="paymentApply">

	<select id="getPageList" parameterType="map" resultType="map">
	SELECT T2.* FROM ( SELECT T1.*,ROWNUM RN FROM (
	SELECT FBC.ID,
		   FPH.ID PROJECT_ID,
		   FFPD.PAYLIST_CODE,
		   CASE WHEN FFPD.LAST_MONEY=0 THEN
		   	FFPD.PAY_MONEY
		   	ELSE
		   	FFPD.LAST_MONEY
		   	END LAST_MONEY,
	       FPH.LEASE_CODE,
	       FBC.LESSOR_NAME,
	       FBC.LESSEE_NAME,
	       FBC.PRODUCT_CODE,
	       FFPD.PAY_NAME,
	       FBC.SELLER_BANK_ACCO,
	       FBC.SELLER_ACCOUNT,
	       FFPD.ID DETAIL_ID,
	       ROUND(NVL(FFPD.PAY_MONEY, 0), 2) PAY_MONEY,
	       TO_CHAR(FFPD.RESERVE_DATE, 'yyyy-MM-dd') RESERVE_DATE,
	       FFPD.PAYEE_NAME,
	       FFPD.PAY_BANK_ACCOUNT,
	       FPH.PRO_NAME,
	       FPH.PRO_CODE,
	       FCC.NAME,
	       FPE.PRODUCT_NAME,
	       FPE.CATENA_NAME,
	       FPE.SPEC_NAME,
	       FPE.CAR_SYMBOL
	  FROM FIL_BUY_CONTRACT       FBC,
	       FI_FUND_PAYMENT_DETAIL FFPD,
	       FIL_PROJECT_HEAD       FPH,
	       FIL_CUST_CLIENT        FCC,
	       (SELECT MIN(PRODUCT_NAME) PRODUCT_NAME,
			       MIN(CATENA_NAME) CATENA_NAME,
			       MIN(SPEC_NAME) SPEC_NAME,
			       MIN(CAR_SYMBOL) CAR_SYMBOL,
			       PAYLIST_CODE
			  FROM FIL_PROJECT_EQUIPMENT T
			 GROUP BY T.PAYLIST_CODE)  FPE
	 WHERE FBC.ID = FFPD.BUY_CONTRACT_ID
	   AND FPE.PAYLIST_CODE = FFPD.PAYLIST_CODE
	   AND FBC.PROJECT_ID = FPH.ID
	   AND FPH.CLIENT_ID = FCC.ID
	   AND FFPD.PAYMENT_HEAD_ID IS NULL
	   <if test="LEASE_CODE != null"> AND FPH.LEASE_CODE like '%${LEASE_CODE}%'</if>
	   <if test="NAME != null"> AND FCC.NAME like '%${NAME}%'</if>
	   <if test="SUPPID !=null and SUPPID !=''">AND FPH.BUSINESS_SOURCE=#{SUPPID}</if>
	   <if test="SYS_CLERK_ID_ !=null and SYS_CLERK_ID_ !=''">AND FPH.CLERK_ID IN ${SYS_CLERK_ID_} </if>
	   <if test="SYS_REGIONAL !=null and SYS_REGIONAL !=''">AND FPH.ORD_ID IN ${SYS_REGIONAL} </if>
	   <if test="SYS_PROVINCE !=null and SYS_PROVINCE !=''">AND FPH.ORD_ID IN ${SYS_PROVINCE} </if>
	   <if test="SYS_SUPPLIER !=null and SYS_SUPPLIER !=''">AND FPH.ORD_ID IN ${SYS_SUPPLIER} </if>
	   <if test="SYS_ORGIDS_ !=null and SYS_ORGIDS_ !=''">AND FPH.ORD_ID IN ${SYS_ORGIDS_} </if>
	 ORDER BY FFPD.ID DESC
	 ) T1 WHERE ROWNUM &lt;=#{PAGE_END} ) t2 WHERE t2.RN>=#{PAGE_BEGIN}
	</select>
	
	<select id="getPageCount" parameterType="map" resultType="int">
	SELECT COUNT(1)
	  FROM FIL_BUY_CONTRACT       FBC,
	       FI_FUND_PAYMENT_DETAIL FFPD,
	       FIL_PROJECT_HEAD       FPH,
	       FIL_CUST_CLIENT        FCC,
	       (SELECT MIN(PRODUCT_NAME) PRODUCT_NAME,
			       MIN(CATENA_NAME) CATENA_NAME,
			       MIN(SPEC_NAME) SPEC_NAME,
			       MIN(CAR_SYMBOL) CAR_SYMBOL,
			       PAYLIST_CODE
			  FROM FIL_PROJECT_EQUIPMENT T
			 GROUP BY T.PAYLIST_CODE)  FPE
	 WHERE FBC.ID = FFPD.BUY_CONTRACT_ID
	   AND FPE.PAYLIST_CODE = FFPD.PAYLIST_CODE
	   AND FBC.PROJECT_ID = FPH.ID
	   AND FPH.CLIENT_ID = FCC.ID
	   AND FFPD.PAYMENT_HEAD_ID IS NULL
	   <if test="LEASE_CODE != null"> AND FPH.LEASE_CODE like '%${LEASE_CODE}%'</if>
	   <if test="NAME != null"> AND FCC.NAME like '%${NAME}%'</if>
	   <if test="SUPPID !=null and SUPPID !=''">AND FPH.SUP_ID=#{SUPPID}</if>
	   <if test="SYS_CLERK_ID_ !=null and SYS_CLERK_ID_ !=''">AND FPH.CLERK_ID IN ${SYS_CLERK_ID_} </if>
	   <if test="SYS_REGIONAL !=null and SYS_REGIONAL !=''">AND FPH.ORD_ID IN ${SYS_REGIONAL} </if>
	   <if test="SYS_PROVINCE !=null and SYS_PROVINCE !=''">AND FPH.ORD_ID IN ${SYS_PROVINCE} </if>
	   <if test="SYS_SUPPLIER !=null and SYS_SUPPLIER !=''">AND FPH.ORD_ID IN ${SYS_SUPPLIER} </if>
	   <if test="SYS_ORGIDS_ !=null and SYS_ORGIDS_ !=''">AND FPH.ORD_ID IN ${SYS_ORGIDS_} </if>
	</select>
	<select id="getpayment" parameterType="map" resultType="map">
		SELECT FFPD.ID PAYMENT_ID,FFPD.PAYLIST_CODE,FFPH.JBPM_ID,FFPD.PROJECT_CODE PROCODE,FFPH.FUNDID FROM FI_FUND_PAYMENT_DETAIL FFPD,FI_FUND_PAYMENT_HEAD FFPH WHERE FFPD.PAYMENT_HEAD_ID=FFPH.ID AND PAYMENT_HEAD_ID =#{PAYMENT_JBPM_ID}  AND ROWNUM = 1
	</select>
	<select id="getProject" parameterType="map" resultType="map">
		SELECT FFPD.ID,
			   FFPD.PAYMENT_HEAD_ID,
			   FFPD.PAYMENT_TYPE,
			   FFPD.ISDEKOU,
			   FFPD.LAST_MONEY,
			   FFPD.DEKOU_SQ,
			   FFPD.PAYLIST_CODE,
			   FFPD.PAYMENT_TYPE,
			   FFPD.ISDEKOU,
			   FFPD.CS_PRICE,
			   FFPD.PAYMONEY_TYPE,
			   FFPD.PAY_BANK_NAME PAY_BANK_NAME_D,
			   FFPD.PAY_BANK_ADDRESS PAY_BANK_ADDRESS_D,
			   FFPD.PAY_BANK_ACCOUNT PAY_BANK_ACCOUNT_D,
		       FPH.ID PROJECT_ID,
		       FPH.PLATFORM_TYPE,
		       FCC.ID CLIENT_ID,
		       FRP.ID PAY_ID,
		       FRP.PAYLIST_CODE,
		       FPS.ID SCHEME_ID,
		       FPS.SCHEME_ROW_NUM,
		       FPS.MONTH_RENT,
		       FPS.FIRSTPAYALL,
		       FPS.LEASE_TOPRIC,--租赁物件总价值
		       FPS.FINANCE_TOPRIC,--融资额
			   FPS.START_PERCENT,--首期租金的百分比
			   FPS.POUNDAGE_PRICE,--手续费
			   FPS.PAY_WAY,--支付方式   数据字典还款政策
			   FPS.YEAR_INTEREST*100 YEAR_INTEREST,--年利率
			   FPS.LEASE_TERM,--租赁期数
			   FPS.LEASE_PERIOD,--租赁周期
			   FPS.FIRST_MONEY,--首期租金
			   ROUND(FPS.INTERNAL_RATE, 2)  INTERNAL_RATE,--内部收益率
			   VBS.SCHEME_NAME||VBS.ALIASES CPMC,
			   FFPD.PAY_MONEY,
			   FPH.PRO_NAME,
			   FPH.PLATFORM_TYPE,
			   FPH.LEASE_CODE,
			   FPH.PRO_CODE,
			   FPH.PARENT_ID,
			   FPH.PROVINCE_NAME,
			   FPE.PRODUCT_NAME,
			   FPE.SUPPLIERS_NAME,
			   FPE.SUPPLIERS_ID,
		       FCC.NAME,
		       FCC.TYPE,
		       FFPH.PAY_BANK_ACCOUNT,
		       FFPH.PAY_BANK_ADDRESS,
		       FFPH.PAY_BANK_NAME,
		       FFPH.PAYEE_NAME,
		       FFPH.PAY_BRANCH_NAME,
		       FFPH.CITY_NAME FFPHCITY_NAME,
		       FFPH.PROVINCE_NAME FFPHPROVINCE_NAME,
		       TSS.SUP_NAME,
       		   TSS.SUP_TYPE,
       		   TSS.LENDING_TYPE,
       		   TSS1.SUP_NAME HZSUP_NAME,
       		   TSS1.LENDING_TYPE LENDING_TYPE1,
		       TSS1.LOANS_OWN_ADDR,
		       TSS1.LOANS_OWN_BANK,
		       TSS1.LOANS_OWN_ACCOUNT,
		       CO.BANK_NAME COBANK_NAME,
		       CO.BANK_ACCOUNT COBANK_ACCOUNT,
		       CO.BANK_ADDRESS COBANK_ADDRESS,
		       CO.BRANCH BRANCH,
		       CO.PROVINCE_NAME PROVINCE_NAME,
		       CO.CITY_NAME CITY_NAME,
		       CASE
		         WHEN FCC.ID_CARD_NO IS NULL THEN
		          FCC.ORAGNIZATION_CODE
		         ELSE
		          FCC.ID_CARD_NO
		       END CODE
		  FROM FI_FUND_PAYMENT_DETAIL FFPD,
		       FI_FUND_PAYMENT_HEAD FFPH,
		       FIL_PROJECT_HEAD FPH,
		       FIL_PROJECT_SCHEME FPS,
		       FIL_CUST_CLIENT FCC,
		       FIL_RENT_PLAN_HEAD_BAS_MAX__V FRP,
		       (SELECT wm_concat(PRODUCT_NAME) PRODUCT_NAME,
		               PROJECT_ID,
		               SCHEME_ID_ACTUAL,
		               PAY_ID,
		               SUPPLIERS_NAME,
		               SUPPLIERS_ID
		          FROM FIL_PROJECT_EQUIPMENT 
		         GROUP BY PROJECT_ID, SUPPLIERS_NAME,SCHEME_ID_ACTUAL,PAY_ID,SUPPLIERS_ID) FPE,
		       T_SYS_SUPPLIERS TSS,
		       T_SYS_SUPPLIERS TSS1,
		       V_BASE_SCHEME VBS,
		       FIL_CUST_OPENINGBANK CO
		 WHERE FFPD.PAYMENT_HEAD_ID = FFPH.ID(+)
		   AND FFPD.PAYLIST_CODE = FRP.PAYLIST_CODE
		   AND FRP.PROJECT_ID = FPH.ID
		   AND FRP.ID=FPE.PAY_ID
		   AND FPE.SCHEME_ID_ACTUAL = FPS.ID
		   AND FPH.CLIENT_ID = FCC.ID
		   AND FPH.BUSINESS_SOURCE = TSS.SUP_ID(+)
		   AND FPS.COOPERATION_AGENCY = TSS1.SUP_ID(+)
		   AND FPH.ID = FPE.PROJECT_ID
		   AND FPH.BANK_ID = CO.ID(+)
		   AND FPS.SCHEME_CODE = VBS.SCHEME_CODE(+)
		   AND FFPD.ID=#{PAYMENT_ID}
	</select>
	<select id="getEq" parameterType="map" resultType="map">
		SELECT ID,
			   UNIT_PRICE,
		       AMOUNT,
		       PRODUCT_NAME,
		       CATENA_NAME,
		       SPEC_NAME,
		       COMPANY_NAME,
		       CAR_SYMBOL,
		       SUPPLIERS_NAME,
		       ACTUAL_PRICE,
		       CAR_COLOR,
		       XH_PARAM,
		       PRO_REMARK
		  FROM FIL_PROJECT_EQUIPMENT FPE
		  WHERE PAYLIST_CODE=#{PAYLIST_CODE}
	</select>
	<select id="ReceivablesBank" parameterType="map" resultType="map">
		SELECT SUP_ID,
		       SUP_TYPE,
		       ACCOUNT_TYPE,
		       UNIT,
		       ADDR,
		       BANK,
		       ACCOUNT,
		       BRANCH_BANK,
		       BRANCH_BANK_PROV_NAME,
		       BRANCH_BANK_CITY_NAME,
		       PARENT_ID
		  FROM (SELECT SUP_ID,
		               T.PARENT_ID,
		               '经销商' SUP_TYPE,
		               '自有账户' ACCOUNT_TYPE,
		               LOANS_OWN_UNIT UNIT,
		               LOANS_OWN_ADDR ADDR,
		               LOANS_OWN_BANK BANK,
		               LOANS_OWN_ACCOUNT ACCOUNT,
		               BRANCH_BANK,
		               A1.NAME BRANCH_BANK_PROV_NAME,
		               A2.NAME BRANCH_BANK_CITY_NAME
		          FROM T_SYS_SUPPLIERS T,T_SYS_AREA A1,T_SYS_AREA A2
		         WHERE T.BRANCH_BANK_PROV=A1.ID AND T.BRANCH_BANK_CITY=A2.ID AND SUP_ID IN
		               (SELECT SUPPLIERS_ID
		                  FROM FIL_PROJECT_EQUIPMENT
		                 WHERE PAYLIST_CODE = #{PAYLIST_CODE}))
		        <!-- UNION ALL
		        SELECT SUP_ID,
		               PARENT_ID,
		               'SP' SUP_TYPE,
		               '自有账户' ACCOUNT_TYPE,
		               LOANS_OWN_UNIT UNIT,
		               LOANS_OWN_ADDR ADDR,
		               LOANS_OWN_BANK BANK,
		               LOANS_OWN_ACCOUNT ACCOUNT
		          FROM T_SYS_SUPPLIERS
		         WHERE SUP_ID IN
		               (SELECT FPH.BUSINESS_SOURCE
		                  FROM FIL_PROJECT_HEAD FPH, FIL_PROJECT_EQUIPMENT FPE
		                 WHERE FPE.PROJECT_ID = FPH.ID
		                   AND FPE.PAYLIST_CODE = #{PAYLIST_CODE}) AND SUP_TYPE=2) -->
	</select>
	<select id="ReceivablesBank1" parameterType="map" resultType="map">
		SELECT FCO.ID SUP_ID,
		       '回租' SUP_TYPE,
		       '承租人账号' ACCOUNT_TYPE,
		       FCO.BANK_NAME BANK ,
		       FCO.BANK_ACCOUNT ACCOUNT,
		       FCO.BANK_ADDRESS ADDR,
		       FCO.BANK_CUSTNAME UNIT
		  FROM FIL_PROJECT_HEAD              FPH,
		       FIL_CUST_OPENINGBANK          FCO,
		       FIL_RENT_PLAN_HEAD_BAS_MAX__V FRPH
		 WHERE FRPH.PROJECT_ID = FPH.ID
		   AND FPH.BANK_ID = FCO.ID
		   AND FRPH.PAYLIST_CODE = #{PAYLIST_CODE}
	</select>
	<update id="UpdPayment" parameterType="map" >
		UPDATE FI_FUND_PAYMENT_DETAIL SET ID = #{ID} WHERE ID=#{ID}
	</update>
	<select id="getffph" parameterType="String" resultType="map">
		SELECT ID, BANKBILL_PRICE, ACCBILL_PRICE, SUPPER_ID
		  FROM FI_FUND_PAYMENT_HEAD
		 WHERE ID = #{PAYMENT_HEAD_ID}
	</select>
	<select id="PaymentBank" resultType="map">
		SELECT FMBI.FA_BINK, FMBI.FA_ACCOUNT, FMBI.FA_BANK_ADDRESS
		  FROM FHFA_MANAGER FM, FHFA_MANAGER_BANK_INFO FMBI
		 WHERE FM.STATUS = 0
		   AND FM.ID = FMBI.MANAGER_ID
		   AND (FMBI.FA_BANK_TYPE = 1 OR FMBI.FA_BANK_TYPE IS NULL)
	</select>
	<update id="updBank" parameterType="map">
		UPDATE FI_FUND_PAYMENT_DETAIL
		   SET 
		   	   <if test="LAST_MONEY !=null and LAST_MONEY !=''">LAST_MONEY        = #{LAST_MONEY},</if>
		       <if test="DEKOU_SQ !=null and DEKOU_SQ !=''">DEKOU_SQ          = #{DEKOU_SQ},</if>
		       <if test="ISDEKOU !=null and ISDEKOU !=''">ISDEKOU           = #{ISDEKOU},</if>
		       <if test="PAYMENT_TYPE !=null and PAYMENT_TYPE !=''">PAYMENT_TYPE      = #{PAYMENT_TYPE},</if>
		       <if test="FA_BINK !=null and FA_BINK !=''">REALITY_BANK_NAME = #{FA_BINK},</if>
		       <if test="FA_ACCOUNT !=null and FA_ACCOUNT !=''">PAY_BANK_ACCOUNT  = #{FA_ACCOUNT},</if>
		       <if test="FA_BANK_ADDRESS !=null and FA_BANK_ADDRESS !=''">PAY_BANK_ADDRESS  = #{FA_BANK_ADDRESS},</if>
		       <if test="FA_BINK !=null and FA_BINK !=''">PAY_BANK_NAME     = #{FA_BINK},</if>
		       <if test="CS_PRICE !=null and CS_PRICE !=''">CS_PRICE     = #{CS_PRICE},</if>
		       --付款金额方式
		       <if test="PAYMONEY_TYPE !=null and PAYMONEY_TYPE !=''">PAYMONEY_TYPE     = #{PAYMONEY_TYPE},</if>
		       ID				 = #{PAYMENT_ID}
		 WHERE ID = #{PAYMENT_ID}
	</update>
	<update id="updBank1" parameterType="map">
		UPDATE FI_FUND_PAYMENT_HEAD
		   SET REALITY_BANK_NAME = #{REALITY_BANK_NAME},
		       PAY_BANK_NAME     = #{BANK},
		       PAY_BRANCH_NAME  = #{PAY_BRANCH_NAME},
		       PROVINCE_NAME  = #{PROVINCE_NAME},
		       CITY_NAME  = #{CITY_NAME},
		       PAY_BANK_ACCOUNT  = #{ACCOUNT},
		       PAYEE_NAME		 = #{UNIT},
		       SUPPER_ID		 = #{SUP_ID},
		       LAST_MONEY		 = #{MONEY},
		       <if test="APPLY_MONEY_SUM !=null and APPLY_MONEY_SUM !=''">APPLY_MONEY_SUM     = #{APPLY_MONEY_SUM},</if>
		       APPLY_DATE     	 = sysdate,
		       FIRST_PAYALL		 = #{FIRST_PAYALL},
		       APPLY_MONEY		 = #{APPLY_MONEY}
		 WHERE ID = (SELECT PAYMENT_HEAD_ID
		               FROM FI_FUND_PAYMENT_DETAIL
		              WHERE ID = #{PAYMENT_ID})
	</update>
	<update id="jbpmByPayMentPassStatue" parameterType="string">
		UPDATE FI_FUND_PAYMENT_HEAD SET STATUS=4,BEGGIN_DATE=sysdate
		 WHERE ID=#{PAYMENT_JBPM_ID}
	</update>
	<insert id="insRebate" parameterType="string">
		INSERT INTO FIL_PROJECT_REBATE(ID,
				PLATFORM_TYPE,
				SCHEME_NAME,
				ALIASES,
				PAYLIST_CODE,
				PRO_CODE,
				NAME,
				YEAR_INTEREST,
				SUP_NAME,
				CXCX,
				LEASE_TOPRIC,
				FINANCE_TOPRIC,
				LEASE_TERM,
				BEGGIN_DATE,
				CR,
				FEQNUM)(
		SELECT SEQ_FIL_PROJECT_REBATE.NEXTVAL,
		       FPH.PLATFORM_TYPE,
		       TBS.SCHEME_NAME,
		       TBS.ALIASES,
		       FRPH.PAYLIST_CODE,
		       FPH.PRO_CODE,
		       FCC.NAME,
		       FPS.YEAR_INTEREST,
		       TSS.SUP_NAME,
		       FPE.CATENA_NAME || FPE.SPEC_NAME CXCX,
		       FPH.LEASE_TOPRIC,
		       FPH.FINANCE_TOPRIC,
		       FPH.LEASE_TERM,
		       FFPH.BEGGIN_DATE,
		       FPH.FINANCE_TOPRIC+FPS.FIRSTPAYALL-FPH.LEASE_TOPRIC CR,
		       FPE.NUM
		  FROM FIL_PROJECT_HEAD FPH,
		       FIL_CUST_CLIENT FCC,
		       FIL_PROJECT_SCHEME FPS,
		       (SELECT SCHEME_NAME, ALIASES, SCHEME_CODE
		          FROM T_BASE_SCHEME
		         GROUP BY SCHEME_NAME, ALIASES, SCHEME_CODE) TBS,
		       FIL_RENT_PLAN_HEAD_BAS_MAX__V FRPH,
		       (SELECT PROJECT_ID,
		               SUPPLIERS_ID,
		               CATENA_NAME,
		               SPEC_NAME,
		               COUNT(*) NUM
		          FROM FIL_PROJECT_EQUIPMENT
		         GROUP BY PROJECT_ID, SUPPLIERS_ID, CATENA_NAME, SPEC_NAME) FPE,
		         FI_FUND_PAYMENT_DETAIL FFPD,
		         FI_FUND_PAYMENT_HEAD FFPH,
		       T_SYS_SUPPLIERS TSS
		 WHERE FPH.ID = FPS.PROJECT_ID(+)
		   AND FPS.SCHEME_CODE = TBS.SCHEME_CODE(+)
		   AND FPH.ID = FRPH.PROJECT_ID(+)
		   AND FPH.CLIENT_ID = FCC.ID(+)
		   AND FPH.ID = FPE.PROJECT_ID(+)
		   AND FPE.SUPPLIERS_ID = TSS.SUP_ID(+)
		   AND FPH.PRO_CODE=FFPD.PROJECT_CODE(+)
		   AND FFPD.PAYMENT_HEAD_ID=FFPH.ID(+)
		   AND FFPH.ID=#{PAYMENT_JBPM_ID}
		)
	</insert>
	<insert id="insServiceFee" parameterType="map">
		insert into fil_project_service_fee(ID,PAYLIST_CODE,PRO_CODE,
			NAME,SUP_NAME,CXCX,LEASE_TOPRIC,FINANCE_TOPRIC,
			SERVICE_FEE_AMOUNT,PAYEE,BANK,BANK_ACCOUNT,STATUS,
			TOTAL_MONTH_PRICE,TYPE)(
		SELECT SEQ_FIL_PROJECT_REBATE.NEXTVAL,
           FRPH.PAYLIST_CODE,
           FPH.PRO_CODE,
           FCC.NAME,
           TSS.SUP_NAME,
           FPE.CATENA_NAME || FPE.SPEC_NAME CXCX,
           FPH.LEASE_TOPRIC,
           FPH.FINANCE_TOPRIC,
           FPS.TOTAL_MONTH_PRICE-FPH.FINANCE_TOPRIC,
           #{PAYEE},
           #{BANK},
           #{BANK_ACCOUNT},
           ${STATUS},
           FPS.TOTAL_MONTH_PRICE,
           ${TYPE}
		  FROM FIL_PROJECT_HEAD FPH,
		       FIL_CUST_CLIENT FCC,
		       FIL_PROJECT_SCHEME FPS,
		       FIL_RENT_PLAN_HEAD_BAS_MAX__V FRPH,
		       (SELECT PROJECT_ID,
		               SUPPLIERS_ID,
		               CATENA_NAME,
		               SPEC_NAME,
		               COUNT(*) NUM
		          FROM FIL_PROJECT_EQUIPMENT
		         GROUP BY PROJECT_ID, SUPPLIERS_ID, CATENA_NAME, SPEC_NAME) FPE,
		         FI_FUND_PAYMENT_DETAIL FFPD,
		         FI_FUND_PAYMENT_HEAD FFPH,
		       T_SYS_SUPPLIERS TSS
		 WHERE FPH.ID = FPS.PROJECT_ID(+)
		   AND FPH.ID = FRPH.PROJECT_ID(+)
		   AND FPH.CLIENT_ID = FCC.ID(+)
		   AND FPH.ID = FPE.PROJECT_ID(+)
		   AND FPE.SUPPLIERS_ID = TSS.SUP_ID(+)
		   AND FPH.PRO_CODE=FFPD.PROJECT_CODE(+)
		   AND FFPD.PAYMENT_HEAD_ID=FFPH.ID(+)
		   AND FFPH.ID=#{PAYMENT_JBPM_ID}
	)
	</insert>
	<select id="getJbpm_ID" parameterType="map" resultType="map">
		SELECT T.DBID_ EXECUTION_
	     FROM JBPM4_EXECUTION T
	    WHERE T.ID_ = #{JBPM_ID}
	</select>
	<select id="getSupFkfs" parameterType="map" resultType="map">
		SELECT TSD.FLAG STRING_VALUE_
		  FROM FI_FUND_PAYMENT_DETAIL T
		  LEFT JOIN T_SYS_DATA_DICTIONARY TSD
		    ON TSD.CODE = T.PAYMENT_TYPE
		   AND TSD.TYPE = '经销商放款方式'
		 WHERE T.ID = #{PAYMENT_ID}
	</select>
	<select id="getDkje" parameterType="map" resultType="map">
		SELECT SCHEME_CLOB,POUNDAGE_PRICE,MANAGEMENT_FEETYPE FROM FIL_PROJECT_SCHEME WHERE PROJECT_ID=#{PROJECT_ID} <if test="SCHEME_ID !=null and SCHEME_ID !=''">AND ID=#{SCHEME_ID}</if>
	</select>
	<select id="exportExcel" resultType="map">
		select 
			   1 SHENHE,
			   2 ZDLX,
		       FCC.NAME,
		       0 YLBZ,
		       FFPD.REALITY_BANK_NAME,
		       FFPD.PAY_MONEY,
		       FFPD.PAY_BANK_ACCOUNT,
		       TSS.SUP_NAME,
		       0 ZHLX,
		       '' ZKHH,
		       '' ZFKZH,
		       '' ZFKZHM,
		       '' ZFKKHH,
		       '' YT,
		       6 HL,
		       0 ISTZ,
		       '' PHONE,
		       '' EMAIL,
		       TSS.LOANS_OWN_PAY ZFHHZFHM
  		from 
		  	   fi_fund_payment_head   FFPH,
		       FI_FUND_PAYMENT_DETAIL FFPD,
		       FIL_PROJECT_HEAD       FPH,
		       FIL_CUST_CLIENT        FCC,
		       T_SYS_SUPPLIERS        TSS
 		WHERE 
 			   FFPH.ID = FFPD.PAYMENT_HEAD_ID
			   AND FFPD.PROJECT_CODE = FPH.PRO_CODE
			   AND FPH.CLIENT_ID = FCC.ID
			   AND FFPH.SUPPER_ID = TSS.SUP_ID
			   AND FFPH.BANKLEND_STATE=0
			   AND FFPH.STATUS=4
	</select>
	<select id="exportExcelcount" resultType="map">
		SELECT COUNT(*) ZBS , NVL(SUM(PAY_MONEY),0) ZJE
		  FROM fi_fund_payment_head FFPH, FI_FUND_PAYMENT_DETAIL FFPD
		 WHERE FFPH.ID = FFPD.PAYMENT_HEAD_ID
		 AND FFPH.BANKLEND_STATE = 0
		   AND FFPH.STATUS = 4
	</select>
	<select id="getFkhdList" parameterType="map" resultType="map">
		SELECT FPH.PRO_NAME,
		       FPH.LEASE_CODE,
		       TSS.SUP_NAME,
		       FCC.NAME,
		       TSS.SUP_NAME,
		       FFPH.JBPM_ID,
		       jt.name_,
		       T.TPM_TYPE
		  FROM FI_FUND_PAYMENT_DETAIL FFPD,
		       JBPM4_TASK             JT,
		       FI_FUND_PAYMENT_HEAD   FFPH,
		       FIL_PROJECT_HEAD FPH,
		       FIL_CUST_CLIENT FCC,
		       T_SYS_SUPPLIERS TSS,
		       (SELECT FPF.FK_ID, WM_CONCAT(FPF.TPM_TYPE) TPM_TYPE
		          FROM FIL_PROJECT_FILE FPF
		         WHERE FPF.TPM_BUSINESS_PLATE = '放款后'
		           AND PARENT_ID IS NULL
		           AND FK_ID IS NOT NULL
		           AND ID NOT IN (SELECT PARENT_ID
		                            FROM FIL_PROJECT_FILE
		                           WHERE TPM_BUSINESS_PLATE = '放款后'
		                             AND PARENT_ID IS NOT NULL)
		         GROUP BY FPF.FK_ID) T
		 WHERE FFPD.PAYMENT_HEAD_ID = FFPH.ID
		   AND FFPD.ID=T.FK_ID
		   AND JT.EXECUTION_ID_ || '.' LIKE FFPH.JBPM_ID || '.%'
		   AND FFPD.PROJECT_CODE = FPH.PRO_CODE
		   AND FPH.CLIENT_ID = FCC.ID
		   AND FFPH.SUPPER_ID = TSS.SUP_ID
		   AND JT.NAME_ = '补充资料'
		   AND FFPH.BANKLEND_STATE = 0
		   <if test="LEASE_CODE != null and LEASE_CODE !=''"> AND FPH.LEASE_CODE like '%${LEASE_CODE}%'</if>
	   	   <if test="NAME != null and NAME !=''"> AND FCC.NAME like '%${NAME}%'</if>
	   	   <if test="SUPPID !=null and SUPPID !=''">AND FPH.BUSINESS_SOURCE=#{SUPPID}</if>
	       <if test="SYS_CLERK_ID_ !=null and SYS_CLERK_ID_ !=''">AND FPH.CLERK_ID IN ${SYS_CLERK_ID_} </if>
	       <if test="SYS_REGIONAL !=null and SYS_REGIONAL !=''">AND FPH.ORD_ID IN ${SYS_REGIONAL} </if>
	       <if test="SYS_PROVINCE !=null and SYS_PROVINCE !=''">AND FPH.ORD_ID IN ${SYS_PROVINCE} </if>
	       <if test="SYS_SUPPLIER !=null and SYS_SUPPLIER !=''">AND FPH.ORD_ID IN ${SYS_SUPPLIER} </if>
	       <if test="SYS_ORGIDS_ !=null and SYS_ORGIDS_ !=''">AND FPH.ORD_ID IN ${SYS_ORGIDS_} </if>
	</select>
	<select id="getFkhdCount" parameterType="map" resultType="int">
		SELECT COUNT(1)
		  FROM FI_FUND_PAYMENT_DETAIL FFPD,
		       JBPM4_TASK             JT,
		       FI_FUND_PAYMENT_HEAD   FFPH,
		       FIL_PROJECT_HEAD FPH,
		       FIL_CUST_CLIENT FCC,
		       T_SYS_SUPPLIERS TSS,
		       (SELECT FPF.FK_ID, WM_CONCAT(FPF.TPM_TYPE) TPM_TYPE
		          FROM FIL_PROJECT_FILE FPF
		         WHERE FPF.TPM_BUSINESS_PLATE = '放款后'
		           AND PARENT_ID IS NULL
		           AND FK_ID IS NOT NULL
		           AND ID NOT IN (SELECT PARENT_ID
		                            FROM FIL_PROJECT_FILE
		                           WHERE TPM_BUSINESS_PLATE = '放款后'
		                             AND PARENT_ID IS NOT NULL)
		         GROUP BY FPF.FK_ID) T
		 WHERE FFPD.PAYMENT_HEAD_ID = FFPH.ID
		   AND FFPD.ID=T.FK_ID
		   AND JT.EXECUTION_ID_ || '.' LIKE FFPH.JBPM_ID || '.%'
		   AND FFPD.PROJECT_CODE = FPH.PRO_CODE
		   AND FPH.CLIENT_ID = FCC.ID
		   AND FFPH.SUPPER_ID = TSS.SUP_ID
		   AND JT.NAME_ = '补充资料'
		   AND FFPH.BANKLEND_STATE = 0
		   <if test="LEASE_CODE != null and LEASE_CODE !=''"> AND FPH.LEASE_CODE like '%${LEASE_CODE}%'</if>
	   	   <if test="NAME != null and NAME !=''"> AND FCC.NAME like '%${NAME}%'</if>
	   	   <if test="SUPPID !=null and SUPPID !=''">AND FPH.BUSINESS_SOURCE=#{SUPPID}</if>
	       <if test="SYS_CLERK_ID_ !=null and SYS_CLERK_ID_ !=''">AND FPH.CLERK_ID IN ${SYS_CLERK_ID_} </if>
	       <if test="SYS_REGIONAL !=null and SYS_REGIONAL !=''">AND FPH.ORD_ID IN ${SYS_REGIONAL} </if>
	       <if test="SYS_PROVINCE !=null and SYS_PROVINCE !=''">AND FPH.ORD_ID IN ${SYS_PROVINCE} </if>
	       <if test="SYS_SUPPLIER !=null and SYS_SUPPLIER !=''">AND FPH.ORD_ID IN ${SYS_SUPPLIER} </if>
	       <if test="SYS_ORGIDS_ !=null and SYS_ORGIDS_ !=''">AND FPH.ORD_ID IN ${SYS_ORGIDS_} </if>
	</select>
	<select id="getFund" parameterType="map" resultType="map">
		SELECT FCC.ID            FUND_CLIENT_ID,
		       FCC.NAME          FUND_COMENAME,
		       FCO.BANK_ACCOUNT  FUND_COMECODE,
		       FCO.BANK_CUSTNAME BANK_CUSTNAME,
		       FCO.BANK_NAME     BANK_NAME,
		       '00'              ACCOUNT_TYPE,
		       '0'               ACCOUNT_PROP,
		       'CNY'             CURRENCY,
		       FRPH.PAYLIST_CODE,
		       FRR.MONEY         FUND_RECEIVE_MONEY,
		       FFPD.ID			 FFPDID,
		       FRPH.LEASE_TERM	 LEASE_TERM,
		       FM.FA_ACCOUNT     FUND_ACCEPT_CODE
		  FROM FI_FUND_PAYMENT_DETAIL FFPD,
		       FIL_PROJECT_HEAD FPH,
		       FIL_CUST_CLIENT FCC,
		       FIL_CUST_OPENINGBANK FCO,
		       FIL_RENT_PLAN_HEAD_BAS_MAX__V FRPH,
		       (SELECT SUM(BEGINNING_MONEY) MONEY, PAYLIST_CODE
		          FROM FI_R_BEGINNING
		         WHERE ITEM_FLAG = 1
		         GROUP BY PAYLIST_CODE) FRR,
		       (SELECT *
		          FROM (SELECT FM.FA_ACCOUNT
		                  FROM FHFA_MANAGER_BANK_INFO FM, FHFA_MANAGER F
		                 WHERE F.ID = FM.MANAGER_ID
		                   AND F.ORGANIZATION_ID = (select ORGANIZATION_ID ID from FHFA_MANAGER FM where FM.ID=#{ORGANIZATION_ID})
		                 ORDER BY FLAG DESC)
		         WHERE ROWNUM = 1) FM
		 WHERE FFPD.PAYLIST_CODE = FRPH.PAYLIST_CODE
		   AND FRPH.PROJECT_ID=FPH.ID
		   AND FPH.CLIENT_ID = FCC.ID
		   AND FPH.BANK_ID = FCO.ID
		   AND FRPH.PAYLIST_CODE = FRR.PAYLIST_CODE
		   AND FFPD.ID = #{PAYMENT_ID}
	</select>
	<insert id="insFund" parameterType="map">
		INSERT INTO FI_FUND
		  (
		   FUND_FUNDCODE,
		   FUND_COMECODE,
		   FUND_COMENAME,
		   FUND_ACCEPT_CODE,
		   FUND_ACCEPT_NAME,
		   FUND_ACCEPT_DATE,
		   FUND_RECEIVE_MONEY,
		   <if test="FUND_SY_MONEY !=null and FUND_SY_MONEY !=''">FUND_SY_MONEY,</if>
		   FUND_IMPORT_PERSON,
		   FUND_IMPORT_PERSON_ID,
		   FUND_NOTDECO_STATE,
		   FUND_STATUS,
		   FUND_ISCONGEAL,
		   FUND_RED_STATUS,
		   FUND_PRANT_ID,
		   FUND_TYPE,
		   FUND_IMPORT_DATE,
		   FUND_CLIENT_ID,
		   FUND_CLIENT_NAME,
		   FUND_PIDENTIFY_PERSON,
		   FUND_PIDENTIFY_PERSON_ID,
		   FUND_ID,
		   FUND_DOCKET)
		VALUES
		  (
		   #{FUND_FUNDCODE},
		   #{FUND_COMECODE},
		   #{FUND_COMENAME},
		   #{FUND_ACCEPT_CODE},
		   #{COMPANY},
		   TO_DATE(#{FUND_ACCEPT_DATE},'YYYY-MM-DD'),
		   #{FUND_RECEIVE_MONEY},
		   <if test="FUND_SY_MONEY !=null and FUND_SY_MONEY !=''">#{FUND_SY_MONEY},</if>
		   #{FUND_IMPORT_PERSON},
		   #{FUND_IMPORT_PERSON_ID},
		   '0',
		   '0',
		   '0',
		   '0',
		   '0',
		   '1',
		   SYSDATE,
		   #{FUND_CLIENT_ID},
		   #{FUND_COMENAME},
		   #{FUND_IMPORT_PERSON},
		   #{FUND_IMPORT_PERSON_ID},
		   #{FUND_ID},
		   #{FUND_DOCKET})
	</insert>
	<update id="updSqkDate" parameterType="map">
		UPDATE FI_R_BEGINNING SET BEGINNING_RECEIVE_DATA=TO_DATE(#{FUND_ACCEPT_DATE},'YYYY-MM-DD')
		WHERE PAYLIST_CODE=#{PAYLIST_CODE} 
		<choose>
			<when test="YSZJQC !=null and YSZJQC !=''">AND (ITEM_FLAG=1 OR (BEGINNING_NUM &lt;= #{YSZJQC} AND ITEM_FLAG = 2))</when>
			<otherwise>AND ITEM_FLAG=1</otherwise>
		</choose>
	</update>
	<update id="updSqkDate1" parameterType="map">
		UPDATE FIL_RENT_PLAN_HEAD SET FIRSTPAYDATE=TO_DATE(#{FUND_ACCEPT_DATE},'YYYY-MM-DD')
		WHERE PAYLIST_CODE=#{PAYLIST_CODE} 
	</update>
	<update id="updSqkDate2" parameterType="map">
		UPDATE FIL_RENT_PLAN_DETAIL SET PAY_DATE=TO_DATE(#{FUND_ACCEPT_DATE},'YYYY-MM-DD')
		WHERE PAY_ID=(SELECT ID FROM FIL_RENT_PLAN_HEAD_MAX_V WHERE PAYLIST_CODE=#{PAYLIST_CODE})
		<choose>
			<when test="YSZJQC !=null and YSZJQC !=''">AND (ITEM_FLAG=1 OR (PERIOD_NUM &lt;= #{YSZJQC} AND ITEM_FLAG = 2))</when>
			<otherwise>AND ITEM_FLAG=1</otherwise>
		</choose>
	</update>
	<select id="getSqk" parameterType="map" resultType="map">
		SELECT round(NVL(SUM(BEGINNING_MONEY) - SUM(BEGINNING_PAID), 0), 2) MONEY,COUNT(*) TOTAL_ITEM
		  FROM FI_R_BEGINNING
		 WHERE PAYLIST_CODE = #{PAYLIST_CODE}
		   AND ITEM_FLAG = 1
	</select>
	<select id="getSqkZj" parameterType="map" resultType="map">
		SELECT round(NVL(SUM(BEGINNING_MONEY) - SUM(BEGINNING_PAID), 0), 2) MONEY,COUNT(*) TOTAL_ITEM
		  FROM FI_R_BEGINNING
		 WHERE PAYLIST_CODE = #{PAYLIST_CODE}
		   AND BEGINNING_NUM &lt;=#{QC} AND BEGINNING_NUM IS NOT NULL
	</select>
	<select id="getYs" parameterType="map" resultType="map">
		SELECT round(NVL(SUM(BEGINNING_MONEY) - SUM(BEGINNING_PAID), 0), 2) MONEY,COUNT(*) TOTAL_ITEM
		  FROM FI_R_BEGINNING
		 WHERE PAYLIST_CODE = #{PAYLIST_CODE}
		   AND BEGINNING_NUM &lt;= #{YSZJQC} AND ITEM_FLAG = 2
	</select>
	<select id="getPeople" parameterType="map" resultType="map">
		SELECT FCC.NAME, FCC.ID_CARD_NO,FCC.ORAGNIZATION_CODE, '承租人' TYPE
		  FROM FIL_PROJECT_HEAD FPH, FIL_CUST_CLIENT FCC
		 WHERE FPH.CLIENT_ID = FCC.ID
		   AND FPH.ID = #{PROJECT_ID}
		UNION ALL
		SELECT FCC.NAME, FCC.ID_CARD_NO,FCC.ORAGNIZATION_CODE, '共同承租人' TYPE
		  FROM FIL_PROJECT_HEAD FPH, FIL_CUST_CLIENT FCC
		 WHERE FPH.JOINT_TENANT_ID = FCC.ID
		   AND FPH.ID = #{PROJECT_ID}
		UNION ALL
		SELECT FCC.NAME, FCC.ID_CARD_NO,FCC.ORAGNIZATION_CODE, '担保人' TYPE
		  FROM FIL_CREDIT_GUARANTOR_INFO FCGI, FIL_CUST_CLIENT FCC
		 WHERE FCGI.CUST_ID = FCC.ID
		   AND FCGI.CREDIT_ID = #{PROJECT_ID}
	</select>
	<select id="VerificationBank" parameterType="map" resultType="map">
		SELECT FFPH.PAY_BANK_ACCOUNT, FPH.BANK_ID
		  FROM FI_FUND_PAYMENT_HEAD   FFPH,
		       FI_FUND_PAYMENT_DETAIL FFPD,
		       FIL_PROJECT_HEAD       FPH
		 WHERE FFPH.ID = FFPD.PAYMENT_HEAD_ID
		   AND FFPD.PROJECT_CODE = FPH.PRO_CODE
		   AND FFPH.ID =#{PAYMENT_JBPM_ID}
	</select>
	<insert id="insVinContrast" parameterType="map">
		INSERT INTO VIN_VERIFICATION(
		ID,
		EQ_ID,
		CCRQ,
		CLXH,
		CARBODYCOLOR,
		FDJH,
		TRIM,
		TRIMID,
		VIN_CODE
		)VALUES(
		SEQ_VIN_VERIFICATION.NEXTVAL,
		#{EQ_ID},
		TO_DATE(#{CCRQ},'YYYY-MM-DD HH24:MI:SS'),
		#{CLXH},
		#{CarBodyColor},
		#{FDJH},
		#{Trim},
		#{TrimId},
		#{VIN}
		)
	</insert>
	<select id="getVinContrast" parameterType="map" resultType="map">
		SELECT  VIN.ID,
				VIN.EQ_ID,
				to_char(VIN.CCRQ,'YYYY-MM-DD HH24:MI:SS') CCRQ,
				VIN.CLXH,
				VIN.CARBODYCOLOR,
				VIN.FDJH,
				VIN.TRIM,
				VIN.TRIMID,
				VIN.VIN_CODE
		  FROM FI_FUND_PAYMENT_DETAIL FFPD,
		       FIL_PROJECT_HEAD       FPH,
		       FIL_PROJECT_EQUIPMENT  FPE,
		       VIN_VERIFICATION       VIN
		 WHERE FFPD.PROJECT_CODE = FPH.PRO_CODE
		   AND FPE.PROJECT_ID = FPH.ID
		   AND FPE.CAR_SYMBOL = VIN.VIN_CODE
		   AND FPE.ID=VIN.EQ_ID
		   AND FFPD.ID=#{PAYMENT_ID}
	</select>
	<select id="getVinList" parameterType="map" resultType="map">
		SELECT  VIN.ID,
				VIN.EQ_ID,
				to_char(VIN.CCRQ,'YYYY-MM-DD HH24:MI:SS') CCRQ,
				VIN.CLXH,
				VIN.CARBODYCOLOR,
				VIN.FDJH,
				VIN.TRIM,
				VIN.TRIMID,
				VIN.VIN_CODE
		FROM VIN_VERIFICATION VIN WHERE VIN.VIN_CODE=#{VIN}
	</select>
	<select id="getTranx" parameterType="map" resultType="map">
		SELECT FFPD.ID SN,
			   FFPD.ID FFPDID,
		       FPH.CLIENT_ID CUST_USERID,
		       '00' ACCOUNT_TYPE,
		       FFPH.PAY_BANK_ACCOUNT ACCOUNT_NO,
		       FFPH.PAYEE_NAME ACCOUNT_NAME,
		       FFPH.PAY_BANK_NAME BANK_NAME,
		       '0' ACCOUNT_PROP,
		       FFPD.PAY_MONEY*100 AMOUNT,
		       'CNY' CURRENCY,
		       FFPD.PAYLIST_CODE REMARK
		  FROM FI_FUND_PAYMENT_DETAIL FFPD,
		       FI_FUND_PAYMENT_HEAD   FFPH,
		       FIL_PROJECT_HEAD       FPH
		 WHERE FFPD.PAYMENT_HEAD_ID = FFPH.ID
		   AND FFPD.PROJECT_CODE = FPH.PRO_CODE
		   AND FFPD.ID=#{PAYMENT_ID}
	</select>	
	<select id="getZhongjin" parameterType="map" resultType="map">
	SELECT FFPD.ID ITEM_NO,
         FFPD.ID FFPDID,
           SUM(round(nvl(FFPB.MONEY, 0), 2)) * 100 AMOUNT,
           
           FFPH.PAY_BANK_NAME BANK_NAME,
           '11' ACCOUNT_TYPE,
           FFPH.PAY_BANK_ACCOUNT ACCOUNT_NUMBER,
           FFPH.PAYEE_NAME ACCOUNT_NAME,
           FFPH.PAY_BANK_NAME BANK_NAME,
           FFPD.PAYLIST_CODE NOTE,
           FPH.CLIENT_ID CUST_USERID,
           fph.LEASE_CODE,
           fcc.name CUST_NAME,
           FFPH.PAY_BRANCH_NAME BRANCH_NAME,
           FFPH.CITY_NAME CITY,
           FFPH.PROVINCE_NAME PROVINCE
      FROM FI_FUND_PAYMENT_DETAIL FFPD,
           FI_FUND_PAYMENT_HEAD   FFPH,
           FI_FUND_PAYMENT_BANK   FFPB,
           FIL_PROJECT_HEAD       FPH,
           fil_cust_client fcc
     WHERE FFPD.PAYMENT_HEAD_ID = FFPH.ID
       AND FFPD.PAYLIST_CODE = FFPB.PAYLIST_CODE(+)
       AND FFPD.PROJECT_CODE = FPH.PRO_CODE
       and fph.client_id = fcc.id(+)
       
       AND FFPD.ID=#{PAYMENT_ID}
       AND FFPB.FS = '2'
     GROUP BY
           FFPD.ID,
           FFPH.PAY_BANK_NAME,
           FFPH.PAY_BANK_ACCOUNT,
           FFPH.PAYEE_NAME,
           FFPH.PAY_BANK_NAME,
           FFPD.PAYLIST_CODE,
           FPH.CLIENT_ID,
           fph.LEASE_CODE,
           fcc.name,
           FFPH.PAY_BRANCH_NAME,
           FFPH.CITY_NAME,
           FFPH.PROVINCE_NAME
	</select>
	<select id="getZhongjinHead" parameterType="map" resultType="map">
	SELECT COUNT(*) TOTAL_ITEM,SUM(round(nvl(PAY_MONEY, 0), 2) * 100) TOTAL_SUM
      FROM FI_FUND_PAYMENT_DETAIL WHERE ID=#{PAYMENT_ID}
	</select>
	<select id="getTranxHead" parameterType="map" resultType="map">
		SELECT COUNT(*) TOTAL_ITEM,SUM(PAY_MONEY)*100 TOTAL_SUM FROM FI_FUND_PAYMENT_DETAIL WHERE ID=#{PAYMENT_ID}
	</select>
	<select id="getAllTranxMiddle" parameterType="map" resultType="map">
		SELECT REQ_SN_MAIN FROM T_SYS_TRANX_MIDDLE WHERE USE_STATE=0 GROUP BY REQ_SN_MAIN
	</select>
	<select id="getAllZhongjinMiddle" parameterType="map" resultType="map">
		SELECT BATCH_NO,TYPE FROM T_SYS_ZHONGJIN_MIDDLE WHERE USE_STATE=0 GROUP BY BATCH_NO,TYPE
	</select>
	<update id="updFundIdPayment" parameterType="map">
		UPDATE FI_FUND_PAYMENT_HEAD SET FUNDID=#{FUND_ID} WHERE ID=(SELECT PAYMENT_HEAD_ID FROM FI_FUND_PAYMENT_DETAIL WHERE ID=#{PAYMENT_ID})
	</update>
	<select id="getfirstReceipt" parameterType="map" resultType="map">
		SELECT * FROM T_SYS_TRANX_MIDDLE WHERE USE_STATE=1 AND TYPE=3
	</select>
	<select id="getfirstReceipt_JYZL" parameterType="map" resultType="map">
		SELECT * FROM T_SYS_ZHONGJIN_MIDDLE WHERE USE_STATE=1 AND TYPE=3
	</select>
	<select id="getfirstReceipt1" parameterType="map" resultType="map">
		SELECT * FROM T_SYS_TRANX_MIDDLE WHERE USE_STATE=1 AND TYPE=1
	</select>
	<select id="getfirstReceipt1_JYZL" parameterType="map" resultType="map">
		SELECT * FROM T_SYS_ZHONGJIN_MIDDLE WHERE USE_STATE=1 AND TYPE=1
	</select>
	<select id="tranxgetPaymentId" parameterType="map" resultType="map">
		SELECT FFPD.ID PAYMENT_ID, FPH.FHFA_ID, FM.FA_NAME,FRPH.ID PAY_ID,FRPH.PAYLIST_CODE
		  FROM FI_FUND_PAYMENT_DETAIL FFPD, FIL_PROJECT_HEAD FPH, FHFA_MANAGER FM,FIL_RENT_PLAN_HEAD_BAS_MAX__V FRPH
		 WHERE FFPD.PROJECT_CODE = FPH.PRO_CODE AND FPH.ID=FRPH.PROJECT_ID
		   AND FPH.FHFA_ID = FM.ID
		   AND FFPD.ID =#{PAYMENT_ID}
	</select>
	<select id="tranxgetPaymentId_JYZL" parameterType="map" resultType="map">
		SELECT FFPD.ID PAYMENT_ID, FPH.FHFA_ID, FM.FA_NAME,FRPH.ID PAY_ID,FRPH.PAYLIST_CODE
		  FROM FI_FUND_PAYMENT_DETAIL FFPD, FIL_PROJECT_HEAD FPH, FHFA_MANAGER FM,FIL_RENT_PLAN_HEAD_BAS_MAX__V FRPH
		 WHERE FFPD.PROJECT_CODE = FPH.PRO_CODE AND FPH.ID=FRPH.PROJECT_ID
		   AND FPH.FHFA_ID = FM.ID
		   AND PAYMENT_HEAD_ID =
		       (SELECT ID FROM FI_FUND_PAYMENT_HEAD WHERE FUNDID = #{ITEM_NO})
	</select>
	<update id="updffphfindId" parameterType="map">
		UPDATE FI_FUND_PAYMENT_HEAD SET FUNDID='' WHERE FUNDID=#{SN}
	</update>
	<update id="updffphfindId_JYZL" parameterType="map">
		UPDATE FI_FUND_PAYMENT_HEAD SET FUNDID='' WHERE FUNDID=#{ITEM_NO}
	</update>
	<select id="getTranxMiddle" parameterType="map" resultType="map">
		SELECT * FROM T_SYS_TRANX_MIDDLE WHERE TYPE=3 AND SN=#{FUNDID}
	</select>
	<update id="updBusinessSnMain" parameterType="map">
		UPDATE T_SYS_TRANX_MIDDLE SET BUSINESS_SN_MAIN=#{BUSINESS_SN_MAIN} WHERE REQ_SN_MAIN=#{REQ_SN_MAIN}
	</update>
	<select id="getheadfundId" parameterType="map" resultType="map">
		SELECT FFPH.FUNDID FROM FI_FUND_PAYMENT_DETAIL FFPD,FI_FUND_PAYMENT_HEAD FFPH WHERE FFPD.PAYMENT_HEAD_ID=FFPH.ID AND FFPD.ID=#{PAYMENT_ID} 
	</select>
	<update id="updBanklendState" parameterType="map">
		UPDATE FI_FUND_PAYMENT_HEAD SET BANKLEND_STATE=1,STATUS = 5 WHERE ID=(SELECT PAYMENT_HEAD_ID FROM FI_FUND_PAYMENT_DETAIL WHERE ID=#{FFPDID})
	</update>
	<select id="selClob" parameterType="map" resultType="map">
		SELECT FFPH.ID,FPS.SCHEME_CLOB
		  FROM FI_FUND_PAYMENT_DETAIL FFPD,
		  	   FI_FUND_PAYMENT_HEAD FFPH,
		       FIL_PROJECT_HEAD       FPH,
		       FIL_PROJECT_SCHEME     FPS
		 WHERE FFPD.PROJECT_CODE = FPH.PRO_CODE
		   AND FPH.ID = FPS.PROJECT_ID
		   AND FFPD.PAYMENT_HEAD_ID=FFPH.ID
		   AND FFPD.ID=#{FFPDID}
	</select>
	<insert id="insCostDetailed" parameterType="map">
		INSERT INTO FI_FUND_PAYMENT_COSTDETAILED(
			ID
			,FFPDID
			<if test="KEY_NAME_ZN !=null and KEY_NAME_ZN !=''">,KEY_NAME_ZN</if>
			<if test="VALUE_STR !=null and VALUE_STR !=''">,VALUE_STR</if>
			<if test="DSFS !=null and DSFS !=''">,DSFS</if>
			<if test="FYGS !=null and FYGS !=''">,FYGS</if>
		)VALUES(
			SEQ_PAYMENT_COSTDETAILED.NEXTVAL
			,#{FFPDID}
			<if test="KEY_NAME_ZN !=null and KEY_NAME_ZN !=''">,#{KEY_NAME_ZN}</if>
			<if test="VALUE_STR !=null and VALUE_STR !=''">,#{VALUE_STR}</if>
			<if test="DSFS !=null and DSFS !=''">,#{DSFS}</if>
			<if test="FYGS !=null and FYGS !=''">,#{FYGS}</if>
		)
	</insert>
	
	<select id="getProByPayment_Id" parameterType="map" resultType="map">
		select FRP.PROJECT_ID from FI_FUND_PAYMENT_DETAIL FFPD,FIL_RENT_PLAN_HEAD_BAS_MAX__V FRP 
		where FFPD.ID=#{PAYMENT_ID} AND FFPD.PAYLIST_CODE = FRP.PAYLIST_CODE and rownum=1
		
	</select>
	<select id="getCollectionMoney" parameterType="map" resultType="map">
		 SELECT nvl(SUM(FRB.BEGINNING_MONEY),0) BEGINNING_MONEY, FFPD.PAYLIST_CODE PAYLIST_CODE
  FROM FI_FUND_PAYMENT_DETAIL FFPD, FI_R_BEGINNING FRB
 WHERE FFPD.PAYLIST_CODE = FRB.PAYLIST_CODE(+)
		   AND FFPD.ID=#{PAYMENT_ID}
		   <choose>
			<when test="YSZJQC !=null and YSZJQC !=''">AND (ITEM_FLAG=1 OR (BEGINNING_NUM &lt;= #{YSZJQC} AND ITEM_FLAG = 2))</when>
			<otherwise>AND ITEM_FLAG=1</otherwise>
		  </choose>
		   GROUP BY FFPD.PAYLIST_CODE
	</select>
	<select id="getCollectionDetailed" parameterType="map" resultType="map">
		SELECT FRB.BEGINNING_NAME,
		       FRB.BEGINNING_MONEY,
		       CASE
		         WHEN FRB.IS_DIFFERENCE = 1 THEN
		          '代收'
		         ELSE
		          '不代收'
		       END IS_DIFFERENCE
		  FROM FI_R_BEGINNING FRB
		 WHERE FRB.PAYLIST_CODE=#{PAYLIST_CODE} AND FRB.ITEM_FLAG=1
		 <if test="YSZJQC !=null and YSZJQC !=''">
		 union all
		 SELECT '第'||FRB.BEGINNING_NUM||'期'||FRB.BEGINNING_NAME,
		       FRB.BEGINNING_MONEY,
		       '不代收' IS_DIFFERENCE
		  FROM FI_R_BEGINNING FRB
		 WHERE FRB.PAYLIST_CODE=#{PAYLIST_CODE}
		 AND FRB.ITEM_FLAG=2
		 AND FRB.BEGINNING_NUM &lt;= #{YSZJQC}
		 AND FRB.BEGINNING_MONEY>0
		 </if>
	</select>
	<insert id="insLoanBank" parameterType="map">
		INSERT INTO FI_FUND_PAYMENT_BANK(
		ID
		<if test="PAYLIST_CODE !=null and PAYLIST_CODE !=''">,PAYLIST_CODE</if>
		<if test="PAYMENT_ID !=null and PAYMENT_ID !=''">,PAYMENT_ID</if>
		<if test="BANK !=null and BANK !=''">,BANK</if>
		<if test="ADDR !=null and ADDR !=''">,ADDR</if>
		<if test="ACCOUNT !=null and ACCOUNT !=''">,ACCOUNT</if>
		<if test="UNIT !=null and UNIT !=''">,UNIT</if>
		<if test="MONEY !=null and MONEY !=''">,MONEY</if>
		<if test="SUP_ID !=null and SUP_ID !=''">,SUP_ID</if>
		<if test="MC!=null and MC !=''">,MC</if>
		<if test="FS!=null and FS !=''">,FS</if>
		<if test="YYFK!=null and YYFK !=''">,YYFK</if>
		<if test="SKF!=null and SKF !=''">,SKF</if>
		<if test="PAY_BRANCH_NAME !=null and PAY_BRANCH_NAME !=''">,PAY_BRANCH_NAME</if>
		<if test="CITY_ID !=null and CITY_ID !=''">,CITY_ID</if>
		<if test="CITY_NAME !=null and CITY_NAME !=''">,CITY_NAME</if>
		<if test="PROVINCE_ID !=null and PROVINCE_ID !=''">,PROVINCE_ID</if>
		<if test="PROVINCE_NAME !=null and PROVINCE_NAME !=''">,PROVINCE_NAME</if>
		)VALUES(
		SEQ_FI_FUND_PAYMENT_BANK.NEXTVAL
		<if test="PAYLIST_CODE !=null and PAYLIST_CODE !=''">,#{PAYLIST_CODE}</if>
		<if test="PAYMENT_ID !=null and PAYMENT_ID !=''">,#{PAYMENT_ID}</if>
		<if test="BANK !=null and BANK !=''">,#{BANK}</if>
		<if test="ADDR !=null and ADDR !=''">,#{ADDR}</if>
		<if test="ACCOUNT !=null and ACCOUNT !=''">,#{ACCOUNT}</if>
		<if test="UNIT !=null and UNIT !=''">,#{UNIT}</if>
		<if test="MONEY !=null and MONEY !=''">,#{MONEY}</if>
		<if test="SUP_ID !=null and SUP_ID !=''">,#{SUP_ID}</if>
		<if test="MC !=null and MC !=''">,#{MC}</if>
		<if test="FS !=null and FS !=''">,#{FS}</if>
		<if test="YYFK !=null and YYFK !=''">,#{YYFK}</if>
		<if test="SKF !=null and SKF !=''">,#{SKF}</if>
		<if test="PAY_BRANCH_NAME !=null and PAY_BRANCH_NAME !=''">,#{PAY_BRANCH_NAME}</if>
		<if test="CITY_ID !=null and CITY_ID !=''">,#{CITY_ID}</if>
		<if test="CITY_NAME !=null and CITY_NAME !=''">,#{CITY_NAME}</if>
		<if test="PROVINCE_ID !=null and PROVINCE_ID !=''">,#{PROVINCE_ID}</if>
		<if test="PROVINCE_NAME !=null and PROVINCE_NAME !=''">,#{PROVINCE_NAME}</if>
		)
	</insert>
	<delete id="delLoanBank" parameterType="map">
		DELETE FROM FI_FUND_PAYMENT_BANK WHERE PAYLIST_CODE=#{PAYLIST_CODE}
	</delete>
	<select id="selparagraph" parameterType="map" resultType="map">
		SELECT FF.FUND_CLIENT_ID,
		       FF.FUND_ID,
		       FF.FUND_COMENAME,
		       FF.FUND_COMECODE,
		       FF.FUND_IMPORT_PERSON_ID,
		       FF.FUND_IMPORT_PERSON,
		       FF.FUND_ACCEPT_DATE,
		       FF.FUND_FUNDCODE,
		       FFPD.PAYLIST_CODE,
		       FF.FUND_RECEIVE_MONEY,
		       FF.FUND_ACCEPT_CODE
		  FROM FI_FUND_PAYMENT_DETAIL   FFPD,
		       FIL_RENT_PLAN_HEAD_MAX_V FRPH,
		       FIL_PROJECT_HEAD         FPH,
		       FI_FUND                  FF
		 WHERE FFPD.PAYLIST_CODE = FRPH.PAYLIST_CODE
		   AND FRPH.PROJECT_ID = FPH.ID
		   AND FPH.CLIENT_ID = FF.FUND_CLIENT_ID
		   AND FUND_RECEIVE_MONEY >= #{WDS}
		   AND FFPD.ID = #{PAYMENT_ID}
		   AND FF.FUND_STATUS = 0
		   AND FF.AUTOFLAG = 0
		   AND FF.FUND_ACCEPT_DATE &lt;= SYSDATE
		   AND FF.FUND_TYPE=1
		   AND FF.FUND_CLIENT_ID IS NOT NULL
		   AND FF.FUND_RECEIVE_MONEY > 0
		   AND ROWNUM=1
	</select>
	<select id="selPaymentBank" parameterType="string" resultType="map">
		 SELECT FFPB.*
		  FROM FI_FUND_PAYMENT_DETAIL FFPD,
		       FI_FUND_PAYMENT_BANK   FFPB
		 WHERE FFPD.PAYLIST_CODE = FFPB.PAYLIST_CODE
		   AND FFPB.PAYMENT_ID IS NULL
		   AND FFPD.PAYMENT_HEAD_ID=#{PAYMENT_JBPM_ID}
	</select>
	<select id="getPaymentBank" parameterType="map" resultType="map">
		 SELECT BANK PAY_BANK_NAME,
				ADDR PAY_BANK_ADDRESS,
				ACCOUNT PAY_BANK_ACCOUNT,
				UNIT PAYEE_NAME,
				SUP_ID SUPPER_ID 
		FROM FI_FUND_PAYMENT_BANK WHERE PAYMENT_ID=#{PAYMENT_ID}
	</select>
	<insert id="insPaymentDetail" parameterType="map">
		INSERT INTO FI_FUND_PAYMENT_DETAIL(id,
									  PAYMENT_HEAD_ID, 
                                      project_code, 
                                      supper_id, 
                                      supper_name, 
                                      comp_id, 
                                      comp_name, 
                                      start_date, 
                                      pay_money, 
                                      pay_name, 
                                      pay_type, 
                                      reserve_date, 
                                      payee_name, 
                                      pay_bank_account, 
                                      invoice_num, 
                                      invoice_date, 
                                      platform_type, 
                                      payment_type, 
                                      status, 
                                      reality_date, 
                                      reality_bank_name, 
                                      create_id, 
                                      create_date, 
                                      mondfy_id, 
                                      mondfy_date, 
                                      remark, 
                                      lease_topric, 
                                      sq_price, 
                                      guarantee_num, 
                                      guarantee_date, 
                                      acceptance_date, 
                                      pay_bank_address, 
                                      pay_bank_name, 
                                      delivery_date, 
                                      delivery_addr, 
                                      temp_cld, 
                                      cs_price, 
                                      deduction_money, 
                                      deduction_rate, 
                                      last_money, 
                                      paylist_code, 
                                      buy_contract_id, 
                                      dekou_sq, 
                                      is_pay_why, 
                                      isdekou)
   SELECT #{PAYMENT_ID},
   		  #{PAYMENT_HEAD_ID},
          project_code,
          supper_id,
          supper_name,
          comp_id,
          comp_name,
          start_date,
          pay_money,
          pay_name,
          pay_type,
          reserve_date,
          payee_name,
          pay_bank_account,
          invoice_num,
          invoice_date,
          platform_type,
          payment_type,
          status,
          reality_date,
          reality_bank_name,
          create_id,
          create_date,
          mondfy_id,
          mondfy_date,
          remark,
          lease_topric,
          sq_price,
          guarantee_num,
          guarantee_date,
          acceptance_date,
          pay_bank_address,
          pay_bank_name,
          delivery_date,
          delivery_addr,
          temp_cld,
          cs_price,
          deduction_money,
          deduction_rate,
          #{MONEY},
          paylist_code,
          buy_contract_id,
          0,
          is_pay_why,
          1
     FROM FI_FUND_PAYMENT_DETAIL
    WHERE PAYLIST_CODE = #{PAYLIST_CODE} and rownum &lt;=1
	</insert>
	<update id="updPaymentBank" parameterType="map">
		UPDATE FI_FUND_PAYMENT_BANK SET PAYMENT_ID=#{PAYMENT_ID} WHERE ID=#{ID}
	</update>
	<select id="getPaymentNum" parameterType="map" resultType="int">
		SELECT COUNT(*) FROM FI_FUND_PAYMENT_DETAIL WHERE PAYLIST_CODE=(
		SELECT PAYLIST_CODE FROM FI_FUND_PAYMENT_DETAIL WHERE PAYMENT_HEAD_ID=#{PAYMENT_JBPM_ID})
	</select> 
	<update id="updbeginDifference" parameterType="map">
		UPDATE FI_R_BEGINNING SET IS_DIFFERENCE=#{IS_DIFFERENCE} WHERE PAYLIST_CODE=#{PAYLIST_CODE} AND ITEM_FLAG = 1
	</update>
	<select id="getSupNum" parameterType="map" resultType="int">
		SELECT COUNT(*) NUM
		  FROM FI_FUND_PAYMENT_HEAD FFPH, FI_FUND_PAYMENT_DETAIL FFPD
		 WHERE FFPD.PAYMENT_HEAD_ID = FFPH.ID
		   AND FFPH.STATUS=2
		   AND FFPD.PAYMENT_TYPE=#{PAYMENT_TYPE}
		   AND FFPH.SUPPER_ID =#{SUP_ID}
	</select>
	<insert id="insMarginTreatment" parameterType="map">
		INSERT INTO FI_FUND_PAYMENT_DETAIL(id, 
									  PAYMENT_HEAD_ID,
                                      project_code, 
                                      supper_id, 
                                      supper_name, 
                                      comp_id, 
                                      comp_name, 
                                      start_date, 
                                      pay_money, 
                                      pay_name, 
                                      pay_type, 
                                      reserve_date, 
                                      payee_name, 
                                      pay_bank_account, 
                                      invoice_num, 
                                      invoice_date, 
                                      platform_type, 
                                      payment_type, 
                                      status, 
                                      reality_date, 
                                      reality_bank_name, 
                                      create_id, 
                                      create_date, 
                                      mondfy_id, 
                                      mondfy_date, 
                                      remark, 
                                      lease_topric, 
                                      sq_price, 
                                      guarantee_num, 
                                      guarantee_date, 
                                      acceptance_date, 
                                      pay_bank_address, 
                                      pay_bank_name, 
                                      delivery_date, 
                                      delivery_addr, 
                                      temp_cld, 
                                      cs_price, 
                                      deduction_money, 
                                      deduction_rate, 
                                      last_money, 
                                      paylist_code, 
                                      buy_contract_id, 
                                      dekou_sq, 
                                      is_pay_why, 
                                      isdekou)
   SELECT #{NEW_PAYMENT_ID},
   		  #{NEW_PAYMENT_HEAD_ID},
          project_code,
          supper_id,
          supper_name,
          comp_id,
          comp_name,
          start_date,
          pay_money,
          pay_name,
          pay_type,
          reserve_date,
          payee_name,
          pay_bank_account,
          invoice_num,
          invoice_date,
          platform_type,
          payment_type,
          status,
          reality_date,
          reality_bank_name,
          create_id,
          create_date,
          mondfy_id,
          mondfy_date,
          remark,
          lease_topric,
          sq_price,
          guarantee_num,
          guarantee_date,
          acceptance_date,
          pay_bank_address,
          pay_bank_name,
          delivery_date,
          delivery_addr,
          temp_cld,
          cs_price,
          deduction_money,
          deduction_rate,
          #{MONEY},
          paylist_code,
          buy_contract_id,
          0,
          is_pay_why,
          1
     FROM FI_FUND_PAYMENT_DETAIL
    WHERE ID =#{ID}
	</insert>
	<insert id="insMarginTreatment1" parameterType="map">
		INSERT INTO FI_FUND_PAYMENT_HEAD(ID, 
										PAYMENT_CODE, 
										SUPPER_ID, 
										SUPPER_NAME, 
										COMP_ID, 
										COMP_NAME, 
										PAYMENT_MONEY, 
										ACCBILL_PRICE, 
										BANKBILL_PRICE, 
										BEGGIN_DATE, 
										PROJECT_NUM, 
										PAYEE_NAME, 
										PAY_BANK_NAME, 
										PAY_BANK_ADDRESS, 
										PAY_BANK_ACCOUNT, 
										STATUS, 
										REALITY_DATE, 
										REALITY_BANK_NAME, 
										CREATE_ID, 
										CREATE_DATE, 
										MODIFY_ID, 
										MODIFY_DATE, 
										REMARK, 
										REMARK1, 
										TYPE, 
										DEDUCTION_MONEY, 
										DEDUCTION_RATE, 
										LAST_MONEY, 
										ORG_ID, 
										TEMP_CLD, 
										JBPM_ID, 
										LIMIT_BOND, 
										PLAN_AMT, 
										DISCRETIONARY_FUNDS, 
										BANKLEND_STATE, 
										FUNDID)
   SELECT #{NEW_PAYMENT_HEAD_ID},
		PAYMENT_CODE, 
		SUPPER_ID, 
		SUPPER_NAME, 
		COMP_ID, 
		COMP_NAME, 
		PAYMENT_MONEY, 
		ACCBILL_PRICE, 
		BANKBILL_PRICE, 
		BEGGIN_DATE, 
		PROJECT_NUM, 
		PAYEE_NAME, 
		PAY_BANK_NAME, 
		PAY_BANK_ADDRESS, 
		PAY_BANK_ACCOUNT, 
		STATUS, 
		REALITY_DATE, 
		REALITY_BANK_NAME, 
		CREATE_ID, 
		CREATE_DATE, 
		MODIFY_ID, 
		MODIFY_DATE, 
		REMARK, 
		REMARK1, 
		TYPE, 
		DEDUCTION_MONEY, 
		DEDUCTION_RATE, 
		#{MONEY}, 
		ORG_ID, 
		TEMP_CLD, 
		JBPM_ID, 
		LIMIT_BOND, 
		PLAN_AMT, 
		DISCRETIONARY_FUNDS, 
		BANKLEND_STATE, 
		FUNDID
     FROM FI_FUND_PAYMENT_HEAD
    WHERE ID =#{PAYMENT_JBPM_ID}
	</insert>
	<select id="getFkbzj" parameterType="map" resultType="map">
		SELECT FSC.VALUE_STR
		  FROM FIL_RENT_PLAN_HEAD_MAX_V FRPH,
		       (SELECT T.PAY_ID,T.SCHEME_ID_ACTUAL FROM FIL_PROJECT_EQUIPMENT T GROUP BY T.PAY_ID,T.SCHEME_ID_ACTUAL) FPE,
		       FIL_SCHEME_CLOB          FSC
		WHERE FRPH.ID=FPE.PAY_ID
		  AND FPE.SCHEME_ID_ACTUAL=FSC.SCHEME_ID
		  AND FRPH.PAYLIST_CODE=#{PAYLIST_CODE}
		  AND FSC.KEY_NAME_EN=#{KEY_NAME_EN}
	</select>
	<select id="getparagraphNext" parameterType="map" resultType="map">
		SELECT FF.FUND_CLIENT_ID,
		       FF.FUND_ID,
		       FF.FUND_COMENAME,
		       FF.FUND_COMECODE,
		       FF.FUND_IMPORT_PERSON_ID,
		       FF.FUND_IMPORT_PERSON,
		       to_char(FF.FUND_ACCEPT_DATE,'YYYY-MM-DD') FUND_ACCEPT_DATE,
		       FF.FUND_FUNDCODE,
		       FF.FUND_RECEIVE_MONEY,
		       FF.FUND_ACCEPT_CODE
		  FROM FI_FUND                  FF
		 WHERE (FF.FUND_PRANT_ID=#{FUND_ID} OR FF.FUND_ID=#{FUND_ID})
		   AND FF.FUND_STATUS = 0
		   AND FF.AUTOFLAG = 0
		   AND FF.FUND_ACCEPT_DATE &lt;= SYSDATE
		   AND FF.FUND_TYPE=1
		   AND ROWNUM=1
	</select>
	<select id="getYsqc" parameterType="map" resultType="map">
		SELECT VALUE_STR
		  FROM FIL_SCHEME_CLOB
		 WHERE KEY_NAME_EN = 'YSZJQC'
		   AND SCHEME_ID =
		       (SELECT ID
		          FROM FIL_PROJECT_SCHEME
		         WHERE ID = (SELECT SCHEME_ID_ACTUAL
		                       FROM FIL_PROJECT_EQUIPMENT
		                      WHERE PAYLIST_CODE = #{PAYLIST_CODE}))
	</select>

	<select id="getProjectHeadStatus" parameterType="map" resultType="map">
	     select STATUS from fil_project_head where id=#{projectId}
	</select>
	
	<!-- 查询项目明细-->
	<select id="findXmmxlist" parameterType="map" resultType="map">
		SELECT DISTINCT FD.*, FF.*
		    FROM FIL_PROJECT_FEEDETAIL FF, FIL_PROJECT_DETAIL_BASE FD
		   WHERE FF.TYPE_ID = FD.TYPEID
		   	 <if test="IS_PAY !=null and IS_PAY !=''"> AND FF.IS_PAY = #{IS_PAY}</if>
		     AND FF.PROJECT_ID = #{PROJECT_ID} ORDER BY FD.TYPEID
	</select>
	
	<!-- 查询项目明细(根据PROJECT_ID和COUSTNAME、TYPE_ID)-->
	<select id="findXmmxlistByCP" parameterType="map" resultType="map">
		SELECT DISTINCT FD.*, FF.*
		    FROM FIL_PROJECT_FEEDETAIL FF, FIL_PROJECT_DETAIL_BASE FD
		   WHERE FF.TYPE_ID = FD.TYPEID
		     <if test="COUSTNAME !=null and COUSTNAME !=''"> AND FD.COUSTNAME = #{COUSTNAME}</if>
		     <if test="TYPE_ID !=null and TYPE_ID !=''"> AND FF.TYPE_ID = #{TYPE_ID}</if>  
		     AND FF.PROJECT_ID = #{PROJECT_ID} ORDER BY FD.TYPEID
	</select>
	
	<!-- 查询项目明细码表(COUSTNAME)-->
	<select id="findXmmxBaseByCN" parameterType="map" resultType="map">
		SELECT * FROM FIL_PROJECT_DETAIL_BASE F WHERE F.COUSTNAME = #{COUSTNAME}
	</select>
	
	<!-- 请款审核保存，费用明细字段修改 -->
	<update id="updateProjectDetail" parameterType="map">
		UPDATE FIL_PROJECT_FEEDETAIL
		   SET 
		   	   TYPE_ID=#{TYPE_ID}
		       <if test="MONEY !=null and MONEY !=''">,PAYABLE_MONEY=#{MONEY}</if>
		       <if test="FS !=null and FS !=''">,PAY_TYPE=#{FS}</if>
		       <if test="YYFK !=null and YYFK !=''">,APPOINTMENT_TIME=TO_DATE(#{YYFK},'yyyy-mm-dd,hh24:mi:ss')</if>
		       <if test="SKF !=null and SKF !=''">,CHAMBERLAIN=#{SKF}</if>
		       <if test="BANK !=null and BANK !=''">,OPEN_BANK_NAME=#{BANK}</if>
		       <if test="PAY_BRANCH_NAME !=null and PAY_BRANCH_NAME !=''">,BANK_BRANCH_NAME=#{PAY_BRANCH_NAME}</if>
		       <if test="PROVINCE_NAME !=null and PROVINCE_NAME !=''">,BANK_BRANCH_PROVINCE=#{PROVINCE_NAME}</if>
		       <if test="CITY_NAME !=null and CITY_NAME !=''">,BANK_BRANCH_CITY=#{CITY_NAME}</if>
		       <if test="ACCOUNT !=null and ACCOUNT !=''">,BANK_NUM=#{ACCOUNT}</if>
		       <if test="UNIT !=null and UNIT !=''">,UNIT=#{UNIT}</if>
		       <if test="APPLY_MONEY !=null and APPLY_MONEY !=''">,APPLY_MONEY=#{APPLY_MONEY}</if>
		  WHERE PROJECT_ID =#{PROJECT_ID} AND TYPE_ID=#{TYPE_ID}
	</update>
	
	<!-- 新增一条费用明细 -->
	<insert id="addProjectDetail" parameterType="map">
		INSERT INTO FIL_PROJECT_FEEDETAIL
		(
		   <if test="PROJECT_ID !=null and PROJECT_ID !=''">PROJECT_ID</if>
		   <if test="TYPE_ID !=null and TYPE_ID !=''">,TYPE_ID</if>
	       <if test="MONEY !=null and MONEY !=''">,PAYABLE_MONEY</if>
	       <if test="IS_PAY !=null and IS_PAY !=''">,IS_PAY</if>
	       <if test="FS !=null and FS !=''">,PAY_TYPE</if>
	       <if test="YYFK !=null and YYFK !=''">,APPOINTMENT_TIME</if>
	       <if test="SKF !=null and SKF !=''">,CHAMBERLAIN</if>
	       <if test="BANK !=null and BANK !=''">,OPEN_BANK_NAME</if>
	       <if test="PAY_BRANCH_NAME !=null and PAY_BRANCH_NAME !=''">,BANK_BRANCH_NAME</if>
	       <if test="PROVINCE_NAME !=null and PROVINCE_NAME !=''">,BANK_BRANCH_PROVINCE</if>
	       <if test="CITY_NAME !=null and CITY_NAME !=''">,BANK_BRANCH_CITY</if>
	       <if test="ACCOUNT !=null and ACCOUNT !=''">,BANK_NUM</if>
	       <if test="UNIT !=null and UNIT !=''">,UNIT</if>
	       <if test="APPLY_MONEY !=null and APPLY_MONEY !=''">,APPLY_MONEY</if>
		) VALUES(
		   <if test="PROJECT_ID !=null and PROJECT_ID !=''">#{PROJECT_ID} </if>
		   <if test="TYPE_ID !=null and TYPE_ID !=''">,#{TYPE_ID} </if>
	       <if test="MONEY !=null and MONEY !=''">,#{MONEY}</if>
	       <if test="IS_PAY !=null and IS_PAY !=''">,#{IS_PAY}</if>
	       <if test="FS !=null and FS !=''">,#{FS}</if>
	       <if test="YYFK !=null and YYFK !=''">,TO_DATE(#{YYFK},'yyyy-mm-dd,hh24:mi:ss')</if>
	       <if test="SKF !=null and SKF !=''">,#{SKF}</if>
	       <if test="BANK !=null and BANK !=''">,#{BANK}</if>
	       <if test="PAY_BRANCH_NAME !=null and PAY_BRANCH_NAME !=''">,#{PAY_BRANCH_NAME}</if>
	       <if test="PROVINCE_NAME !=null and PROVINCE_NAME !=''">,#{PROVINCE_NAME}</if>
	       <if test="CITY_NAME !=null and CITY_NAME !=''">,#{CITY_NAME}</if>
	       <if test="ACCOUNT !=null and ACCOUNT !=''">,#{ACCOUNT}</if>
	       <if test="UNIT !=null and UNIT !=''">,#{UNIT}</if>
	       <if test="APPLY_MONEY !=null and APPLY_MONEY !=''">,#{APPLY_MONEY}</if>
		)
	</insert>
	
	<!-- 费用明细码表FIL_PROJECT_DETAIL_BASE，根据类型ID查询 -->
	<select id="getProjectDetailBase" parameterType="map" resultType="map">
		SELECT F.* FROM FIL_PROJECT_DETAIL_BASE F ORDER BY F.TYPEID
	</select>
   <!--     查询放款清单明细 add by xingsumin 2016年1月9日15:29:53 begin -->
	<select id="getPaymentApplyListPageList" parameterType="map" resultType="map">
	     SELECT T2.* FROM ( SELECT T1.*,ROWNUM RN FROM (
		    SELECT FFPH.APPLY_MONEY_SUM,
		           FFPH.ORG_ID,
		           TO_CHAR(FFPH.APPLY_DATE, 'yyyy-MM-dd') APPLY_DATE,
		           FFPD.PROJECT_CODE,
		           TO_CHAR(FFPH.BEGGIN_DATE, 'yyyy-MM-dd') BEGGIN_DATE,
		           FCC.NAME CUST_NAME,
		           '对公' as ACCOUNT_TYPE,
		           FFPB.BANK,FFPB.ACCOUNT,
		           CASE WHEN FFPH.STATUS  =2  THEN '待放款' WHEN FFPH.STATUS IN (4,5)  THEN '放款成功' ELSE '未放款' END STATUS,
		           FPH.LEASE_CODE,
		           FFPB.UNIT
		      FROM  (SELECT FFPD1.PAYMENT_HEAD_ID PAYMENT_HEAD_ID,MAX(FFPD1.id) ID,MAX(FFPD1.PROJECT_CODE) PROJECT_CODE FROM FI_FUND_PAYMENT_DETAIL FFPD1  GROUP BY FFPD1.PAYMENT_HEAD_ID) FFPD
		           LEFT JOIN FI_FUND_PAYMENT_HEAD FFPH ON FFPH.ID = FFPD.PAYMENT_HEAD_ID  
		           LEFT JOIN FIL_PROJECT_HEAD FPH ON FFPD.PROJECT_CODE=FPH.PRO_CODE
		           LEFT JOIN FIL_CUST_CLIENT  FCC ON FPH.CLIENT_ID=FCC.ID
		           LEFT JOIN FI_FUND_PAYMENT_BANK FFPB ON FFPB.PAYMENT_ID=FFPD.ID
		          WHERE  FFPH.APPLY_DATE IS NOT NULL
		           <if test="APPLY_DATE1!= null and APPLY_DATE1!=''">AND FFPH.APPLY_DATE  >=to_date(#{APPLY_DATE1},'yyyy-mm-dd')</if>
	   			   <if test="APPLY_DATE2!= null and APPLY_DATE2!=''">AND FFPH.APPLY_DATE &lt;=to_date(#{APPLY_DATE2},'yyyy-mm-dd')</if>
	   			   <if test="CUST_NAME!=null and CUST_NAME!=''">AND FCC.NAME like '%${CUST_NAME}%'</if>
	   			   <if test=" SUB_COMPANY_NAME!=null and SUB_COMPANY_NAME!=''"> AND FFPH.ORG_ID IN (SELECT ID  FROM  secu_org o  START WITH o.name like  '%${SUB_COMPANY_NAME}%'  CONNECT BY PRIOR id=parent_id)</if>
	   			   <if test="STATUS1!=null and STATUS1 !=''">AND FFPH.STATUS =2 </if>
	   			   <if test="STATUS2!=null and STATUS2 !=''">AND FFPH.STATUS IN (4,5)</if>
	   			   ORDER BY FFPH.BEGGIN_DATE DESC
		   ) T1  WHERE ROWNUM &lt;=#{PAGE_END} ) t2 WHERE t2.RN>=#{PAGE_BEGIN}
	
	</select>
	<select id="getPaymentApplyListPageCount" parameterType="map" resultType="int">
	SELECT count(0) FROM (
		   SELECT FFPH.APPLY_MONEY_SUM,
		          TO_CHAR(FFPH.APPLY_DATE, 'yyyy-MM-dd') APPLY_DATE,
		           FFPD.PROJECT_CODE,
		           TO_CHAR(FFPH.BEGGIN_DATE, 'yyyy-MM-dd') BEGGIN_DATE,
		           FCC.NAME CUST_NAME,
		           '对公' as ACCOUNT_TYPE,
		           FFPB.BANK,FFPB.ACCOUNT,
		           CASE WHEN FFPH.STATUS  =2  THEN '待放款' WHEN FFPH.STATUS IN (4,5)  THEN '放款成功' ELSE '未放款' END STATUS,
		           FPH.LEASE_CODE,
		           FFPB.UNIT
		      FROM  (SELECT FFPD1.PAYMENT_HEAD_ID PAYMENT_HEAD_ID,MAX(FFPD1.id) ID,MAX(FFPD1.PROJECT_CODE) PROJECT_CODE FROM FI_FUND_PAYMENT_DETAIL FFPD1  GROUP BY FFPD1.PAYMENT_HEAD_ID) FFPD
		           LEFT JOIN FI_FUND_PAYMENT_HEAD FFPH ON FFPH.ID = FFPD.PAYMENT_HEAD_ID 
		           LEFT JOIN FIL_PROJECT_HEAD FPH ON FFPD.PROJECT_CODE=FPH.PRO_CODE
		           LEFT JOIN FIL_CUST_CLIENT  FCC ON FPH.CLIENT_ID=FCC.ID
		           LEFT JOIN FI_FUND_PAYMENT_BANK FFPB ON FFPB.PAYMENT_ID=FFPD.ID
		         WHERE  FFPH.APPLY_DATE IS NOT NULL
		           <if test="APPLY_DATE1!= null and APPLY_DATE1!=''">AND FFPH.APPLY_DATE  >=to_date(#{APPLY_DATE1},'yyyy-mm-dd')</if>
	   			   <if test="APPLY_DATE2!= null and APPLY_DATE2!=''">AND FFPH.APPLY_DATE &lt;=to_date(#{APPLY_DATE2},'yyyy-mm-dd')</if>
	   			   <if test="CUST_NAME!=null and CUST_NAME!=''">AND FCC.NAME like '%${CUST_NAME}%'</if>
	   			   <if test=" SUB_COMPANY_NAME!=null and SUB_COMPANY_NAME!=''"> AND FFPH.ORG_ID IN (SELECT ID  FROM  secu_org o  START WITH o.name like  '%${SUB_COMPANY_NAME}%'  CONNECT BY PRIOR id=parent_id)</if>
	   			   <if test="STATUS1!=null and STATUS1 !=''">AND FFPH.STATUS =2 </if>
	   			   <if test="STATUS2!=null and STATUS2 !=''">AND FFPH.STATUS IN (4,5)</if>
		           )
	</select>
	
	<select id="getPaymentApplyOrgList" parameterType="map" resultType="map">
	    SELECT * FROM  SECU_ORG O  START WITH  ID=#{ORG_ID} CONNECT BY  PRIOR PARENT_ID = ID 
	</select>
	
	<select id="exportPaymentApplyList" parameterType="map" resultType="map">
	      SELECT FFPH.APPLY_MONEY_SUM,
	               FFPH.ORG_ID,
		          TO_CHAR(FFPH.APPLY_DATE, 'yyyy-MM-dd') APPLY_DATE,
		           FFPD.PROJECT_CODE,
		           TO_CHAR(FFPH.BEGGIN_DATE, 'yyyy-MM-dd') BEGGIN_DATE,
		           FCC.NAME CUST_NAME,
		           '对公' as ACCOUNT_TYPE,
		           FFPB.BANK,FFPB.ACCOUNT,
		           CASE WHEN FFPH.STATUS  =2  THEN '待放款' WHEN FFPH.STATUS IN (4,5)  THEN '放款成功' ELSE '未放款' END STATUS,
		           FPH.LEASE_CODE,
		           FFPB.UNIT
		     FROM  (SELECT FFPD1.PAYMENT_HEAD_ID PAYMENT_HEAD_ID,MAX(FFPD1.id) ID,MAX(FFPD1.PROJECT_CODE) PROJECT_CODE FROM FI_FUND_PAYMENT_DETAIL FFPD1  GROUP BY FFPD1.PAYMENT_HEAD_ID) FFPD
		           LEFT JOIN FI_FUND_PAYMENT_HEAD FFPH ON FFPH.ID = FFPD.PAYMENT_HEAD_ID  
		           LEFT JOIN FIL_PROJECT_HEAD FPH ON FFPD.PROJECT_CODE=FPH.PRO_CODE
		           LEFT JOIN FIL_CUST_CLIENT  FCC ON FPH.CLIENT_ID=FCC.ID
		           LEFT JOIN FI_FUND_PAYMENT_BANK FFPB ON FFPB.PAYMENT_ID=FFPD.ID
				WHERE  FFPH.APPLY_DATE IS NOT NULL
		           <if test="APPLY_DATE1!= null and APPLY_DATE1!=''">AND FFPH.APPLY_DATE  >=to_date(#{APPLY_DATE1},'yyyy-mm-dd')</if>
	   			   <if test="APPLY_DATE2!= null and APPLY_DATE2!=''">AND FFPH.APPLY_DATE &lt;=to_date(#{APPLY_DATE2},'yyyy-mm-dd')</if>
	   			   <if test="CUST_NAME!=null and CUST_NAME!=''">AND FCC.NAME like '%${CUST_NAME}%'</if>
	   			   <if test=" SUB_COMPANY_NAME!=null and SUB_COMPANY_NAME!=''"> AND FFPH.ORG_ID IN (SELECT ID  FROM  secu_org o  START WITH o.name like  '%${SUB_COMPANY_NAME}%'  CONNECT BY PRIOR id=parent_id)</if>
	   			   <if test="STATUS1!=null and STATUS1 !=''">AND FFPH.STATUS =2 </if>
	   			   <if test="STATUS2!=null and STATUS2 !=''">AND FFPH.STATUS IN (4,5)</if>
	   			  ORDER BY FFPH.BEGGIN_DATE DESC
	</select>
	  <!--     add by xingsumin 2016年1月9日15:29:53 end -->
	  
	 <!--add by gengchangbao 2016年3月11日  JZZL-115 start  --> 
	 <select id="queryParentProjectById" parameterType="map" resultType="map">
		SELECT FPH.* FROM FIL_PROJECT_HEAD FPH WHERE FPH.ID = #{PROJECT_ID} 
	</select>
	
	<!-- 查询已放款项目明细-->
	<select id="findReSignXmmxlist" parameterType="map" resultType="map">
		 SELECT FFPB.*,FFPD.* 
		 	FROM FIL_PROJECT_HEAD FPH
		       JOIN FI_FUND_PAYMENT_DETAIL FFPD   
		       	 ON FFPD.PROJECT_CODE = FPH.PRO_CODE
		       JOIN FI_FUND_PAYMENT_BANK FFPB 
		         ON FFPB.PAYMENT_ID = FFPD.ID
		       JOIN FI_FUND_PAYMENT_HEAD FFPH 
		         ON FFPH.ID = FFPD.PAYMENT_HEAD_ID
		       WHERE FPH.ID= #{PROJECT_ID} 
	       		AND  FFPH.FIRST_PAYALL IS NOT NULL
	</select>
	
	  <!--add by gengchangbao 2016年3月11日  JZZL-115 end  --> 
</mapper>