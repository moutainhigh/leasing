<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>经销商管理</title>
	<!-- 路径定义-->
	#set ( $_basePath = $request.ContextPath )
	<script type="text/javascript">
		var _basePath = "$!_basePath";
	</script>
	  #parse("content/importBase.vm")
	<script type="text/javascript"  src="js/suppliers.js"></script>
	<script>	
		function se(){
			var SUP_SHORTNAME=$("#SUP_SHORTNAME").val();
			var CREATE_TIME=$("#CREATE_TIME").datebox("getValue");
			var BUSINESS_SECTOR = $("#BUSINESS_SECTOR").val();
			var SUP_TYPE = $('#SUP_TYPE').val();
			$('#pageTable').datagrid('load',{"SUP_SHORTNAME":SUP_SHORTNAME,"CREATE_TIME":CREATE_TIME,"BUSINESS_SECTOR":BUSINESS_SECTOR,"SUP_TYPE":SUP_TYPE});
		}
		function addConfig(val,row,index){
			var html = "";
##			console.debug(row);
			if(row.SUP_STATUS==0){
				html +="&nbsp;|&nbsp;<a href=javascript:void(0) onclick=start('"+val+"')>发起申请</a>";
			}
			if(row.SUP_TYPE==4){
				html += "&nbsp;|&nbsp;<a href=javascript:void(0) onclick=show('"+val+"')>下属经销商</a>"
			}
		    return "<a href=javascript:void(0) onclick=update('"+val+"')>修改</a>&nbsp;|&nbsp;"
		    	+"<a href=javascript:void(0) onclick=del('"+val+"')>删除</a>"
		    	+html;
		}
		
		function supStatus(value,row,index){
			var status = "";
			if(row.SUP_STATUS==0){
				status = "未申请";
			}else if(row.SUP_STATUS==1){
				status = "申请中";
			}else if(row.SUP_STATUS==2){
				status = "合作中";
			}
			return status;
		}
		
		function SCOREFUNCTION(value,row,index){
			var SUP_ID=row.SUP_ID;
			var SUP_SHORTNAME=row.SUP_SHORTNAME;
			return "<a href=javascript:void(0) onclick=scoreAddTab('"+SUP_ID+"','"+SUP_SHORTNAME+"')>"+value+"</a>";
		}
		
		function scoreAddTab(SUP_ID,SUP_SHORTNAME){
			top.addTab(SUP_SHORTNAME+"打分",_basePath+"/secuEvaluate/SecuEvaluate!doGradeScoreSupp.action?SUP_ID="+SUP_ID+"&TYPE=DLS&SUP_SHORTNAME="+SUP_SHORTNAME);
		}
		
		function busSwitch(value,row,index){
		    var switchBtn = "<a href=javascript:void(0) onclick=turnSwitch('"+row.SUP_ID+"','"+value+"',1) >";
		    if(value==1 || value=='关闭'){
			   switchBtn += "<img src='$!_basePath/img/close.png' id='business' width='80' height='21' /> </a>";
			}else{
			   switchBtn += "<img src='$!_basePath/img/open.png' id='business' width='80' height='21' /> </a>";
			}
		    return switchBtn;
		}
		
		
		function balanceSwitch(value,row,index){
		    var switchBtn = "<a href=javascript:void(0) onclick=turnSwitch('"+row.SUP_ID+"','"+value+"',2) >";
		    if(value==1 || value=='关闭'){
			   switchBtn += "<img src='$!_basePath/img/close.png' id='business' width='80' height='21' /> </a>";
			}else{
			   switchBtn += "<img src='$!_basePath/img/open.png' id='business' width='80' height='21' /> </a>";
			}
		    return switchBtn;
		}
		
		function IrrSwitch(value,row,index){
		    var switchBtn = "<a href=javascript:void(0) onclick=turnSwitch('"+row.SUP_ID+"','"+value+"',3) >";
		    if(value==1 || value=='关闭'){
			   switchBtn += "<img src='$!_basePath/img/close.png' id='business' width='80' height='21' /> </a>";
			}else{
			   switchBtn += "<img src='$!_basePath/img/open.png' id='business' width='80' height='21' /> </a>";
			}
		    return switchBtn;
		}
		
		function BModelSwitch(value,row,index){
		    var switchBtn = "<a href=javascript:void(0) onclick=turnSwitch('"+row.SUP_ID+"','"+value+"',4) >";
		    if(value==1 || value=='关闭'){
			   switchBtn += "<img src='$!_basePath/img/close.png' id='business' width='80' height='21' /> </a>";
			}else{
			   switchBtn += "<img src='$!_basePath/img/open.png' id='business' width='80' height='21' /> </a>";
			}
		    return switchBtn;
		}
		
		function SmsSwitch(value,row,index){
		    var switchBtn = "<a href=javascript:void(0) onclick=turnSwitch('"+row.SUP_ID+"','"+value+"',5) >";
		    if(value==1 || value=='关闭'){
			   switchBtn += "<img src='$!_basePath/img/close.png' id='business' width='80' height='21' /> </a>";
			}else{
			   switchBtn += "<img src='$!_basePath/img/open.png' id='business' width='80' height='21' /> </a>";
			}
		    return switchBtn;
		}
		
		function CreditSwitch(value,row,index){
		    var switchBtn = "<a href=javascript:void(0) onclick=turnSwitch('"+row.SUP_ID+"','"+value+"',6) >";
			if(value==1 || value=='关闭'){
			   switchBtn += "<img src='$!_basePath/img/close.png' id='credit' width='80' height='21' /> </a>";
			}else{
			   switchBtn += "<img src='$!_basePath/img/open.png' id='credit' width='80' height='21' /> </a>";
			}
			return switchBtn;
		}
		function ScanSwitch(value,row,index){
		    var switchBtn = "<a href=javascript:void(0) onclick=turnSwitch('"+row.SUP_ID+"','"+value+"',7) >";
			if(value==1 || value=='关闭'){
			   switchBtn += "<img src='$!_basePath/img/close.png' id='scan' width='80' height='21' /> </a>";
			}else{
			   switchBtn += "<img src='$!_basePath/img/open.png' id='scan' width='80' height='21' /> </a>";
			}
			return switchBtn;
		}
		
		function DataFillSwitch(value,row,index){
		    var switchBtn = "<a href=javascript:void(0) onclick=turnSwitch('"+row.SUP_ID+"','"+value+"',8) >";
			if(value==1 || value=='关闭'){
			   switchBtn += "<img src='$!_basePath/img/close.png' id='credit' width='80' height='21' /> </a>";
			}else{
			   switchBtn += "<img src='$!_basePath/img/open.png' id='credit' width='80' height='21' /> </a>";
			}
			return switchBtn;
		}
		
		function yingyeStatus(value,row,index){
		    var switchBtn = "<a href=javascript:void(0) onclick=turnSwitch('"+row.SUP_ID+"','"+value+"',9) >";
			if(value==0 || value=='关闭'){
			   switchBtn  += "<img src='$!_basePath/img/close.png' id='scan' width='80' height='21' /> </a>";
			}else{
			   switchBtn += "<img src='$!_basePath/img/open.png' id='scan' width='80' height='21' /> </a>";
			}
			return switchBtn;
		}
		
		function turnSwitch (SUP_ID,STATUS,TYPE){
		    var param = "";
		    if(TYPE==1){
			   param +="SUP_ID="+SUP_ID+"&SUP_SWITCH="+STATUS;
			}else if(TYPE==2){
			   param +="SUP_ID="+SUP_ID+"&BALANCE_LOAN_SWITCH="+STATUS;
			}else if(TYPE==3){
			   param +="SUP_ID="+SUP_ID+"&IRREGULAR_REPAYMENT_SWITCH="+STATUS;
			}else if(TYPE==4){
			   param +="SUP_ID="+SUP_ID+"&B_MODEL_SWITCH="+STATUS;
			}else if(TYPE==5){
			   param +="SUP_ID="+SUP_ID+"&SMS_SWITCH="+STATUS;
			}else if(TYPE==6){
			   param +="SUP_ID="+SUP_ID+"&CREDIT_SWITCH="+STATUS;
			}else if(TYPE==7){
			   param +="SUP_ID="+SUP_ID+"&SCAN_SWITCH="+STATUS;
			}else if(TYPE==8){
			   param +="SUP_ID="+SUP_ID+"&DATAFILL_SWITCH="+STATUS;
			}else if(TYPE==9){
			   param +="SUP_ID="+SUP_ID+"&YINGYE_STATUS="+STATUS;
			}
		    jQuery.ajax({
    			url: "$_basePath/base/suppliers/Suppliers!supTurnSwitch.action",
				data: param,
    			dataType:"json",
    			success: function(res){
    				if(res.flag==true){
    					//jQuery.messager.alert("提示",res.msg);
    					$('#pageTable').datagrid('reload');
    			    }
    			    else{
    				   jQuery.messager.alert("提示",res.msg);
    			    }
    			}
    		 });
		}
		
		 function rowformater(value,row,index){
            return "<a href=javascript:void(0) onclick=addParentTabs('经销商明细','$!_basePath/base/suppliers/Suppliers!getShowDetailSupp.action?SUP_ID="+row.SUP_ID+"')>"+value+"</a>";
        }
		
		//hxl 资料后补红灯提醒 存在已到期未补齐的项目 STATUS是4 红灯
		function lightformater(value,rowData,rowIndex){
					if((rowData.ZLSTATUS)==4){
						return "<div class='icon-red'>&nbsp;</div>";
					}else{
						return "<div>&nbsp;</div>";
					}
         }
    </script>
</head>
<body  class="easyui-layout">
  <div region="center" border="false">
	 <div id="pageForm" style="padding:20px;height:auto">	
    		<div id="toolbar">
                ##<a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-edit" plain="true" onclick="update()">修改</a>
                ##<a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-remove" plain="true" onclick="del()">删除</a>
    		</div>
                        	
    		<table width="100%" cellspacing="0" cellpadding="0" border="0">
    			<tr>
            	  <td>
					经销商名称：
					<input class="input_03" type="text" size ="20" id="SUP_SHORTNAME" value="$!Param.SUP_SHORTNAME" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
##					  商务板块：
##					<select id="BUSINESS_SECTOR" name="BUSINESS_SECTOR">
##						<option value="">-全部-</option>
##						#foreach($!item in $!busPlate)
##					      <option value="$!item.CODE"  #if($!item.FLAG==$!Param.BUSINESS_SECTOR)selected #end>$!item.FLAG</option>
##						#end
##                    </select>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					创建日期：
					<input type="text" size ="20" name="CREATE_TIME" id="CREATE_TIME" class="easyui-datebox" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					是否为集团：
					<select id="SUP_TYPE" name="SUP_TYPE" >
						<option value="1">否</option>
						<option value="4">是</option>
					</select>&nbsp;&nbsp;
					<a href="javascript:void(0);" class="easyui-linkbutton" iconCls="icon-search" onclick='se();'>查询</a>
					&nbsp;&nbsp;<a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-add" onclick="newOne()">添加</a>
    			  </td>
                  <td>存在已到期未补齐的项目，资料后补提醒处显示<div class='icon-red'>&nbsp;</div></td>
                </tr>
    	    </table>
		</div>		    
		<table id="pageTable" class="easyui-datagrid" fit="true" pagination="true" data-options="rownumbers:true,singleSelect:true,url:'$_basePath/base/suppliers/Suppliers!pageData.action',toolbar:'#pageForm'">
    		<tr>
				<thead>
					<th data-options="field:'SUP_ID',width:200,formatter: addConfig" align="center">操作</th>
					<th data-options="field:'SUP_STATUS',width:60,formatter: supStatus" align="center">状态</th>
		            <th data-options="field:'TEMPCOL',width:80,formatter: lightformater" align="center">资料后补提醒</th>
		            <th data-options="field:'ZLSTATUS',width:30,hidden:true" align="center"></th>
		            <th data-options="field:'SCODE',width:100" align="center">编号</th>
    				<th data-options="field:'SUP_SHORTNAME',width:220,formatter: rowformater" align="center">经销商简称</th>
    				<th data-options="field:'SUP_NAME',width:220" align="center">经销商全称</th>
##					<th data-options="field:'SUP_FLAG',width:100" align="center">经销商标识</th>
##					<th data-options="field:'SCORE',width:80,formatter: SCOREFUNCTION" align="center">经销商评分</th>
##					<th data-options="field:'SUP_LEGAL_NAME',width:100" align="center">法定代理人</th>
			        <th data-options="field:'AREA_NAME',width:100" align="center">区域</th>
    				<th data-options="field:'PROV_NAME',width:100" align="center">省份</th>
##					<th data-options="field:'CITY_NAME',width:100" align="center">城市</th>
    				<th data-options="field:'USER_NAME',width:90" align="center">登记人</th>
					<th data-options="field:'CREATE_DATE',width:100" align="center">创建日期</th>
##					<th data-options="field:'SUP_LEVEL',width:100" align="center">经销商模式</th>
			        <th data-options="field:'SUP_SWITCH',width:100,formatter: busSwitch" align="center">是否受理业务</th>
##					<th data-options="field:'BALANCE_LOAN_SWITCH',width:150,formatter: balanceSwitch " align="center">是否允许差额放款</th>
##					<th data-options="field:'IRREGULAR_REPAYMENT_SWITCH',width:150,formatter: IrrSwitch">是否允许季度内不规则还款</th>
##					<th data-options="field:'B_MODEL_SWITCH',width:150,formatter: BModelSwitch">是否开通B模式</th>
##					<th data-options="field:'DATAFILL_SWITCH',width:150,formatter: DataFillSwitch">是否允许资料补齐（100%）</th>
##					<th data-options="field:'SMS_SWITCH',width:150,formatter: SmsSwitch">是否开通短信业务</th>
##					<th data-options="field:'CREDIT_SWITCH',width:150,formatter: CreditSwitch">是否流程管理授信</th>
##					<th data-options="field:'SCAN_SWITCH',width:160,formatter: ScanSwitch">是否开通扫描件开机动车票业务</th>
##					<th data-options="field:'YINGYE_STATUS',width:160,formatter: yingyeStatus">直租不上牌是否开通营业员审核</th>
                </thead>
    		</tr>
         </table>
     </div>
  </body>
</html>