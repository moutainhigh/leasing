<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
"http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<mapper namespace="refundProcess">
<select id="getDbApplyList" parameterType="Map" resultType="Map">
SELECT * FROM (
	 SELECT RH.RE_ID,RH.RE_CODE,SU.SUP_SHORTNAME,RH.RE_MONEY,RH.RE_PROJECT_COUNT,
	        TO_CHAR(RH.RE_DATE,'YYYY-MM-DD') RE_DATE,RH.RE_PAYEE_TYPE,RH.RE_PAYEE_UNIT,
	        RH.RE_PAYEE_NAME,RH.RE_PAYEE_ADDRESS,RH.RE_PAYEE_BANK,RH.RE_PAYEE_ACCOUNT,
			RH.RE_PAYEE_BANK_ADDR,TO_CHAR(RH.RE_REAL_TIME,'YYYY-MM-DD') RE_REAL_TIME,
			getDictShortnameByCode('退款单状态',RH.RE_STATUS) RE_STATUS,TO_CHAR(RH.CREATE_TIME,'YYYY-MM-DD') CREATE_TIME,
			RH.RE_PAY_BANK,RH.RE_PAY_ACCOUNT,RH.CUST_ID,SU.SUP_ID,COM.BUSINESS_SECTOR,
		    getDictShortnameByCode('退款类型',RH.RE_TYPE) RE_TYPE,RH.JBPM_ID,ROWNUM ROWNO
	FROM FI_REFUND_HEAD  RH
	LEFT JOIN T_SYS_SUPPLIERS SU ON RH.CUST_ID = SU.SUP_ID
	LEFT JOIN T_SYS_COMPANY COM ON SU.COMPANY_ID = COM.COMPANY_ID
	WHERE RH.RE_TYPE IN ('1','2') AND RH.RE_STATUS = '0' 
	<if test="SUP_SHORTNAME != null and SUP_SHORTNAME !=''">AND SU.SUP_SHORTNAME LIKE '%${SUP_SHORTNAME}%'</if>
	<if test="RE_PAYEE_UNIT != null and RE_PAYEE_UNIT !=''">AND RH.RE_PAYEE_UNIT LIKE '%${RE_PAYEE_UNIT}%'</if>
	<if test="RE_DATE != null and RE_DATE !=''">AND RH.RE_DATE = TO_DATE(#{RE_DATE},'YYYY-MM-DD')</if>
	<if test="RE_TYPE !=null and RE_TYPE !=''">AND RH.RE_TYPE = #{RE_TYPE}</if>
	<if test="JBPM_ID !=null and JBPM_ID !=''">AND RH.JBPM_ID = #{JBPM_ID}</if>
	<if test="BUSINESS_SECTOR != null and BUSINESS_SECTOR !=''">AND COM.BUSINESS_SECTOR = #{BUSINESS_SECTOR}</if>
	  AND <![CDATA[ROWNUM <= #{PAGE_END}]]>
	)W WHERE W.ROWNO >= #{PAGE_BEGIN}
</select>

<select id="getDbApplyCount" parameterType="Map" resultType="Int">
SELECT COUNT(1) FROM (
	  SELECT RH.RE_ID,RH.RE_CODE,SU.SUP_SHORTNAME,RH.RE_MONEY,RH.RE_PROJECT_COUNT,
	         TO_CHAR(RH.RE_DATE,'YYYY-MM-DD') RE_DATE,RH.RE_PAYEE_TYPE,RH.RE_PAYEE_UNIT,
	         RH.RE_PAYEE_NAME,RH.RE_PAYEE_ADDRESS,RH.RE_PAYEE_BANK,RH.RE_PAYEE_ACCOUNT,
			 RH.RE_PAYEE_BANK_ADDR,TO_CHAR(RH.RE_REAL_TIME,'YYYY-MM-DD') RE_REAL_TIME,RH.RE_STATUS,TO_CHAR(RH.CREATE_TIME,'YYYY-MM-DD') CREATE_TIME,
			 RH.RE_PAY_BANK,RH.RE_PAY_ACCOUNT,RH.RE_TYPE,RH.CUST_ID,RH.JBPM_ID,SU.SUP_ID 
	    FROM FI_REFUND_HEAD  RH
	LEFT JOIN T_SYS_SUPPLIERS SU ON RH.CUST_ID = SU.SUP_ID
	LEFT JOIN T_SYS_COMPANY COM ON SU.COMPANY_ID = COM.COMPANY_ID
	WHERE RH.RE_TYPE IN ('1','2') AND RH.RE_STATUS = '0' 
    <if test="SUP_SHORTNAME != null and SUP_SHORTNAME !=''">AND SU.SUP_SHORTNAME LIKE '%${SUP_SHORTNAME}%'</if>
	<if test="RE_PAYEE_UNIT != null and RE_PAYEE_UNIT !=''">AND RH.RE_PAYEE_UNIT LIKE '%${RE_PAYEE_UNIT}%'</if>
	<if test="RE_DATE != null and RE_DATE !=''">AND RH.RE_DATE = TO_DATE(#{RE_DATE},'YYYY-MM-DD')</if>
	<if test="RE_TYPE !=null and RE_TYPE !=''">AND RH.RE_TYPE = #{RE_TYPE}</if>
	<if test="JBPM_ID !=null and JBPM_ID !=''">AND RH.JBPM_ID = #{JBPM_ID}</if>
	<if test="BUSINESS_SECTOR != null and BUSINESS_SECTOR !=''">AND COM.BUSINESS_SECTOR = #{BUSINESS_SECTOR}</if>
)W
</select>
</mapper>