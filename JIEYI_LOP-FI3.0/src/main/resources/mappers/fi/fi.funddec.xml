<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
"http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<mapper namespace="fi.funddec">
	
	<select id="getPageList" parameterType="map" resultType="map">
	SELECT T2.* FROM ( SELECT T1.*,ROWNUM RN FROM (
		SELECT T.FUND_ID,
		       T.FUND_FUNDCODE,
		       T.FUND_COMENAME,
		       T.FUND_ACCEPT_NAME,
		       T.FUND_RECEIVE_MONEY,
		       T.FUND_CLIENT_ID,
		       TO_CHAR(T.CREATE_DATE,'YYYY-MM-DD') CREATE_DATE,
		       T.FUND_DOCKET,
		       T.FUND_PIDENTIFY_PERSON,
		       T.FUND_CLIENT_NAME
		  FROM FI_FUND T
		 WHERE T.FUND_STATUS = 0 and T.FUND_NOTDECO_STATE !=7 AND (T.FUND_TYPE =2 or T.FUND_TYPE is null)
		 <if test="FUND_FUNDCODE != null and FUND_FUNDCODE != ''">AND FUND_FUNDCODE LIKE '%${FUND_FUNDCODE}%'</if>
		 <if test="FUND_COMENAME != null and FUND_COMENAME != ''">AND FUND_COMENAME LIKE '%${FUND_COMENAME}%'</if>
		 <if test="FUND_ACCEPT_NAME != null and FUND_ACCEPT_NAME != ''">AND FUND_ACCEPT_NAME LIKE '%${FUND_ACCEPT_NAME}%'</if>
		 <if test="FUND_CLIENT_NAME != null and FUND_CLIENT_NAME != ''">AND FUND_CLIENT_NAME LIKE '%${FUND_CLIENT_NAME}%'</if>
		 <if test="FUND_RECEIVE_MONEY_START != null and FUND_RECEIVE_MONEY_START != ''">AND FUND_RECEIVE_MONEY >= ${FUND_RECEIVE_MONEY_START}</if>
		 <if test="FUND_RECEIVE_MONEY_END != null and FUND_RECEIVE_MONEY_END != ''">AND FUND_RECEIVE_MONEY &lt;= ${FUND_RECEIVE_MONEY_END}</if>
		ORDER BY CREATE_DATE DESC
	 ) T1 WHERE ROWNUM &lt;=#{PAGE_END} ) t2 WHERE t2.RN>=#{PAGE_BEGIN}
	</select>
	
	<select id="getPageCount" parameterType="map" resultType="int">
	SELECT COUNT(1) FROM FI_FUND T
	WHERE T.FUND_STATUS = 0  and T.FUND_NOTDECO_STATE !=7 AND (T.FUND_TYPE =2 or T.FUND_TYPE is null)
	 <if test="FUND_FUNDCODE != null and FUND_FUNDCODE != ''">AND FUND_FUNDCODE LIKE '%${FUND_FUNDCODE}%'</if>
	 <if test="FUND_COMENAME != null and FUND_COMENAME != ''">AND FUND_COMENAME LIKE '%${FUND_COMENAME}%'</if>
	 <if test="FUND_ACCEPT_NAME != null and FUND_ACCEPT_NAME != ''">AND FUND_ACCEPT_NAME LIKE '%${FUND_ACCEPT_NAME}%'</if>
	 <if test="FUND_CLIENT_NAME != null and FUND_CLIENT_NAME != ''">AND FUND_CLIENT_NAME LIKE '%${FUND_CLIENT_NAME}%'</if>
	 <if test="FUND_RECEIVE_MONEY_START != null and FUND_RECEIVE_MONEY_START != ''">AND FUND_RECEIVE_MONEY >= ${FUND_RECEIVE_MONEY_START}</if>
	 <if test="FUND_RECEIVE_MONEY_END != null and FUND_RECEIVE_MONEY_END != ''">AND FUND_RECEIVE_MONEY &lt;= ${FUND_RECEIVE_MONEY_END}</if>
	</select>
	
	
	<select id="getSqkPageList" parameterType="map" resultType="map">
	SELECT T2.* FROM ( SELECT T1.*,ROWNUM RN FROM (
		SELECT T.FUND_ID,
		       T.FUND_FUNDCODE,
		       T.FUND_COMENAME,
		       T.FUND_ACCEPT_NAME,
		       T.FUND_RECEIVE_MONEY,
		       T.FUND_CLIENT_ID,
		       TO_CHAR(T.CREATE_DATE,'YYYY-MM-DD') CREATE_DATE,
		       T.FUND_DOCKET,
		       T.FUND_PIDENTIFY_PERSON,
		       T.FUND_CLIENT_NAME
		  FROM FI_FUND T
		 WHERE T.FUND_STATUS = 0 and T.FUND_NOTDECO_STATE !=7 AND T.FUND_TYPE=1
		 <if test="FUND_FUNDCODE != null and FUND_FUNDCODE != ''">AND FUND_FUNDCODE LIKE '%${FUND_FUNDCODE}%'</if>
		 <if test="FUND_COMENAME != null and FUND_COMENAME != ''">AND FUND_COMENAME LIKE '%${FUND_COMENAME}%'</if>
		 <if test="FUND_ACCEPT_NAME != null and FUND_ACCEPT_NAME != ''">AND FUND_ACCEPT_NAME LIKE '%${FUND_ACCEPT_NAME}%'</if>
		 <if test="FUND_CLIENT_NAME != null and FUND_CLIENT_NAME != ''">AND FUND_CLIENT_NAME LIKE '%${FUND_CLIENT_NAME}%'</if>
		 <if test="FUND_RECEIVE_MONEY_START != null and FUND_RECEIVE_MONEY_START != ''">AND FUND_RECEIVE_MONEY >= ${FUND_RECEIVE_MONEY_START}</if>
		 <if test="FUND_RECEIVE_MONEY_END != null and FUND_RECEIVE_MONEY_END != ''">AND FUND_RECEIVE_MONEY &lt;= ${FUND_RECEIVE_MONEY_END}</if>
		ORDER BY CREATE_DATE DESC
	 ) T1 WHERE ROWNUM &lt;=#{PAGE_END} ) t2 WHERE t2.RN>=#{PAGE_BEGIN}
	</select>
	
	<select id="getSqkPageCount" parameterType="map" resultType="int">
	SELECT COUNT(1) FROM FI_FUND T
	WHERE T.FUND_STATUS = 0  and T.FUND_NOTDECO_STATE !=7 AND T.FUND_TYPE=1
	 <if test="FUND_FUNDCODE != null and FUND_FUNDCODE != ''">AND FUND_FUNDCODE LIKE '%${FUND_FUNDCODE}%'</if>
	 <if test="FUND_COMENAME != null and FUND_COMENAME != ''">AND FUND_COMENAME LIKE '%${FUND_COMENAME}%'</if>
	 <if test="FUND_ACCEPT_NAME != null and FUND_ACCEPT_NAME != ''">AND FUND_ACCEPT_NAME LIKE '%${FUND_ACCEPT_NAME}%'</if>
	 <if test="FUND_CLIENT_NAME != null and FUND_CLIENT_NAME != ''">AND FUND_CLIENT_NAME LIKE '%${FUND_CLIENT_NAME}%'</if>
	 <if test="FUND_RECEIVE_MONEY_START != null and FUND_RECEIVE_MONEY_START != ''">AND FUND_RECEIVE_MONEY >= ${FUND_RECEIVE_MONEY_START}</if>
	 <if test="FUND_RECEIVE_MONEY_END != null and FUND_RECEIVE_MONEY_END != ''">AND FUND_RECEIVE_MONEY &lt;= ${FUND_RECEIVE_MONEY_END}</if>
	</select>
	
	
	<select id="getDFPageList" parameterType="map" resultType="map">
	SELECT T2.* FROM ( SELECT T1.*,ROWNUM RN FROM (
		SELECT T.FUND_ID,
		       T.FUND_FUNDCODE,
		       T.FUND_COMENAME,
		       T.FUND_ACCEPT_NAME,
		       T.FUND_RECEIVE_MONEY,
		       T.FUND_CLIENT_ID,
		       TO_CHAR(T.CREATE_DATE,'YYYY-MM-DD') CREATE_DATE,
		       T.FUND_DOCKET,
		       T.FUND_PIDENTIFY_PERSON,
		       T.FUND_CLIENT_NAME
		  FROM FI_FUND T
		 WHERE T.FUND_STATUS = 0 and T.FUND_NOTDECO_STATE !=7 AND (T.FUND_TYPE =2 or T.FUND_TYPE is null) and T.FUND_CLIENT_NAME is null
		 <if test="FUND_FUNDCODE != null and FUND_FUNDCODE != ''">AND FUND_FUNDCODE LIKE '%${FUND_FUNDCODE}%'</if>
		 <if test="FUND_COMENAME != null and FUND_COMENAME != ''">AND FUND_COMENAME LIKE '%${FUND_COMENAME}%'</if>
		 <if test="FUND_ACCEPT_NAME != null and FUND_ACCEPT_NAME != ''">AND FUND_ACCEPT_NAME LIKE '%${FUND_ACCEPT_NAME}%'</if>
		 <if test="FUND_CLIENT_NAME != null and FUND_CLIENT_NAME != ''">AND FUND_CLIENT_NAME LIKE '%${FUND_CLIENT_NAME}%'</if>
		 <if test="FUND_RECEIVE_MONEY_START != null and FUND_RECEIVE_MONEY_START != ''">AND FUND_RECEIVE_MONEY >= ${FUND_RECEIVE_MONEY_START}</if>
		 <if test="FUND_RECEIVE_MONEY_END != null and FUND_RECEIVE_MONEY_END != ''">AND FUND_RECEIVE_MONEY &lt;= ${FUND_RECEIVE_MONEY_END}</if>
		ORDER BY CREATE_DATE DESC
	 ) T1 WHERE ROWNUM &lt;=#{PAGE_END} ) t2 WHERE t2.RN>=#{PAGE_BEGIN}
	</select>
	
	<select id="getDFPageCount" parameterType="map" resultType="int">
	SELECT COUNT(1) FROM FI_FUND T
	WHERE T.FUND_STATUS = 0  and T.FUND_NOTDECO_STATE !=7 AND (T.FUND_TYPE =2 or T.FUND_TYPE is null) and T.FUND_CLIENT_NAME is null
	 <if test="FUND_FUNDCODE != null and FUND_FUNDCODE != ''">AND FUND_FUNDCODE LIKE '%${FUND_FUNDCODE}%'</if>
	 <if test="FUND_COMENAME != null and FUND_COMENAME != ''">AND FUND_COMENAME LIKE '%${FUND_COMENAME}%'</if>
	 <if test="FUND_ACCEPT_NAME != null and FUND_ACCEPT_NAME != ''">AND FUND_ACCEPT_NAME LIKE '%${FUND_ACCEPT_NAME}%'</if>
	 <if test="FUND_CLIENT_NAME != null and FUND_CLIENT_NAME != ''">AND FUND_CLIENT_NAME LIKE '%${FUND_CLIENT_NAME}%'</if>
	 <if test="FUND_RECEIVE_MONEY_START != null and FUND_RECEIVE_MONEY_START != ''">AND FUND_RECEIVE_MONEY >= ${FUND_RECEIVE_MONEY_START}</if>
	 <if test="FUND_RECEIVE_MONEY_END != null and FUND_RECEIVE_MONEY_END != ''">AND FUND_RECEIVE_MONEY &lt;= ${FUND_RECEIVE_MONEY_END}</if>
	</select>
	
	<select id="selRenter" parameterType="Map" resultType="Map">
  SELECT FCC.ID,
         MAX(FCC.NAME) NAME,
         MAX(NVL(FCC.ID_CARD_NO, FCC.ORAGNIZATION_CODE)) IDCODE,
         WM_CONCAT(FPH.LEASE_CODE) LEASE_CODE
    FROM FIL_CUST_CLIENT FCC, FIL_PROJECT_HEAD FPH
   WHERE FCC.ID = FPH.CLIENT_ID
     AND FPH.LEASE_CODE IS NOT NULL
	   <if test="NAME != null and NAME != ''">AND FCC.NAME LIKE '%${NAME}%'</if>
	   <if test="LEASE_CODE != null and LEASE_CODE != ''">AND FPH.LEASE_CODE LIKE '%${LEASE_CODE}%'</if> 
   GROUP BY FCC.ID
	</select>
	
	<update id="upClientId" parameterType="map">
		UPDATE FI_FUND T
		   SET FUND_CLIENT_ID             = #{FUND_CLIENT_ID},
		       T.FUND_CLIENT_NAME        =
		       (SELECT FCC.NAME FROM FIL_CUST_CLIENT FCC WHERE FCC.ID = #{FUND_CLIENT_ID}),
		       T.FUND_PIDENTIFY_PERSON    = #{USERNAME},
		       T.FUND_PIDENTIFY_PERSON_ID = #{USERID}
		 WHERE FUND_ID = #{FUND_ID}
	</update>
	
  <update id="resetRenter" parameterType="map">
		UPDATE FI_FUND T
		   SET FUND_CLIENT_ID             = '',
		       T.FUND_CLIENT_NAME        = '',
		       T.FUND_PIDENTIFY_PERSON    = '',
		       T.FUND_PIDENTIFY_PERSON_ID = ''
		 WHERE FUND_ID = #{FUND_ID}
	</update>
	
	
	<select id="getFund" parameterType="String" resultType="map">
SELECT T.FUND_ID,
       T.FUND_FUNDCODE,
       T.FUND_COMENAME,
       T.FUND_COMECODE,
       T.FUND_ACCEPT_NAME,
       T.FUND_ACCEPT_CODE,
       T.FUND_ACCEPT_DATE,
       T.FUND_RECEIVE_MONEY,
       T.FUND_CLIENT_ID,
       TO_CHAR(T.CREATE_DATE, 'YYYY-MM-DD') CREATE_DATE,
       T.FUND_DOCKET,
       T.FUND_CLIENT_NAME,
       T.FUND_STATUS,
       T.FUND_IMPORT_PERSON,
       T.FUND_IMPORT_DATE,
       T.FUND_PIDENTIFY_PERSON
  FROM FI_FUND T
 WHERE FUND_ID = #{ID}
	</select>
	
	<select id="getFrb" parameterType="string" resultType="map">
SELECT FRB.PAYLIST_CODE,
       FRB.BEGINNING_NUM,
       FRB.BEGINNING_NAME,
       FRB.BEGINNING_RECEIVE_DATA,
       FRB.BEGINNING_MONEY,
       FRB.BEGINNING_PAID,
       FRB.BEGINNING_MONEY-FRB.BEGINNING_PAID MONEY,
       FRB.ID FRBJ_ID
  FROM FI_R_BEGINNING_JOIN FRB, FI_FUND FF
 WHERE FF.FUND_CLIENT_ID = FRB.CUST_ID
   AND FF.FUND_ID = #{ID}
   AND FRB.BEGINNING_STATUS = 0
   AND FRB.ITEM_FLAG in (2,5)
   AND NVL(FRB.BEGINNING_MONEY,0)-NVL(FRB.BEGINNING_PAID,0)>0.0005
 ORDER BY FRB.PAYLIST_CODE,FRB.BEGINNING_NUM NULLS FIRST, FRB.BEGINNING_RECEIVE_DATA
	</select>
	
		<select id="getDFFrb" parameterType="string" resultType="map">
SELECT FRB.PAYLIST_CODE,
       FRB.BEGINNING_NUM,
       FRB.BEGINNING_NAME,
       FRB.BEGINNING_RECEIVE_DATA,
       FRB.BEGINNING_MONEY,
       FRB.BEGINNING_PAID,
       FRB.BEGINNING_MONEY-FRB.BEGINNING_PAID MONEY,
       FRB.ID FRBJ_ID
  FROM FI_R_BEGINNING_JOIN FRB
 WHERE last_day(sysdate)>=FRB.BEGINNING_RECEIVE_DATA
   AND FRB.BEGINNING_STATUS = 0
   AND FRB.ITEM_FLAG in (2,5)
   AND NVL(FRB.BEGINNING_MONEY,0)-NVL(FRB.BEGINNING_PAID,0)>0.0005
 ORDER BY FRB.PAYLIST_CODE,FRB.BEGINNING_NUM NULLS FIRST, FRB.BEGINNING_RECEIVE_DATA
	</select>
	
		<select id="getSQKFrb" parameterType="string" resultType="map">
SELECT FRB.PAYLIST_CODE,
       FRB.BEGINNING_NUM,
       FRB.BEGINNING_NAME,
       FRB.BEGINNING_RECEIVE_DATA,
       FRB.BEGINNING_MONEY,
       FRB.BEGINNING_PAID,
       FRB.BEGINNING_MONEY-FRB.BEGINNING_PAID MONEY,
       FRB.ID FRBJ_ID
  FROM FI_R_BEGINNING_JOIN FRB, FI_FUND FF
 WHERE FF.FUND_CLIENT_ID = FRB.CUST_ID
   AND FF.FUND_ID = #{ID}
   AND FF.FUND_TYPE=1
   AND FRB.BEGINNING_STATUS = 0
   AND FRB.ITEM_FLAG=1
   AND NVL(FRB.BEGINNING_MONEY,0)-NVL(FRB.BEGINNING_PAID,0)>0.0005
   AND FRB.IS_DIFFERENCE in (0,5)
 ORDER BY FRB.PAYLIST_CODE,FRB.BEGINNING_NUM NULLS FIRST, FRB.BEGINNING_RECEIVE_DATA
	</select>
	
	<update id="upFundStatus" parameterType="map">
		UPDATE FI_FUND T SET FUND_ID = #{FUND_ID}
			<if test="FUND_STATUS != null">,T.FUND_STATUS = #{FUND_STATUS}</if>
			<if test="FUND_DECOMPOUND_PERSON_ID != null">,T.FUND_DECOMPOUND_PERSON_ID = #{FUND_DECOMPOUND_PERSON_ID}</if>
			<if test="FUND_DECOMPOUND_PERSON != null">,T.FUND_DECOMPOUND_PERSON = #{FUND_DECOMPOUND_PERSON}</if>
			<if test="FUND_DECOMPOUND_DATE != null">,T.FUND_DECOMPOUND_DATE = #{FUND_DECOMPOUND_DATE}</if>
	     WHERE FUND_ID = #{FUND_ID}
	       AND FUND_STATUS = 0
	</update>
	
	<update id="upFundStatusED" parameterType="map">
		UPDATE FI_FUND T SET FUND_ID = #{FUND_ID}
			<if test="FUND_STATUS != null">,T.FUND_STATUS = #{FUND_STATUS}</if>
			<if test="FUND_SY_MONEY != null">,T.FUND_SY_MONEY = #{FUND_SY_MONEY}</if>
	     WHERE FUND_ID = #{FUND_ID}
	</update>
	
	<update id="upBeginning" parameterType="Map">
UPDATE FI_R_BEGINNING T
   SET T.BEGINNING_PAID = NVL(T.BEGINNING_PAID,0)+${MONEYCURR}
       <if test="FUND_ACCEPT_DATE != null and FUND_ACCEPT_DATE != ''">,REALITY_TIME = #{FUND_ACCEPT_DATE}</if>
 WHERE T.PAYLIST_CODE = #{PAYLIST_CODE}
	<if test="BEGINNING_NUM != null">AND T.BEGINNING_NUM = #{BEGINNING_NUM}</if>
   AND T.BEGINNING_NAME = #{BEGINNING_NAME}
	</update>
	<select id="getBillPageList" parameterType="map" resultType="map">
	SELECT T2.* FROM ( SELECT T1.*,ROWNUM RN FROM (
		SELECT T.FUND_ID,
		       T.FUND_FUNDCODE,
		       T.FUND_COMENAME,
		       T.FUND_ACCEPT_NAME,
		       T.FUND_RECEIVE_MONEY,
		       T.FUND_CLIENT_ID,
		       TO_CHAR(T.CREATE_DATE,'YYYY-MM-DD') CREATE_DATE,
		       T.FUND_DOCKET,
		       T.FUND_PIDENTIFY_PERSON,
		       T.FUND_CLIENT_NAME
		  FROM FI_FUND T
		 WHERE T.FUND_STATUS = 99 and T.FUND_NOTDECO_STATE !=7 AND (T.FUND_TYPE =2 or T.FUND_TYPE is null)
		 <if test="FUND_FUNDCODE != null and FUND_FUNDCODE != ''">AND FUND_FUNDCODE LIKE '%${FUND_FUNDCODE}%'</if>
		 <if test="FUND_COMENAME != null and FUND_COMENAME != ''">AND FUND_COMENAME LIKE '%${FUND_COMENAME}%'</if>
		 <if test="FUND_ACCEPT_NAME != null and FUND_ACCEPT_NAME != ''">AND FUND_ACCEPT_NAME LIKE '%${FUND_ACCEPT_NAME}%'</if>
		 <if test="FUND_CLIENT_NAME != null and FUND_CLIENT_NAME != ''">AND FUND_CLIENT_NAME LIKE '%${FUND_CLIENT_NAME}%'</if>
		 <if test="FUND_RECEIVE_MONEY_START != null and FUND_RECEIVE_MONEY_START != ''">AND FUND_RECEIVE_MONEY >= ${FUND_RECEIVE_MONEY_START}</if>
		 <if test="FUND_RECEIVE_MONEY_END != null and FUND_RECEIVE_MONEY_END != ''">AND FUND_RECEIVE_MONEY &lt;= ${FUND_RECEIVE_MONEY_END}</if>
		ORDER BY CREATE_DATE DESC
	 ) T1 WHERE ROWNUM &lt;=#{PAGE_END} ) t2 WHERE t2.RN>=#{PAGE_BEGIN}
	</select>
	
	<select id="getBillPageCount" parameterType="map" resultType="int">
	SELECT COUNT(1) FROM FI_FUND T
	WHERE T.FUND_STATUS = 99  and T.FUND_NOTDECO_STATE !=7 AND (T.FUND_TYPE =2 or T.FUND_TYPE is null)
	 <if test="FUND_FUNDCODE != null and FUND_FUNDCODE != ''">AND FUND_FUNDCODE LIKE '%${FUND_FUNDCODE}%'</if>
	 <if test="FUND_COMENAME != null and FUND_COMENAME != ''">AND FUND_COMENAME LIKE '%${FUND_COMENAME}%'</if>
	 <if test="FUND_ACCEPT_NAME != null and FUND_ACCEPT_NAME != ''">AND FUND_ACCEPT_NAME LIKE '%${FUND_ACCEPT_NAME}%'</if>
	 <if test="FUND_CLIENT_NAME != null and FUND_CLIENT_NAME != ''">AND FUND_CLIENT_NAME LIKE '%${FUND_CLIENT_NAME}%'</if>
	 <if test="FUND_RECEIVE_MONEY_START != null and FUND_RECEIVE_MONEY_START != ''">AND FUND_RECEIVE_MONEY >= ${FUND_RECEIVE_MONEY_START}</if>
	 <if test="FUND_RECEIVE_MONEY_END != null and FUND_RECEIVE_MONEY_END != ''">AND FUND_RECEIVE_MONEY &lt;= ${FUND_RECEIVE_MONEY_END}</if>
	</select>
	<update id="TransferredCredit" parameterType="map">
		UPDATE FI_FUND SET FUND_STATUS=#{FUND_STATUS} WHERE FUND_ID=#{FUND_ID}
	</update>
</mapper>