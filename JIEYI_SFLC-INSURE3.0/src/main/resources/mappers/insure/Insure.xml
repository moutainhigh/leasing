<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper
PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
"http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<mapper namespace="Insure">
	<select id="getAllInsure"  parameterType="java.util.Map" resultType="java.util.Map">
		SELECT * FROM (SELECT  CC.*,ROWNUM ROWNO FROM (
			SELECT fph.pro_code,--项目id
			fph.lease_topric,--租赁物总价值
			fph.lease_term,--租赁总期数
			fph.lease_period,--租赁周期
			to_char(fph.deliver_date, 'YYYY-MM-DD')deliver_date,--预计起租日
			tt.ID,--设备id
			tt.unit_price,--设备单价
			tt.insure_money,--保险费
			tt.COMPANY_NAME,--厂商
			tt.SUPPLIERS_NAME,--供应商
			tt.PRODUCT_NAME,--设备名称
			tt.SPEC_NAME,--型号
			tt.WHOLE_ENGINE_CODE,--出厂编号
			tt.CERTIFICATE_DATE,--出厂日期
			tt.ENGINE_TYPE,--发动机编号
			tt.CAR_SYMBOL,--车架号
			(SELECT t.name FROM t_sys_area t where t.id = fph.area_id ) area,--使用区域
			(SELECT pd.item_money FROM fil_rent_plan_detail pd,fil_rent_plan_head ph where pd.pay_id = ph.id and ph.project_id = fph.id and pd.item_name like '%保险%') money,--保险费
			(SELECT fcc.name FROM FIL_CUST_CLIENT fcc where fcc.id = fph.client_id )name,--承租人
			(SELECT t.value_str FROM fil_project_scheme t where t.key_name_zn like '%盗抢险%'and t.project_id = fph.id ) PILFER--强盗险
			FROM fil_project_head fph,fil_project_scheme fps ,
			(SELECT FPE.ID,--设备id
               fpe.project_id,
			   fpe.whether_create_insure,
			   fpe.unit_price,--设备单价
			   fpe.insure_money,--保险费
               TSC.COMPANY_NAME COMPANY_NAME,--厂商
               TSS.SUP_SHORTNAME SUPPLIERS_NAME,--供应商
               TP.PRODUCT_NAME PRODUCT_NAME,--设备名称
               TPT.NAME SPEC_NAME,--型号
               FPE.WHOLE_ENGINE_CODE WHOLE_ENGINE_CODE,--出厂编号
               to_char(FPE.CERTIFICATE_DATE, 'YYYY-MM-DD') CERTIFICATE_DATE,--出厂日期
               FPE.ENGINE_TYPE ENGINE_TYPE,--发动机编号
               FPE.CAR_SYMBOL CAR_SYMBOL--车架号
        FROM FIL_PROJECT_EQUIPMENT FPE
        LEFT JOIN T_SYS_COMPANY TSC
          ON FPE.COMPANY_ID = TSC.COMPANY_ID
        LEFT JOIN T_SYS_SUPPLIERS TSS
          ON FPE.SUPPLIERS_ID = TSS.SUP_ID
        LEFT JOIN T_PRODUCT TP
          ON FPE.PRODUCT_ID = TP.PRODUCT_ID
        LEFT JOIN T_PRODUCT_TYPE TPT
          ON FPE.SPEC_ID = TPT.ID
       WHERE FPE.STATUS = 0)tt
			where fph.id = fps.project_id and fps.value_str = '3InsuranceType' and tt.whether_create_insure is null --and fph.status=20 
			and fph.id=tt.project_id
		) CC  
		<where>
			<if test="PRO_CODE!=null and PRO_CODE!=''">AND CC.PRO_CODE LIKE '%'||#{PRO_CODE}||'%'</if>
			<if test="SUPPLIERS_NAME!=null and SUPPLIERS_NAME!=''">AND CC.SUPPLIERS_NAME LIKE '%'||#{SUPPLIERS_NAME}||'%'</if>
			<if test="NAME!=null and NAME!=''">AND CC.NAME LIKE '%'||#{NAME}||'%'</if>
			<if test="WHOLE_ENGINE_CODE!=null and WHOLE_ENGINE_CODE!=''">AND CC.WHOLE_ENGINE_CODE LIKE '%'||#{WHOLE_ENGINE_CODE}||'%'</if>
			<if test="PRODUCT_NAME!=null and PRODUCT_NAME!=''">AND CC.PRODUCT_NAME LIKE '%'||#{PRODUCT_NAME}||'%'</if>
			<if test="COMPANY_NAME!=null and COMPANY_NAME!=''">AND CC.COMPANY_NAME LIKE '%'||#{COMPANY_NAME}||'%'</if>
			<if test="B_DELIVER_DATE!=null and B_DELIVER_DATE!=''">AND CC.DELIVER_DATE >= #{B_DELIVER_DATE}</if>
			<if test="E_DELIVER_DATE!=null and E_DELIVER_DATE!=''">AND CC.DELIVER_DATE &lt;= #{E_DELIVER_DATE}</if>
		</where>
		ORDER BY CC.DELIVER_DATE
	) CCC  WHERE CCC.ROWNO BETWEEN #{PAGE_BEGIN} AND #{PAGE_END}	
	</select>
	<select id="getAllInsure_count"  parameterType="java.util.Map" resultType="int">
		SELECT  count(*) FROM (
			SELECT fph.pro_code,--项目id
			fph.lease_topric,--租赁物总价值
			fph.lease_term,--租赁总期数
			fph.lease_period,--租赁周期
			to_char(fph.deliver_date, 'YYYY-MM-DD')deliver_date,--预计起租日
			tt.ID,--设备id
			tt.unit_price,--设备单价
			tt.insure_money,--保险费
			tt.COMPANY_NAME,--厂商
			tt.SUPPLIERS_NAME,--供应商
			tt.PRODUCT_NAME,--设备名称
			tt.SPEC_NAME,--型号
			tt.WHOLE_ENGINE_CODE,--出厂编号
			tt.CERTIFICATE_DATE,--出厂日期
			tt.ENGINE_TYPE,--发动机编号
			tt.CAR_SYMBOL,--车架号
			(SELECT t.name FROM t_sys_area t where t.id = fph.area_id ) area,--使用区域
			(SELECT pd.item_money FROM fil_rent_plan_detail pd,fil_rent_plan_head ph where pd.pay_id = ph.id and ph.project_id = fph.id and pd.item_name like '%保险%') money,--保险费
			(SELECT fcc.name FROM FIL_CUST_CLIENT fcc where fcc.id = fph.client_id )name,--承租人
			(SELECT t.value_str FROM fil_project_scheme t where t.key_name_zn like '%盗抢险%'and t.project_id = fph.id ) PILFER--强盗险
			FROM fil_project_head fph,fil_project_scheme fps ,
			(SELECT FPE.ID,--设备id
               fpe.project_id,
			   fpe.whether_create_insure,
			   fpe.unit_price,
			   fpe.insure_money,--保险费
               TSC.COMPANY_NAME COMPANY_NAME,--厂商
               TSS.SUP_SHORTNAME SUPPLIERS_NAME,--供应商
               TP.PRODUCT_NAME PRODUCT_NAME,--设备名称
               TPT.NAME SPEC_NAME,--型号
               FPE.WHOLE_ENGINE_CODE WHOLE_ENGINE_CODE,--出厂编号
               to_char(FPE.CERTIFICATE_DATE, 'YYYY-MM-DD') CERTIFICATE_DATE,--出厂日期
               FPE.ENGINE_TYPE ENGINE_TYPE,--发动机编号
               FPE.CAR_SYMBOL CAR_SYMBOL--车架号
        FROM FIL_PROJECT_EQUIPMENT FPE
        LEFT JOIN T_SYS_COMPANY TSC
          ON FPE.COMPANY_ID = TSC.COMPANY_ID
        LEFT JOIN T_SYS_SUPPLIERS TSS
          ON FPE.SUPPLIERS_ID = TSS.SUP_ID
        LEFT JOIN T_PRODUCT TP
          ON FPE.PRODUCT_ID = TP.PRODUCT_ID
        LEFT JOIN T_PRODUCT_TYPE TPT
          ON FPE.SPEC_ID = TPT.ID
       WHERE FPE.STATUS = 0)tt
			where fph.id = fps.project_id and fps.value_str = '3InsuranceType' and tt.whether_create_insure is null --and fph.status=20 
			and fph.id=tt.project_id
		) CC  
		<where>
			<if test="PRO_CODE!=null and PRO_CODE!=''">AND CC.PRO_CODE LIKE '%'||#{PRO_CODE}||'%'</if>
			<if test="SUPPLIERS_NAME!=null and SUPPLIERS_NAME!=''">AND CC.SUPPLIERS_NAME LIKE '%'||#{SUPPLIERS_NAME}||'%'</if>
			<if test="NAME!=null and NAME!=''">AND CC.NAME LIKE '%'||#{NAME}||'%'</if>
			<if test="WHOLE_ENGINE_CODE!=null and WHOLE_ENGINE_CODE!=''">AND CC.WHOLE_ENGINE_CODE LIKE '%'||#{WHOLE_ENGINE_CODE}||'%'</if>
			<if test="PRODUCT_NAME!=null and PRODUCT_NAME!=''">AND CC.PRODUCT_NAME LIKE '%'||#{PRODUCT_NAME}||'%'</if>
			<if test="COMPANY_NAME!=null and COMPANY_NAME!=''">AND CC.COMPANY_NAME LIKE '%'||#{COMPANY_NAME}||'%'</if>
			<if test="B_DELIVER_DATE!=null and B_DELIVER_DATE!=''">AND CC.DELIVER_DATE >= #{B_DELIVER_DATE}</if>
			<if test="E_DELIVER_DATE!=null and E_DELIVER_DATE!=''">AND CC.DELIVER_DATE &lt;= #{E_DELIVER_DATE}</if>
		</where>
	</select>
	<select id="getAllInsureEXCEL"  parameterType="java.util.Map" resultType="java.util.Map">
		SELECT  * FROM (
			SELECT fph.pro_code,--项目id
			fph.lease_topric,--租赁物总价值
			fph.lease_term,--租赁总期数
			fph.lease_period,--租赁周期
			to_char(fph.deliver_date, 'YYYY-MM-DD')deliver_date,--预计起租日
			tt.ID,--设备id
			tt.unit_price,--设备单价
			tt.insure_money,--保险费
			tt.COMPANY_NAME,--厂商
			tt.SUPPLIERS_NAME,--供应商
			tt.PRODUCT_NAME,--设备名称
			tt.SPEC_NAME,--型号
			tt.WHOLE_ENGINE_CODE,--出厂编号
			tt.CERTIFICATE_DATE,--出厂日期
			tt.ENGINE_TYPE,--发动机编号
			tt.CAR_SYMBOL,--车架号
			(SELECT t.name FROM t_sys_area t where t.id = fph.area_id ) area,--使用区域
			(SELECT pd.item_money FROM fil_rent_plan_detail pd,fil_rent_plan_head ph where pd.pay_id = ph.id and ph.project_id = fph.id and pd.item_name like '%保险%') money,--保险费
			(SELECT fcc.name FROM FIL_CUST_CLIENT fcc where fcc.id = fph.client_id )name,--承租人
			(SELECT t.value_str FROM fil_project_scheme t where t.key_name_zn like '%盗抢险%'and t.project_id = fph.id ) PILFER--强盗险
			FROM fil_project_head fph,fil_project_scheme fps ,
			(SELECT FPE.ID,--设备id
               fpe.project_id,
			   fpe.whether_create_insure,
			   fpe.unit_price,--设备单价
			   fpe.insure_money,--保险费
               TSC.COMPANY_NAME COMPANY_NAME,--厂商
               TSS.SUP_SHORTNAME SUPPLIERS_NAME,--供应商
               TP.PRODUCT_NAME PRODUCT_NAME,--设备名称
               TPT.NAME SPEC_NAME,--型号
               FPE.WHOLE_ENGINE_CODE WHOLE_ENGINE_CODE,--出厂编号
               to_char(FPE.CERTIFICATE_DATE, 'YYYY-MM-DD') CERTIFICATE_DATE,--出厂日期
               FPE.ENGINE_TYPE ENGINE_TYPE,--发动机编号
               FPE.CAR_SYMBOL CAR_SYMBOL--车架号
        FROM FIL_PROJECT_EQUIPMENT FPE
        LEFT JOIN T_SYS_COMPANY TSC
          ON FPE.COMPANY_ID = TSC.COMPANY_ID
        LEFT JOIN T_SYS_SUPPLIERS TSS
          ON FPE.SUPPLIERS_ID = TSS.SUP_ID
        LEFT JOIN T_PRODUCT TP
          ON FPE.PRODUCT_ID = TP.PRODUCT_ID
        LEFT JOIN T_PRODUCT_TYPE TPT
          ON FPE.SPEC_ID = TPT.ID
       WHERE FPE.STATUS = 0)tt
			where fph.id = fps.project_id and fps.value_str = '3InsuranceType' and tt.whether_create_insure is null --and fph.status=20 
			and fph.id=tt.project_id
		) CC  
		<where>
			<if test="PRO_CODES!=null and PRO_CODES!=''">
				CC.ID in
                 <foreach item="ids" index="index" collection="PRO_CODES" open="(" separator="," close=")">  
				 #{ids}  
				 </foreach> 

			</if>
		</where>
	</select>
	
	<select id="queryAllProduct"  parameterType="java.util.Map" resultType="java.util.Map">
		SELECT t.product_name FROM T_PRODUCT t order by t.gxtime desc
	</select>
	<select id="queryAllCompany"  parameterType="java.util.Map" resultType="java.util.Map">
		SELECT t.company_name FROM T_SYS_COMPANY t order by t.create_time desc
	</select>
	<update  id="update_WHETHER_CREATE_INSURE" parameterType="Map" >
		update FIL_PROJECT_EQUIPMENT f set f.whether_create_insure='yes' where f.id in
		<if test="PRO_CODES!=null and PRO_CODES!=''">
                 <foreach item="ids" index="index" collection="PRO_CODES" open="(" separator="," close=")">  
				 #{ids}  
				 </foreach> 
		</if>
		<if test="PRO_CODES ==null or PRO_CODES ==''">
			(SELECT t.id FROM fil_project_equipment t where t.project_id in (select fph.id FROM fil_project_head fph,fil_project_scheme fps 
      		where fph.id = fps.project_id and fps.value_str = '3InsuranceType') and t.whether_create_insure is null)--and fph.status=20 
		</if>
	</update>
	
	<insert id="insert_insur_info" parameterType="Map" >
		insert into insur_info (id,PROJ_NO,status,insur_term,equip_price,proj_equip_id,unit_price,MONEY,prod_id,model_id,equip_sn,DELIVER_DATE,COMPANY_NAME,SUPPLIERS_NAME,
		CERTIFICATE_DATE,ENGINE_TYPE,CAR_SYMBOL,AREA,NAME,PILFER)
	      SELECT seq_insur_info.nextval, cc.* FROM (
	      SELECT fph.pro_code,--项目id
	      '申请',
		  fph.lease_term*fph.lease_period insur_term, --保单期限
	      fph.lease_topric,--租赁物总价值
	      tt.ID,--设备id
		  tt.unit_price,--设备单价
		  tt.insure_money,--保险费
	      tt.PRODUCT_NAME,--设备名称
	      tt.SPEC_NAME,--型号
	      tt.WHOLE_ENGINE_CODE,--出厂编号
		  to_char(fph.deliver_date, 'YYYY-MM-DD')deliver_date,--预计起租日
		  tt.COMPANY_NAME,--厂商
		  tt.SUPPLIERS_NAME,--供应商
		  tt.CERTIFICATE_DATE,--出厂日期
		  tt.ENGINE_TYPE,--发动机编号
		  tt.CAR_SYMBOL,--车架号
		  (SELECT t.name FROM t_sys_area t where t.id = fph.area_id ) area,--使用区域
	      (SELECT fcc.name FROM FIL_CUST_CLIENT fcc where fcc.id = fph.client_id )name,--承租人
		  (SELECT t.value_str FROM fil_project_scheme t where t.key_name_zn like '%盗抢险%'and t.project_id = fph.id ) PILFER--强盗险
		  FROM fil_project_head fph,fil_project_scheme fps ,
	      (SELECT FPE.ID,--设备id
               fpe.project_id,
			   fpe.whether_create_insure,
			   fpe.unit_price,--设备单价
			   fpe.insure_money,--保险费
               TSC.COMPANY_NAME COMPANY_NAME,--厂商
               TSS.SUP_SHORTNAME SUPPLIERS_NAME,--供应商
               TP.PRODUCT_NAME PRODUCT_NAME,--设备名称
               TPT.NAME SPEC_NAME,--型号
               FPE.WHOLE_ENGINE_CODE WHOLE_ENGINE_CODE,--出厂编号
               to_char(FPE.CERTIFICATE_DATE, 'YYYY-MM-DD') CERTIFICATE_DATE,--出厂日期
               FPE.ENGINE_TYPE ENGINE_TYPE,--发动机编号
               FPE.CAR_SYMBOL CAR_SYMBOL--车架号
        FROM FIL_PROJECT_EQUIPMENT FPE
        LEFT JOIN T_SYS_COMPANY TSC
          ON FPE.COMPANY_ID = TSC.COMPANY_ID
        LEFT JOIN T_SYS_SUPPLIERS TSS
          ON FPE.SUPPLIERS_ID = TSS.SUP_ID
        LEFT JOIN T_PRODUCT TP
          ON FPE.PRODUCT_ID = TP.PRODUCT_ID
        LEFT JOIN T_PRODUCT_TYPE TPT
          ON FPE.SPEC_ID = TPT.ID
       WHERE FPE.STATUS = 0)tt
	      where fph.id = fps.project_id and fps.value_str = '3InsuranceType' and tt.whether_create_insure is null --and fph.status=20 
	      and fph.id=tt.project_id
	    ) CC
		<where>
			<if test="PRO_CODES!=null and PRO_CODES!=''">
				CC.ID in
                 <foreach item="ids" index="index" collection="PRO_CODES" open="(" separator="," close=")">  
				 #{ids}  
				 </foreach> 

			</if>
		</where>
    </insert>
	<insert id="insert_insur_info2" parameterType="Map" >
		insert into insur_info (id,PROJ_NO,status,insur_term,equip_price,proj_equip_id,unit_price,MONEY,prod_id,model_id,equip_sn,DELIVER_DATE,COMPANY_NAME,SUPPLIERS_NAME,
		CERTIFICATE_DATE,ENGINE_TYPE,CAR_SYMBOL,AREA,NAME,PILFER,OPERATION_TYPE,LEASE_TERM)
	      SELECT seq_insur_info.nextval, cc.* FROM (
	      SELECT fph.pro_code,--项目id
	      '预约',
		  fph.lease_term*fph.lease_period insur_term, --保单期限
	      fph.lease_topric,--租赁物总价值
	      tt.ID,--设备id
		  tt.unit_price,--设备单价
		  tt.insure_money,--保险费
	      tt.PRODUCT_NAME,--设备名称
	      tt.SPEC_NAME,--型号
	      tt.WHOLE_ENGINE_CODE,--出厂编号
		  to_char(fph.deliver_date, 'YYYY-MM-DD')deliver_date,--预计起租日
		  tt.COMPANY_NAME,--厂商
		  tt.SUPPLIERS_NAME,--供应商
		  tt.CERTIFICATE_DATE,--出厂日期
		  tt.ENGINE_TYPE,--发动机编号
		  tt.CAR_SYMBOL,--车架号
		  (SELECT t.name FROM t_sys_area t where t.id = fph.area_id ) area,--使用区域
	      (SELECT fcc.name FROM FIL_CUST_CLIENT fcc where fcc.id = fph.client_id )name,--承租人
		  (SELECT t.value_str FROM fil_project_scheme t where t.key_name_zn like '%盗抢险%'and t.project_id = fph.id ) PILFER,--强盗险
		  'yes',
		  fph.lease_term*fph.lease_period LEASE_TERM
		  FROM fil_project_head fph,fil_project_scheme fps ,
	      (SELECT FPE.ID,--设备id
               fpe.project_id,
			   fpe.whether_create_insure,
			   fpe.unit_price,--设备单价
			   fpe.insure_money,--保险费
               TSC.COMPANY_NAME COMPANY_NAME,--厂商
               TSS.SUP_SHORTNAME SUPPLIERS_NAME,--供应商
               TP.PRODUCT_NAME PRODUCT_NAME,--设备名称
               TPT.NAME SPEC_NAME,--型号
               FPE.WHOLE_ENGINE_CODE WHOLE_ENGINE_CODE,--出厂编号
               to_char(FPE.CERTIFICATE_DATE, 'YYYY-MM-DD') CERTIFICATE_DATE,--出厂日期
               FPE.ENGINE_TYPE ENGINE_TYPE,--发动机编号
               FPE.CAR_SYMBOL CAR_SYMBOL--车架号
        FROM FIL_PROJECT_EQUIPMENT FPE
        LEFT JOIN T_SYS_COMPANY TSC
          ON FPE.COMPANY_ID = TSC.COMPANY_ID
        LEFT JOIN T_SYS_SUPPLIERS TSS
          ON FPE.SUPPLIERS_ID = TSS.SUP_ID
        LEFT JOIN T_PRODUCT TP
          ON FPE.PRODUCT_ID = TP.PRODUCT_ID
        LEFT JOIN T_PRODUCT_TYPE TPT
          ON FPE.SPEC_ID = TPT.ID
       WHERE FPE.STATUS = 0)tt
	      where fph.id = fps.project_id and fps.value_str in ('2InsuranceType','1InsuranceType') and tt.whether_create_insure is null --and fph.status=20 
	      and fph.id=tt.project_id
	    ) CC
		<where>
			<if test="PRO_CODES!=null and PRO_CODES!=''">
				CC.ID in
                 <foreach item="ids" index="index" collection="PRO_CODES" open="(" separator="," close=")">  
				 #{ids}  
				 </foreach> 

			</if>
		</where>
    </insert>
	<update  id="update_WHETHER_CREATE_INSURE3" parameterType="Map" >
		update FIL_PROJECT_EQUIPMENT f set f.whether_create_insure='yes' where f.id in
		<if test="PRO_CODES!=null and PRO_CODES!=''">
                 <foreach item="ids" index="index" collection="PRO_CODES" open="(" separator="," close=")">  
				 #{ids}  
				 </foreach> 
		</if>
		<if test="PRO_CODES ==null or PRO_CODES ==''">
			(SELECT t.id FROM fil_project_equipment t where t.project_id in (select fph.id FROM fil_project_head fph,fil_project_scheme fps 
      		where fph.id = fps.project_id and fps.value_str in ('2InsuranceType','1InsuranceType') ) and t.whether_create_insure is null)--and fph.status=20 
		</if>
	</update>
	
	<select id="insureCheckPage"  parameterType="java.util.Map" resultType="java.util.Map">
		SELECT * FROM (SELECT  CC.*,ROWNUM ROWNO FROM (
			SELECT t.id id1,t.proj_no pro_code,t.equip_price lease_topric,t.insur_term,t.deliver_date,t.UNIT_PRICE,
			t.proj_equip_id id,t.company_name,t.suppliers_name,t.prod_id PRODUCT_NAME,t.model_id SPEC_NAME,t.OPERATION_TYPE,
			t.equip_sn WHOLE_ENGINE_CODE,t.create_date,t.engine_type,t.car_symbol,t.area,t.money INSURE_MONEY,t.name,t.pilfer,
			t.insur_no,to_char(t.insur_date,'yyyy-mm-dd') insur_date,t.invoice_no,to_char(t.invoice_date,'yyyy-mm-dd') invoice_date
			,FPH.SUP_ID
			FROM INSUR_INFO T 
			LEFT JOIN FIL_PROJECT_HEAD FPH
			ON T.PROJ_NO = FPH.PRO_CODE
			where t.status = #{status}
			) CC  
			<where>
				<if test="SUP_TYPE !=null and SUP_TYPE !='' "> 
						AND SUP_ID = '${SUP_TYPE}'   --  数据权限   供应商只能查看本身数据
				</if>
				<if test="PRO_CODE!=null and PRO_CODE!=''">AND CC.PRO_CODE LIKE '%'||#{PRO_CODE}||'%'</if>
				<if test="SUPPLIERS_NAME!=null and SUPPLIERS_NAME!=''">AND CC.SUPPLIERS_NAME LIKE '%'||#{SUPPLIERS_NAME}||'%'</if>
				<if test="NAME!=null and NAME!=''">AND CC.NAME LIKE '%'||#{NAME}||'%'</if>
				<if test="WHOLE_ENGINE_CODE!=null and WHOLE_ENGINE_CODE!=''">AND CC.WHOLE_ENGINE_CODE LIKE '%'||#{WHOLE_ENGINE_CODE}||'%'</if>
				<if test="PRODUCT_NAME!=null and PRODUCT_NAME!=''">AND CC.PRODUCT_NAME LIKE '%'||#{PRODUCT_NAME}||'%'</if>
				<if test="COMPANY_NAME!=null and COMPANY_NAME!=''">AND CC.COMPANY_NAME LIKE '%'||#{COMPANY_NAME}||'%'</if>
				<if test="B_DELIVER_DATE!=null and B_DELIVER_DATE!=''">AND CC.DELIVER_DATE >= #{B_DELIVER_DATE}</if>
				<if test="E_DELIVER_DATE!=null and E_DELIVER_DATE!=''">AND CC.DELIVER_DATE &lt;= #{E_DELIVER_DATE}</if>
				<if test="OPERATION_TYPE!=null and OPERATION_TYPE!=''">AND CC.OPERATION_TYPE = #{OPERATION_TYPE}</if>
				<if test="OPERATION_TYPE==null or OPERATION_TYPE==''">AND CC.OPERATION_TYPE is null</if>
			</where>
			ORDER BY CC.DELIVER_DATE
		) CCC  WHERE CCC.ROWNO BETWEEN #{PAGE_BEGIN} AND #{PAGE_END}	
	</select>
	<select id="insureCheckPage_count"  parameterType="java.util.Map" resultType="int">
		SELECT count(*)  FROM (
			SELECT t.id id1,t.proj_no pro_code,t.equip_price lease_topric,t.insur_term,t.deliver_date,
			t.proj_equip_id id,t.company_name,t.suppliers_name,t.prod_id PRODUCT_NAME,t.model_id SPEC_NAME,t.OPERATION_TYPE,
			t.equip_sn WHOLE_ENGINE_CODE,t.create_date,t.engine_type,t.car_symbol,t.area,t.money,t.name,t.pilfer
			,FPH.SUP_ID
			FROM INSUR_INFO T 
			LEFT JOIN FIL_PROJECT_HEAD FPH
			ON T.PROJ_NO = FPH.PRO_CODE
			where t.status = #{status}
			) CC  
			<where>
				<if test="SUP_TYPE !=null and SUP_TYPE !='' "> 
						AND SUP_ID = '${SUP_TYPE}'   --  数据权限   供应商只能查看本身数据
				</if>
				<if test="PRO_CODE!=null and PRO_CODE!=''">AND CC.PRO_CODE LIKE '%'||#{PRO_CODE}||'%'</if>
				<if test="SUPPLIERS_NAME!=null and SUPPLIERS_NAME!=''">AND CC.SUPPLIERS_NAME LIKE '%'||#{SUPPLIERS_NAME}||'%'</if>
				<if test="NAME!=null and NAME!=''">AND CC.NAME LIKE '%'||#{NAME}||'%'</if>
				<if test="WHOLE_ENGINE_CODE!=null and WHOLE_ENGINE_CODE!=''">AND CC.WHOLE_ENGINE_CODE LIKE '%'||#{WHOLE_ENGINE_CODE}||'%'</if>
				<if test="PRODUCT_NAME!=null and PRODUCT_NAME!=''">AND CC.PRODUCT_NAME LIKE '%'||#{PRODUCT_NAME}||'%'</if>
				<if test="COMPANY_NAME!=null and COMPANY_NAME!=''">AND CC.COMPANY_NAME LIKE '%'||#{COMPANY_NAME}||'%'</if>
				<if test="B_DELIVER_DATE!=null and B_DELIVER_DATE!=''">AND CC.DELIVER_DATE >= #{B_DELIVER_DATE}</if>
				<if test="E_DELIVER_DATE!=null and E_DELIVER_DATE!=''">AND CC.DELIVER_DATE &lt;= #{E_DELIVER_DATE}</if>
				<if test="OPERATION_TYPE!=null and OPERATION_TYPE!=''">AND CC.OPERATION_TYPE = #{OPERATION_TYPE}</if>
				<if test="OPERATION_TYPE==null or OPERATION_TYPE==''">AND CC.OPERATION_TYPE is null</if>
			</where>
	</select>
	<select id="insureCheckPageEXCEL"  parameterType="java.util.Map" resultType="java.util.Map">
			SELECT *  FROM (
			SELECT t.proj_no pro_code,t.equip_price lease_topric,t.insur_term,t.deliver_date,t.UNIT_PRICE,
			t.proj_equip_id id,t.company_name,t.suppliers_name,t.prod_id PRODUCT_NAME,t.model_id SPEC_NAME,t.OPERATION_TYPE,
			t.equip_sn WHOLE_ENGINE_CODE,t.create_date,t.engine_type,t.car_symbol,t.area,t.money,t.name,t.pilfer
			,FPH.SUP_ID
			FROM INSUR_INFO T 
			LEFT JOIN FIL_PROJECT_HEAD FPH
			ON T.PROJ_NO = FPH.PRO_CODE
			where t.status = #{status_}
			) CC
		<where>
			<if test="SUP_TYPE !=null and SUP_TYPE !='' "> 
						AND SUP_ID = '${SUP_TYPE}'   --  数据权限   供应商只能查看本身数据
			</if>
			<if test="PRO_CODES!=null and PRO_CODES!=''">
				CC.ID in
                 <foreach item="ids" index="index" collection="PRO_CODES" open="(" separator="," close=")">  
				 #{ids}  
				 </foreach> 
			</if>
			<if test="OPERATION_TYPE!=null and OPERATION_TYPE!=''">AND CC.OPERATION_TYPE = #{OPERATION_TYPE}</if>
			<if test="OPERATION_TYPE==null or OPERATION_TYPE==''">AND CC.OPERATION_TYPE is null</if>
		</where>
	</select>
	<select id="insurePageEXCEL"  parameterType="java.util.Map" resultType="java.util.Map">
			SELECT *  FROM (
			SELECT t.proj_no pro_code,t.equip_price lease_topric,t.insur_term,t.deliver_date,t.UNIT_PRICE,
			t.id,t.company_name,t.suppliers_name,t.prod_id PRODUCT_NAME,t.model_id SPEC_NAME,t.OPERATION_TYPE,
			t.equip_sn WHOLE_ENGINE_CODE,t.create_date,t.engine_type,t.car_symbol,t.area,t.money,t.name,t.pilfer
			,FPH.SUP_ID
			FROM INSUR_INFO T 
			LEFT JOIN FIL_PROJECT_HEAD FPH
			ON T.PROJ_NO = FPH.PRO_CODE
			where t.status = #{status_}
			) CC
		<where>
			<if test="SUP_TYPE !=null and SUP_TYPE !='' "> 
						AND SUP_ID = '${SUP_TYPE}'   --  数据权限   供应商只能查看本身数据
			</if>
			<if test="PRO_CODES!=null and PRO_CODES!=''">
				CC.ID in
                 <foreach item="ids" index="index" collection="PRO_CODES" open="(" separator="," close=")">  
				 #{ids}  
				 </foreach> 
			</if>
			<if test="OPERATION_TYPE!=null and OPERATION_TYPE!=''">AND CC.OPERATION_TYPE = #{OPERATION_TYPE}</if>
			<if test="OPERATION_TYPE==null or OPERATION_TYPE==''">AND CC.OPERATION_TYPE is null</if>
		</where>
	</select>
	<update  id="update_WHETHER_CREATE_INSURE2" parameterType="Map" >
		update fil_project_equipment f set f.whether_create_insure='' where f.id in
		<if test="PRO_CODES!=null and PRO_CODES!=''">
                 <foreach item="ids" index="index" collection="PRO_CODES" open="(" separator="," close=")">  
				 #{ids}  
				 </foreach> 
		</if>
		<if test="PRO_CODES ==null or PRO_CODES ==''">
			(SELECT t.proj_equip_id FROM insur_info t where t.status = #{status_})
		</if>
	</update>
	
	<delete  id="delete_insur_info" parameterType="Map" >
		delete from insur_info f where f.proj_equip_id in
		<if test="PRO_CODES!=null and PRO_CODES!=''">
                 <foreach item="ids" index="index" collection="PRO_CODES" open="(" separator="," close=")">  
				 #{ids}  
				 </foreach> 
		</if>
		<if test="PRO_CODES ==null or PRO_CODES ==''">
			(SELECT t.proj_equip_id FROM insur_info t where t.status = #{status_} )
		</if>
	</delete>
	<!--改造下update_insur_info，使得修改状态可以重复调用
	<update  id="update_insur_info" parameterType="Map" >
		update insur_info f set f.status='预约' where f.proj_equip_id in
		<if test="PRO_CODES!=null and PRO_CODES!=''">
                 <foreach item="ids" index="index" collection="PRO_CODES" open="(" separator="," close=")">  
				 #{ids}  
				 </foreach> 
		</if>
		<if test="PRO_CODES ==null or PRO_CODES ==''">
			(SELECT t.proj_equip_id FROM insur_info t where t.status = '申请' )
		</if>
	</update>-->
	<update  id="update_insur_info" parameterType="Map" >
		update insur_info f set f.status=#{status_s} where f.id in
		<if test="PRO_CODES!=null and PRO_CODES!=''">
                 <foreach item="ids" index="index" collection="PRO_CODES" open="(" separator="," close=")">  
				 #{ids}  
				 </foreach> 
		</if>
		<if test="PRO_CODES ==null or PRO_CODES ==''">
			(SELECT t.proj_equip_id FROM insur_info t where t.status = #{status_e} )
		</if>
	</update>
	<update  id="update_insur_info1" parameterType="Map" >
		update insur_info f set f.status=#{status_s} where f.proj_equip_id in
		<if test="PRO_CODES!=null and PRO_CODES!=''">
                 <foreach item="ids" index="index" collection="PRO_CODES" open="(" separator="," close=")">  
				 #{ids}  
				 </foreach> 
		</if>
		<if test="PRO_CODES ==null or PRO_CODES ==''">
			(SELECT t.proj_equip_id FROM insur_info t where t.status = #{status_e} )
		</if>
	</update>
	<update  id="update_insur_info_renewal" parameterType="Map" >
		update insur_info t set t.status = '待续' where t.status like '%2%' and t.proj_no = (SELECT proj_no FROM insur_info i where i.id in
		<if test="PRO_CODES!=null and PRO_CODES!=''">
                 <foreach item="ids" index="index" collection="PRO_CODES" open="(" separator="," close=")">  
				 #{ids}  
				 </foreach> 
		</if>)
	</update>
	<update  id="insureAffirm" parameterType="Map" >
		 UPDATE insur_info SET PROJ_NO = #{PROJ_NO}
		 <if test="EQUIP_SN !=null">,EQUIP_SN = #{EQUIP_SN}</if>
		 <if test="INSUR_NO !=null">,INSUR_NO = #{INSUR_NO}</if>
		 <if test="INSUR_DATE !=null">,INSUR_DATE = to_date(#{INSUR_DATE},'yyyy-mm-dd')</if>
		 <if test="INVOICE_NO !=null">,INVOICE_NO = #{INVOICE_NO}</if>
		 <if test="INVOICE_DATE !=null">,INVOICE_DATE = to_date(#{INVOICE_DATE},'yyyy-mm-dd')</if>
		 <if test="INSUR_START_DATE !=null">,INSUR_START_DATE = to_date(#{INSUR_START_DATE},'yyyy-mm-dd')</if>
		 <if test="INSUR_TERM !=null">,INSUR_TERM = #{INSUR_TERM}</if>
		 <if test="INSUR_END_DATE !=null">,INSUR_END_DATE = to_date(#{INSUR_END_DATE},'yyyy-mm-dd')</if>
		 <if test="INSUR_TYPE !=null">,INSUR_TYPE = #{INSUR_TYPE}</if>
		 <if test="STATUS !=null">,STATUS = #{STATUS}</if>
		 where PROJ_NO = #{PROJ_NO} and EQUIP_SN = #{EQUIP_SN} 
	</update>
	
	<select id="query_lease_num"  parameterType="String" resultType="Map">
		SELECT t.lease_term*t.lease_period lease_num FROM fil_project_head t where t.pro_code=#{PRO_CODE}
	</select>
	<select id="query_renewal_remind"  parameterType="java.util.Map" resultType="java.util.Map">
		SELECT * FROM (SELECT  CC.*,ROWNUM ROWNO FROM (
			SELECT id, proj_no, status, insur_no, to_char(insur_date,'yyyy-mm-dd') insur_date, invoice_no,  to_char(invoice_date,'yyyy-mm-dd')invoice_date, 
			to_char(insur_start_date,'yyyy-mm-dd')insur_start_date, to_char(insur_end_date,'yyyy-mm-dd')insur_end_date, insur_term, insur_type, creator, 
			create_date, modificator, modify_date, prod_id, model_id, equip_sn, equip_price, proj_equip_id, deliver_date, company_name, 
			suppliers_name, certificate_date, engine_type, car_symbol, area, money, name, pilfer, unit_price, operation_type 
			FROM  insur_info t where trunc(t.insur_end_date-10) &lt;= trunc(sysdate) and t.operation_type = 'yes' and t.insur_type ='半保' 
			) CC  
			<where>
				<if test="PROJ_NO!=null and PROJ_NO!=''">AND CC.PROJ_NO LIKE '%'||#{PROJ_NO}||'%'</if>
				<if test="SUPPLIERS_NAME!=null and SUPPLIERS_NAME!=''">AND CC.SUPPLIERS_NAME LIKE '%'||#{SUPPLIERS_NAME}||'%'</if>
				<if test="NAME!=null and NAME!=''">AND CC.NAME LIKE '%'||#{NAME}||'%'</if>
				<if test="EQUIP_SN!=null and EQUIP_SN!=''">AND CC.EQUIP_SN LIKE '%'||#{EQUIP_SN}||'%'</if>
				<if test="PROD_ID!=null and PROD_ID!=''">AND CC.PROD_ID LIKE '%'||#{PROD_ID}||'%'</if>
				<if test="COMPANY_NAME!=null and COMPANY_NAME!=''">AND CC.COMPANY_NAME LIKE '%'||#{COMPANY_NAME}||'%'</if>
				<if test="B_DELIVER_DATE!=null and B_DELIVER_DATE!=''">AND CC.DELIVER_DATE >= #{B_DELIVER_DATE}</if>
				<if test="E_DELIVER_DATE!=null and E_DELIVER_DATE!=''">AND CC.DELIVER_DATE &lt;= #{E_DELIVER_DATE}</if>
				<if test="STATUS!=null and STATUS!=''">AND CC.STATUS LIKE '%'||#{STATUS}||'%'</if>
			</where>
			ORDER BY CC.DELIVER_DATE
		) CCC  WHERE CCC.ROWNO BETWEEN #{PAGE_BEGIN} AND #{PAGE_END}	
	</select>
	<select id="query_renewal_remind_count"  parameterType="java.util.Map" resultType="int">
		SELECT count(*)  FROM (
			SELECT id, proj_no, status, insur_no, to_char(insur_date,'yyyy-mm-dd') insur_date, invoice_no,  to_char(invoice_date,'yyyy-mm-dd')invoice_date, 
			to_char(insur_start_date,'yyyy-mm-dd')insur_start_date, to_char(insur_end_date,'yyyy-mm-dd')insur_end_date, insur_term, insur_type, creator, 
			create_date, modificator, modify_date, prod_id, model_id, equip_sn, equip_price, proj_equip_id, deliver_date, company_name, 
			suppliers_name, certificate_date, engine_type, car_symbol, area, money, name, pilfer, unit_price, operation_type 
			FROM  insur_info t where trunc(t.insur_end_date-10) &lt;= trunc(sysdate) and t.operation_type = 'yes' and t.insur_type ='半保'
			) CC  
			<where>
				<if test="PROJ_NO!=null and PROJ_NO!=''">AND CC.PROJ_NO LIKE '%'||#{PROJ_NO}||'%'</if>
				<if test="SUPPLIERS_NAME!=null and SUPPLIERS_NAME!=''">AND CC.SUPPLIERS_NAME LIKE '%'||#{SUPPLIERS_NAME}||'%'</if>
				<if test="NAME!=null and NAME!=''">AND CC.NAME LIKE '%'||#{NAME}||'%'</if>
				<if test="EQUIP_SN!=null and EQUIP_SN!=''">AND CC.EQUIP_SN LIKE '%'||#{EQUIP_SN}||'%'</if>
				<if test="PROD_ID!=null and PROD_ID!=''">AND CC.PROD_ID LIKE '%'||#{PROD_ID}||'%'</if>
				<if test="COMPANY_NAME!=null and COMPANY_NAME!=''">AND CC.COMPANY_NAME LIKE '%'||#{COMPANY_NAME}||'%'</if>
				<if test="B_DELIVER_DATE!=null and B_DELIVER_DATE!=''">AND CC.DELIVER_DATE >= #{B_DELIVER_DATE}</if>
				<if test="E_DELIVER_DATE!=null and E_DELIVER_DATE!=''">AND CC.DELIVER_DATE &lt;= #{E_DELIVER_DATE}</if>
				<if test="STATUS!=null and STATUS!=''">AND CC.STATUS LIKE '%'||#{STATUS}||'%'</if>
			</where>
	</select>
	<select id="query_renewalEntering"  parameterType="java.util.Map" resultType="java.util.Map">
		SELECT * FROM (SELECT  CC.*,ROWNUM ROWNO FROM (
			SELECT id, proj_no, status, insur_no, to_char(insur_date,'yyyy-mm-dd') insur_date, invoice_no,  to_char(invoice_date,'yyyy-mm-dd')invoice_date, 
			to_char(insur_start_date,'yyyy-mm-dd')insur_start_date, to_char(insur_end_date,'yyyy-mm-dd')insur_end_date, insur_term, insur_type, creator, 
			create_date, modificator, modify_date, prod_id, model_id, equip_sn, equip_price, proj_equip_id, deliver_date, company_name, 
			suppliers_name, certificate_date, engine_type, car_symbol, area, money, name, pilfer, unit_price, operation_type 
			FROM  insur_info t where t.operation_type = 'yes' and t.insur_type ='半保' and t.status = '待录保单信息'
			) CC  
			<where>
				<if test="PROJ_NO!=null and PROJ_NO!=''">AND CC.PROJ_NO LIKE '%'||#{PROJ_NO}||'%'</if>
				<if test="SUPPLIERS_NAME!=null and SUPPLIERS_NAME!=''">AND CC.SUPPLIERS_NAME LIKE '%'||#{SUPPLIERS_NAME}||'%'</if>
				<if test="NAME!=null and NAME!=''">AND CC.NAME LIKE '%'||#{NAME}||'%'</if>
				<if test="EQUIP_SN!=null and EQUIP_SN!=''">AND CC.EQUIP_SN LIKE '%'||#{EQUIP_SN}||'%'</if>
				<if test="PROD_ID!=null and PROD_ID!=''">AND CC.PROD_ID LIKE '%'||#{PROD_ID}||'%'</if>
				<if test="COMPANY_NAME!=null and COMPANY_NAME!=''">AND CC.COMPANY_NAME LIKE '%'||#{COMPANY_NAME}||'%'</if>
				<if test="B_DELIVER_DATE!=null and B_DELIVER_DATE!=''">AND CC.DELIVER_DATE >= #{B_DELIVER_DATE}</if>
				<if test="E_DELIVER_DATE!=null and E_DELIVER_DATE!=''">AND CC.DELIVER_DATE &lt;= #{E_DELIVER_DATE}</if>
			</where>
			ORDER BY CC.DELIVER_DATE
		) CCC  WHERE CCC.ROWNO BETWEEN #{PAGE_BEGIN} AND #{PAGE_END}	
	</select>
	<select id="query_renewalEntering_count"  parameterType="java.util.Map" resultType="int">
		SELECT count(*)  FROM (
			SELECT id,proj_no, status, insur_no, to_char(insur_date,'yyyy-mm-dd') insur_date, invoice_no,  to_char(invoice_date,'yyyy-mm-dd')invoice_date, 
			to_char(insur_start_date,'yyyy-mm-dd')insur_start_date, to_char(insur_end_date,'yyyy-mm-dd')insur_end_date, insur_term, insur_type, creator, 
			create_date, modificator, modify_date, prod_id, model_id, equip_sn, equip_price, proj_equip_id, deliver_date, company_name, 
			suppliers_name, certificate_date, engine_type, car_symbol, area, money, name, pilfer, unit_price, operation_type 
			FROM  insur_info t where t.operation_type = 'yes' and t.insur_type ='半保' and t.status = '待录保单信息'
			) CC  
			<where>
				<if test="PROJ_NO!=null and PROJ_NO!=''">AND CC.PROJ_NO LIKE '%'||#{PROJ_NO}||'%'</if>
				<if test="SUPPLIERS_NAME!=null and SUPPLIERS_NAME!=''">AND CC.SUPPLIERS_NAME LIKE '%'||#{SUPPLIERS_NAME}||'%'</if>
				<if test="NAME!=null and NAME!=''">AND CC.NAME LIKE '%'||#{NAME}||'%'</if>
				<if test="EQUIP_SN!=null and EQUIP_SN!=''">AND CC.EQUIP_SN LIKE '%'||#{EQUIP_SN}||'%'</if>
				<if test="PROD_ID!=null and PROD_ID!=''">AND CC.PROD_ID LIKE '%'||#{PROD_ID}||'%'</if>
				<if test="COMPANY_NAME!=null and COMPANY_NAME!=''">AND CC.COMPANY_NAME LIKE '%'||#{COMPANY_NAME}||'%'</if>
				<if test="B_DELIVER_DATE!=null and B_DELIVER_DATE!=''">AND CC.DELIVER_DATE >= #{B_DELIVER_DATE}</if>
				<if test="E_DELIVER_DATE!=null and E_DELIVER_DATE!=''">AND CC.DELIVER_DATE &lt;= #{E_DELIVER_DATE}</if>
			</where>
	</select>
	<select id="renewalAffirm"  parameterType="java.util.Map" resultType="java.util.Map">
		SELECT * FROM (SELECT  CC.*,ROWNUM ROWNO FROM (
			SELECT id, proj_no, status, insur_no, to_char(insur_date,'yyyy-mm-dd') insur_date, invoice_no,  to_char(invoice_date,'yyyy-mm-dd')invoice_date, 
			to_char(insur_start_date,'yyyy-mm-dd')insur_start_date, to_char(insur_end_date,'yyyy-mm-dd')insur_end_date, insur_term, insur_type, creator, 
			create_date, modificator, modify_date, prod_id, model_id, equip_sn, equip_price, proj_equip_id, deliver_date, company_name, 
			suppliers_name, certificate_date, engine_type, car_symbol, area, money, name, pilfer, unit_price, operation_type 
			FROM  insur_info t where t.operation_type = 'yes' and t.status = '已录入待确认'
			) CC  
			<where>
				<if test="PROJ_NO!=null and PROJ_NO!=''">AND CC.PROJ_NO LIKE '%'||#{PROJ_NO}||'%'</if>
				<if test="SUPPLIERS_NAME!=null and SUPPLIERS_NAME!=''">AND CC.SUPPLIERS_NAME LIKE '%'||#{SUPPLIERS_NAME}||'%'</if>
				<if test="NAME!=null and NAME!=''">AND CC.NAME LIKE '%'||#{NAME}||'%'</if>
				<if test="EQUIP_SN!=null and EQUIP_SN!=''">AND CC.EQUIP_SN LIKE '%'||#{EQUIP_SN}||'%'</if>
				<if test="PROD_ID!=null and PROD_ID!=''">AND CC.PROD_ID LIKE '%'||#{PROD_ID}||'%'</if>
				<if test="COMPANY_NAME!=null and COMPANY_NAME!=''">AND CC.COMPANY_NAME LIKE '%'||#{COMPANY_NAME}||'%'</if>
				<if test="B_DELIVER_DATE!=null and B_DELIVER_DATE!=''">AND CC.DELIVER_DATE >= #{B_DELIVER_DATE}</if>
				<if test="E_DELIVER_DATE!=null and E_DELIVER_DATE!=''">AND CC.DELIVER_DATE &lt;= #{E_DELIVER_DATE}</if>
			</where>
			ORDER BY CC.DELIVER_DATE
		) CCC  WHERE CCC.ROWNO BETWEEN #{PAGE_BEGIN} AND #{PAGE_END}	
	</select>
	<select id="renewalAffirm_count"  parameterType="java.util.Map" resultType="int">
		SELECT count(*)  FROM (
			SELECT id,proj_no, status, insur_no, to_char(insur_date,'yyyy-mm-dd') insur_date, invoice_no,  to_char(invoice_date,'yyyy-mm-dd')invoice_date, 
			to_char(insur_start_date,'yyyy-mm-dd')insur_start_date, to_char(insur_end_date,'yyyy-mm-dd')insur_end_date, insur_term, insur_type, creator, 
			create_date, modificator, modify_date, prod_id, model_id, equip_sn, equip_price, proj_equip_id, deliver_date, company_name, 
			suppliers_name, certificate_date, engine_type, car_symbol, area, money, name, pilfer, unit_price, operation_type 
			FROM  insur_info t where t.operation_type = 'yes' and t.status = '已录入待确认'
			) CC  
			<where>
				<if test="PROJ_NO!=null and PROJ_NO!=''">AND CC.PROJ_NO LIKE '%'||#{PROJ_NO}||'%'</if>
				<if test="SUPPLIERS_NAME!=null and SUPPLIERS_NAME!=''">AND CC.SUPPLIERS_NAME LIKE '%'||#{SUPPLIERS_NAME}||'%'</if>
				<if test="NAME!=null and NAME!=''">AND CC.NAME LIKE '%'||#{NAME}||'%'</if>
				<if test="EQUIP_SN!=null and EQUIP_SN!=''">AND CC.EQUIP_SN LIKE '%'||#{EQUIP_SN}||'%'</if>
				<if test="PROD_ID!=null and PROD_ID!=''">AND CC.PROD_ID LIKE '%'||#{PROD_ID}||'%'</if>
				<if test="COMPANY_NAME!=null and COMPANY_NAME!=''">AND CC.COMPANY_NAME LIKE '%'||#{COMPANY_NAME}||'%'</if>
				<if test="B_DELIVER_DATE!=null and B_DELIVER_DATE!=''">AND CC.DELIVER_DATE >= #{B_DELIVER_DATE}</if>
				<if test="E_DELIVER_DATE!=null and E_DELIVER_DATE!=''">AND CC.DELIVER_DATE &lt;= #{E_DELIVER_DATE}</if>
			</where>
	</select>
	<select id="query_insur_by_projno_status"  parameterType="java.util.Map" resultType="java.util.Map">
			SELECT id,proj_no, status, insur_no, to_char(insur_date,'yyyy-mm-dd') insur_date, invoice_no,  to_char(invoice_date,'yyyy-mm-dd')invoice_date, 
			to_char(insur_start_date,'yyyy-mm-dd')insur_start_date, to_char(insur_end_date,'yyyy-mm-dd')insur_end_date, insur_term, insur_type, creator, 
			create_date, modificator, modify_date, prod_id, model_id, equip_sn, equip_price, proj_equip_id, deliver_date, company_name, 
			suppliers_name, certificate_date, engine_type, car_symbol, area, money, name, pilfer, unit_price, operation_type 
			FROM  insur_info t where t.status = #{status} and t.proj_no=#{proj_no}
	</select>
	<insert id="informationEntry_insert" parameterType="Map" >
		<selectKey resultType="int" order="BEFORE" keyProperty="NEWID">
			SELECT seq_insur_info.nextval FROM DUAL
		</selectKey>
		insert into insur_info (id,PROJ_NO,status,equip_price,proj_equip_id,unit_price,MONEY,prod_id,model_id,equip_sn,DELIVER_DATE,COMPANY_NAME,SUPPLIERS_NAME,
		CERTIFICATE_DATE,ENGINE_TYPE,CAR_SYMBOL,AREA,NAME,PILFER,OPERATION_TYPE,LEASE_TERM)
		SELECT #{NEWID},PROJ_NO,'待续2',equip_price,proj_equip_id,unit_price,MONEY,prod_id,model_id,equip_sn,DELIVER_DATE,COMPANY_NAME,SUPPLIERS_NAME,
    	CERTIFICATE_DATE,ENGINE_TYPE,CAR_SYMBOL,AREA,NAME,PILFER,OPERATION_TYPE,LEASE_TERM from insur_info 
		<where>
			<if test="ID!=null and PROJ_NO!=''">AND ID = #{ID}</if>
		</where>
    </insert>
	<update  id="informationEntry_update" parameterType="Map" >
		 UPDATE insur_info SET ID = #{ID}
		 <if test="EQUIP_SN !=null">,EQUIP_SN = #{EQUIP_SN}</if>
		 <if test="INSUR_NO !=null">,INSUR_NO = #{INSUR_NO}</if>
		 <if test="INSUR_DATE !=null">,INSUR_DATE = to_date(#{INSUR_DATE},'yyyy-mm-dd')</if>
		 <if test="INVOICE_NO !=null">,INVOICE_NO = #{INVOICE_NO}</if>
		 <if test="INVOICE_DATE !=null">,INVOICE_DATE = to_date(#{INVOICE_DATE},'yyyy-mm-dd')</if>
		 <if test="INSUR_START_DATE !=null">,INSUR_START_DATE = to_date(#{INSUR_START_DATE},'yyyy-mm-dd')</if>
		 <if test="INSUR_TERM !=null">,INSUR_TERM = #{INSUR_TERM}</if>
		 <if test="INSUR_END_DATE !=null">,INSUR_END_DATE = to_date(#{INSUR_END_DATE},'yyyy-mm-dd')</if>
		 <if test="INSUR_TYPE !=null">,INSUR_TYPE = #{INSUR_TYPE}</if>
		 <if test="STATUS !=null">,STATUS = #{STATUS}</if>
		 <if test="PICTURE_SRC !=null">,PICTURE_SRC = #{PICTURE_SRC}</if>
		 where ID = #{ID}
	</update>
	<delete  id="informationEntry_delete" parameterType="Map" >
		delete insur_info t where t.proj_no = (SELECT proj_no FROM insur_info where id = #{ID}) and t.status=#{status}
	</delete>
	<select id="query_insur_term"  parameterType="String" resultType="Map">
		SELECT sum(t.insur_term) insur_term FROM insur_info t where t.proj_no = #{PRO_CODE}
	</select>
	<select id="getInsuranceAll" parameterType="Map" resultType="Map">
	SELECT * FROM (SELECT  CC.*,ROWNUM ROWNO FROM (
		SELECT DISTINCT FCC.ID,
	           FCC.NAME,
	           FCC.TYPE,--客户类型
	           FPH.LEASE_CODE,
	           FRPH.PAYLIST_CODE,
	           LX.FLAG,--项目类型
	           FPE.ID FPEID,
	           FPE.COMPANY_NAME,--厂商名称
	           FPE.SUPPLIERS_NAME,--供应商名称
	           FPE.SPEC_NAME,--型号
	           FPE.ENGINE_TYPE,--发动机编号
	           FPE.CAR_SYMBOL,--车架号
	           FPE.PRODUCT_NAME,--设备名称
	           FPE.INSURANCE_FLAG
	      FROM FIL_CUST_CLIENT       FCC,
	           FIL_PROJECT_HEAD      FPH,
	           FIL_RENT_PLAN_HEAD    FRPH,
	           (SELECT *
			          FROM T_SYS_SITE_DICTIONARY
			         WHERE STATUS = 0
			           AND TYPE = '业务类型'
			         ORDER BY LEVEL_NUM, DATA_ID, CODE) LX,
	           FIL_PROJECT_EQUIPMENT FPE,
	           FI_FUND_PAYMENT_HEAD FFPH,
	           FI_FUND_PAYMENT_DETAIL FFPD
	     WHERE FCC.ID = FPH.CLIENT_ID
	       AND FPH.ID = FRPH.PROJECT_ID
	       AND FPE.PAY_ID = FRPH.ID
	       AND FPH.PLATFORM_TYPE=LX.CODE
	       AND FRPH.PAYLIST_CODE IS NOT NULL
	       AND FFPD.PROJECT_CODE = FPH.PRO_CODE
	       AND FFPD.PAYMENT_HEAD_ID = FFPH.ID
		  )CC
		   <where>
			   <if test="NAME !=null and NAME !=''">AND CC.NAME=#{NAME}</if>
			   <if test="LEASE_CODE !=null and LEASE_CODE !=''">AND CC.LEASE_CODE=#{LEASE_CODE}</if>
			   <if test="PAYLIST_CODE !=null and PAYLIST_CODE !=''">AND CC.PAYLIST_CODE=#{PAYLIST_CODE}</if>
			   <if test="FPEID !=null and FPEID !=''">AND CC.FPEID=#{FPEID}</if>
			</where>
	) CCC  WHERE CCC.ROWNO BETWEEN #{PAGE_BEGIN} AND #{PAGE_END}	
	</select>
	<select id="getInsuranceAll_count" parameterType="Map" resultType="int">
		SELECT COUNT(*) FROM (
		SELECT DISTINCT FCC.ID,
	           FCC.NAME,
	           FCC.TYPE,--客户类型
	           FPH.LEASE_CODE,
	           FRPH.PAYLIST_CODE,
	           LX.FLAG,--项目类型
	           FPE.ID FPEID,
	           FPE.COMPANY_NAME,--厂商名称
	           FPE.SUPPLIERS_NAME,--供应商名称
	           FPE.SPEC_NAME,--型号
	           FPE.ENGINE_TYPE,--发动机编号
	           FPE.CAR_SYMBOL,--车架号
	           FPE.INSURANCE_FLAG
	      FROM FIL_CUST_CLIENT       FCC,
	           FIL_PROJECT_HEAD      FPH,
	           FIL_RENT_PLAN_HEAD    FRPH,
	           (SELECT *
			          FROM T_SYS_SITE_DICTIONARY
			         WHERE STATUS = 0
			           AND TYPE = '业务类型'
			         ORDER BY LEVEL_NUM, DATA_ID, CODE) LX,
	           FIL_PROJECT_EQUIPMENT FPE,
	           FI_FUND_PAYMENT_HEAD FFPH,
	           FI_FUND_PAYMENT_DETAIL FFPD
	     WHERE FCC.ID = FPH.CLIENT_ID
	       AND FPH.ID = FRPH.PROJECT_ID
	       AND FPE.PAY_ID = FRPH.ID
	       AND FPH.PLATFORM_TYPE=LX.CODE
	       AND FRPH.PAYLIST_CODE IS NOT NULL
	       AND FFPD.PROJECT_CODE = FPH.PRO_CODE
	       AND FFPD.PAYMENT_HEAD_ID = FFPH.ID
		  )CC
		   <where>
			   <if test="NAME !=null and NAME !=''">AND CC.NAME=#{NAME}</if>
			   <if test="LEASE_CODE !=null and LEASE_CODE !=''">AND CC.LEASE_CODE=#{LEASE_CODE}</if>
			   <if test="PAYLIST_CODE !=null and PAYLIST_CODE !=''">AND CC.PAYLIST_CODE=#{PAYLIST_CODE}</if>
			   <if test="FPEID !=null and FPEID !=''">AND CC.FPEID=#{FPEID}</if>
			</where>
	</select>
	
	<select id="getInsuranceEquipmentAll" parameterType="Map" resultType="Map">
		SELECT * FROM (SELECT  CC.*,ROWNUM ROWNO FROM (
			SELECT  FRE.ID,                     -- 设备ID
		           FRE.COMPANY_NAME,       -- 厂商
		           FRE.SUPPLIERS_NAME,     -- 经销商
		           FRE.PRODUCT_NAME,       -- 设备名称
		           FRE.SPEC_NAME,          -- 品牌型号
		           FRE.CAR_SYMBOL,         -- 整机编号/车架号
		           -- 车牌号
		           
		           II.INSU_NAME,           -- 客户名称
		           FRE.ENGINE_TYPE,        -- 发动机型号
		           LX.FLAG,                -- 业务类型
		           FPH.LEASE_CODE          -- 融资租赁合同编号
				  FROM FIL_PROJECT_EQUIPMENT FRE, 
		           FIL_PROJECT_HEAD FPH,
		           T_INSU_INSURANCELIST II,
		           (SELECT *
					          FROM T_SYS_SITE_DICTIONARY
					         WHERE STATUS = 0
					           AND TYPE = '业务类型'
					         ORDER BY LEVEL_NUM, DATA_ID, CODE) LX
				 WHERE FRE.PROJECT_ID = FPH.ID
		       AND II.FPE_ID = FRE.ID
		       AND FPH.PLATFORM_TYPE=LX.CODE 
		       ORDER BY II.CREATE_DATE DESC
			  )CC
			   <where>
				   <if test="INSU_NAME !=null and INSU_NAME !=''">AND CC.INSU_NAME=#{INSU_NAME}</if>
				   <if test="LEASE_CODE !=null and LEASE_CODE !=''">AND CC.LEASE_CODE=#{LEASE_CODE}</if>
				   <if test="COMPANY_NAME !=null and COMPANY_NAME !=''">AND CC.COMPANY_NAME=#{COMPANY_NAME}</if>
				   <if test="SUPPLIERS_NAME !=null and SUPPLIERS_NAME !=''">AND CC.SUPPLIERS_NAME=#{SUPPLIERS_NAME}</if>
				   <if test="CAR_SYMBOL !=null and CAR_SYMBOL !=''">AND CC.CAR_SYMBOL=#{CAR_SYMBOL}</if>
				</where>
		) CCC  WHERE CCC.ROWNO BETWEEN #{PAGE_BEGIN} AND #{PAGE_END}	
	</select>
	<select id="getInsuranceEquipmentAll_count" parameterType="Map" resultType="int">
		SELECT COUNT(*) FROM (
			SELECT  FRE.ID,                     -- 设备ID
		           FRE.COMPANY_NAME,       -- 厂商
		           FRE.SUPPLIERS_NAME,     -- 经销商
		           FRE.PRODUCT_NAME,       -- 设备名称
		           FRE.SPEC_NAME,          -- 品牌型号
		           FRE.CAR_SYMBOL,         -- 整机编号/车架号
		           -- 车牌号
		           
		           II.INSU_NAME,           -- 客户名称
		           FRE.ENGINE_TYPE,        -- 发动机型号
		           LX.FLAG,                -- 业务类型
		           FPH.LEASE_CODE          -- 融资租赁合同编号
				  FROM FIL_PROJECT_EQUIPMENT FRE, 
		           FIL_PROJECT_HEAD FPH,
		           T_INSU_INSURANCELIST II,
		           (SELECT *
					          FROM T_SYS_SITE_DICTIONARY
					         WHERE STATUS = 0
					           AND TYPE = '业务类型'
					         ORDER BY LEVEL_NUM, DATA_ID, CODE) LX
				 WHERE FRE.PROJECT_ID = FPH.ID
		       AND II.FPE_ID = FRE.ID
		       AND FPH.PLATFORM_TYPE=LX.CODE 
		       ORDER BY II.CREATE_DATE DESC
		  )CC
		   <where>
			   <if test="INSU_NAME !=null and INSU_NAME !=''">AND CC.INSU_NAME=#{INSU_NAME}</if>
			   <if test="LEASE_CODE !=null and LEASE_CODE !=''">AND CC.LEASE_CODE=#{LEASE_CODE}</if>
			   <if test="COMPANY_NAME !=null and COMPANY_NAME !=''">AND CC.COMPANY_NAME=#{COMPANY_NAME}</if>
			   <if test="SUPPLIERS_NAME !=null and SUPPLIERS_NAME !=''">AND CC.SUPPLIERS_NAME=#{SUPPLIERS_NAME}</if>
			   <if test="CAR_SYMBOL !=null and CAR_SYMBOL !=''">AND CC.CAR_SYMBOL=#{CAR_SYMBOL}</if>
			</where>
	</select>
	<select id="getInsuranceEquipmentList" parameterType="Map" resultType="Map">
		SELECT * FROM (
			SELECT  FRE.ID,                     -- 设备ID
		           FRE.COMPANY_NAME,       -- 厂商
		           FRE.SUPPLIERS_NAME,     -- 经销商
		           FRE.PRODUCT_NAME,       -- 设备名称
		           FRE.SPEC_NAME,          -- 品牌型号
		           FRE.CAR_SYMBOL,         -- 整机编号/车架号
		           -- 车牌号
		           
		           II.INSU_NAME,           -- 客户名称
		           FRE.ENGINE_TYPE,        -- 发动机型号
		           LX.FLAG,                -- 业务类型
		           FPH.LEASE_CODE          -- 融资租赁合同编号
				  FROM FIL_PROJECT_EQUIPMENT FRE, 
		           FIL_PROJECT_HEAD FPH,
		           T_INSU_INSURANCELIST II,
		           (SELECT *
					          FROM T_SYS_SITE_DICTIONARY
					         WHERE STATUS = 0
					           AND TYPE = '业务类型'
					         ORDER BY LEVEL_NUM, DATA_ID, CODE) LX
				 WHERE FRE.PROJECT_ID = FPH.ID
		       AND II.FPE_ID = FRE.ID
		       AND FPH.PLATFORM_TYPE=LX.CODE 
		       ORDER BY II.CREATE_DATE DESC
			  )CC
			   <where>
				   <if test="INSU_NAME !=null and INSU_NAME !=''">AND CC.INSU_NAME=#{INSU_NAME}</if>
				   <if test="LEASE_CODE !=null and LEASE_CODE !=''">AND CC.LEASE_CODE=#{LEASE_CODE}</if>
				   <if test="COMPANY_NAME !=null and COMPANY_NAME !=''">AND CC.COMPANY_NAME=#{COMPANY_NAME}</if>
				   <if test="SUPPLIERS_NAME !=null and SUPPLIERS_NAME !=''">AND CC.SUPPLIERS_NAME=#{SUPPLIERS_NAME}</if>
				   <if test="CAR_SYMBOL !=null and CAR_SYMBOL !=''">AND CC.CAR_SYMBOL=#{CAR_SYMBOL}</if>
				</where>
	</select>
	
	<update id="nowclose" parameterType="java.util.Map">
		UPDATE FIL_PROJECT_EQUIPMENT SET INSURANCE_FLAG=1 WHERE ID=#{ID}
	</update>
	<select id="geteq" parameterType="Map" resultType="Map">
		SELECT FRE.ID,
		       FRE.COMPANY_NAME,
		       FRE.SUPPLIERS_NAME,
		       FRE.PRODUCT_NAME,
		       FRE.SPEC_NAME,
		       FRE.CAR_SYMBOL,
		       FRE.ENGINE_TYPE,
		       FPH.LEASE_CODE
		  FROM FIL_PROJECT_EQUIPMENT FRE, FIL_PROJECT_HEAD FPH
		 WHERE FRE.PROJECT_ID = FPH.ID
		   AND FRE.ID = #{ID}
	</select>
	<select id="queryNaturaType" parameterType="String" resultType="Map">
		SELECT FCC.NAME,
		       CASE LX.FLAG
		         WHEN '个人' THEN
		          FCC.HOUSE_ADDRESS
		         ELSE
		          FCC.REGISTE_ADDRESS
		       END ADDRESS,
		       CASE LX.FLAG
		         WHEN '个人' THEN
		          FCC.ID_CARD_NO
		         ELSE
		          FCC.ORAGNIZATION_CODE
		       END CODE
		  FROM FIL_CUST_CLIENT FCC,
		       FIL_PROJECT_HEAD FPH,
		       FIL_PROJECT_EQUIPMENT FPE,
		       (SELECT *
		          FROM T_SYS_DATA_DICTIONARY
		         WHERE STATUS = 0
		           AND TYPE = '客户类型'
		         ORDER BY LEVEL_NUM, DATA_ID, CODE) LX
		 WHERE FPE.PROJECT_ID = FPH.ID
		   AND FPH.CLIENT_ID = FCC.ID
		   AND FCC.TYPE = LX.CODE
		   AND FPE.ID=#{ID}
	</select>
	<select id="getOfficial" parameterType="Map" resultType="Map">
		SELECT ID,
		       FA_NAME,
		       EN_NAME,
		       SHORT_NAME,
		       WORKER_NUM,
		       FA_TYPE,
		       BUS_LICENSE,
		       BUS_DEADLINE,
		       TAX_NUM,
		       FOUND_DATE,
		       REG_CAPITAL,
		       RUN_SCOPE,
		       FA_PHONE,
		       FA_ADD,
		       FA_FAX,
		       FA_POSTCODE,
		       REG_ADD,
		       REMARK,
		       LEGAL_PERSON,
		       LEGAL_IDECARD,
		       LEGAL_PHONE,
		       LEGAL_CODE,
		       LEGAL_ADD,
		       LEGAL_MOBILE,
		       LINKMAN,
		       LINKMAN_IDECARD,
		       LINKMAN_PHONE,
		       LINKMAN_CODE,
		       LINKMAN_ADD,
		       LINKMAN_MOBILE,
		       FA_BINK,
		       FA_ACCOUNT,
		       SUPER_ID,
		       CREATE_TIME,
		       FA_LEVEL,
		       STATUS,
		       ORG_CODE
		  FROM FHFA_MANAGER WHERE　FA_NAME=#{FA_NAME}
	</select>
	<select id="getCompanyAll" resultType="Map">
		SELECT ID,COMPANY_NAME,COMPANY_ADDR,CONTACT_NUM FROM T_INSURE_COMPANY
	</select>
	<select id="getCompanyAll1" parameterType="Map" resultType="Map">
		SELECT ID,COMPANY_NAME,COMPANY_ADDR,CONTACT_NUM FROM T_INSURE_COMPANY WHERE 1=1 <if test="ID !=NULL and ID !=''">and ID=#{ID}</if>
	</select>
	<select id="getInsuranceType" parameterType="Map" resultType="Map">
		SELECT  TID.ID,TID.INSURE_NAME
			 FROM T_INSURE_DETAIL TID, T_COMPANY_MID_INSURE TCMI
			WHERE TID.ID = TCMI.INSURE_ID
			AND TCMI.COMPANY_ID =#{ID}
	</select>
	<insert id="createInsuList" parameterType="map">
		INSERT INTO T_INSU_INSURANCELIST
           (INCU_ID
           <if test="s_employeeId!=null and s_employeeId!=''">,CREATE_ID</if>
           ,CREATE_DATE
           <if test="INCU_CODE!=null and INCU_CODE!=''">,INCU_CODE</if>
           <if test="INCP_ID!=null and INCP_ID!=''">,INCP_ID</if>
           <if test="INSU_NAME!=null and INSU_NAME!=''">,INSU_NAME</if>
           <if test="INSU_ADDRESS!=null and INSU_ADDRESS!=''">,INSU_ADDRESS</if>
           <if test="MORTGAGE!=null and MORTGAGE!=''">,MORTGAGE</if>
            <if test="INSU_CERTIFICATE!=null and INSU_CERTIFICATE!=''">,INSU_CERTIFICATE</if>
           <if test="TO_INSU_NAME!=null and TO_INSU_NAME!=''">,TO_INSU_NAME</if>
          <if test="TO_INSU_ADDRESS!=null and TO_INSU_ADDRESS!=''"> ,TO_INSU_ADDRESS</if>
          <if test="INSU_PRICE_TOTAL!=null and INSU_PRICE_TOTAL!=''"> ,INSU_PRICE_TOTAL</if>
           <if test="INSU_PRICE!=null and INSU_PRICE!=''">,INSU_PRICE</if>
           <if test="INSU_BALANCE !=null and INSU_BALANCE !=''">,INSU_BALANCE</if>
           <if test="INSU_BALANCE_REMARK !=null and INSU_BALANCE_REMARK !=''">,INSU_BALANCE_REMARK</if>
           <if test="INSU_PRICE_REBATE!=null and INSU_PRICE_REBATE!=''">,INSU_PRICE_REBATE</if>
           <if test="INSU_START_DATE!=null and INSU_START_DATE!=''"> ,INSU_START_DATE</if>
           <if test="INSU_END_DATE!=null and INSU_END_DATE!=''">,INSU_END_DATE</if>
          <if test="INSU_RATE!=null and INSU_RATE!=''"> ,INSU_RATE</if>
           <if test="COEFFICIENT!=null and COEFFICIENT!=''">,COEFFICIENT</if>
           <if test="REMARK!=null and REMARK!=''"> ,REMARK</if>
            <if test="CHARGE_CODE!=null and CHARGE_CODE!=''">,CHARGE_CODE</if>
          <if test="AFFIRM_SEIZE_DATE!=null and AFFIRM_SEIZE_DATE!=''">  ,AFFIRM_SEIZE_DATE</if>
            <if test="AFFIRM_INSU_DATE!=null and AFFIRM_INSU_DATE!=''">,AFFIRM_INSU_DATE</if>
           <if test="PRINT_INSU_DATE!=null and PRINT_INSU_DATE!=''">,PRINT_INSU_DATE</if>
           ,RENEWAL_INSU_CODE
           <if test="TO_INSU_CERTIFICATE!=null and TO_INSU_CERTIFICATE!=''">,TO_INSU_CERTIFICATE</if>
           <if test="EQMT_ID !=null and EQMT_ID !=''">,FPE_ID</if>
           <if test="FPE_ID !=null and FPE_ID !=''">,FPE_ID</if>
           ,STATUS
           ,GENERATION
           ,BXNX
           ,RENEWALMODE
           ,ISRENEWAL
           )
     VALUES
           (#{INCU_ID}
           <if test="s_employeeId!=null and s_employeeId!=''">,#{s_employeeId}</if>
           ,SYSDATE
           <if test="INCU_CODE!=null and INCU_CODE!=''">,#{INCU_CODE}</if>
           <if test="INCP_ID!=null and INCP_ID!=''">,#{INCP_ID}</if>
           <if test="INSU_NAME!=null and INSU_NAME!=''">,#{INSU_NAME}</if>
          <if test="INSU_ADDRESS!=null and INSU_ADDRESS!=''"> ,#{INSU_ADDRESS}</if>
          <if test="MORTGAGE!=null and MORTGAGE!=''"> ,#{MORTGAGE}</if>
           <if test="INSU_CERTIFICATE!=null and INSU_CERTIFICATE!=''">,#{INSU_CERTIFICATE}</if>
           <if test="TO_INSU_NAME!=null and TO_INSU_NAME!=''">,#{TO_INSU_NAME} </if>
           <if test="TO_INSU_ADDRESS!=null and TO_INSU_ADDRESS!=''">,#{TO_INSU_ADDRESS} </if>
           <if test="INSU_PRICE_TOTAL!=null and INSU_PRICE_TOTAL!=''">,#{INSU_PRICE_TOTAL}</if>
           <if test="INSU_PRICE!=null and INSU_PRICE!=''">,#{INSU_PRICE}</if>
           <if test="INSU_BALANCE !=null and INSU_BALANCE !=''">,#{INSU_BALANCE}</if>
           <if test="INSU_BALANCE_REMARK !=null and INSU_BALANCE_REMARK !=''">,#{INSU_BALANCE_REMARK}</if>
           <if test="INSU_PRICE_REBATE!=null and INSU_PRICE_REBATE!=''">,#{INSU_PRICE_REBATE}</if>
           <if test="INSU_START_DATE!=null and INSU_START_DATE!=''">,TO_DATE(#{INSU_START_DATE},'YYYY-MM-DD')</if>
           <if test="INSU_END_DATE!=null and INSU_END_DATE!=''">,TO_DATE(#{INSU_END_DATE},'YYYY-MM-DD')</if>
           <if test="INSU_RATE!=null and INSU_RATE!=''">,#{INSU_RATE}</if>
           <if test="COEFFICIENT!=null and COEFFICIENT!=''">,#{COEFFICIENT}</if>
           <if test="REMARK!=null and REMARK!=''">,#{REMARK}</if>
           <if test="CHARGE_CODE!=null and CHARGE_CODE!=''">,#{CHARGE_CODE} </if>
          <if test="AFFIRM_SEIZE_DATE!=null and AFFIRM_SEIZE_DATE!=''"> ,TO_DATE(#{AFFIRM_SEIZE_DATE},'YYYY-MM-DD')</if>
           <if test="AFFIRM_INSU_DATE!=null and AFFIRM_INSU_DATE!=''">,TO_DATE(#{AFFIRM_INSU_DATE},'YYYY-MM-DD')</if>
          <if test="PRINT_INSU_DATE!=null and PRINT_INSU_DATE!=''"> ,TO_DATE(#{PRINT_INSU_DATE},'YYYY-MM-DD')</if>
           ,'0'
           <if test="TO_INSU_CERTIFICATE!=null and TO_INSU_CERTIFICATE!=''">,#{TO_INSU_CERTIFICATE}</if>
           <if test="EQMT_ID !=null and EQMT_ID !=''">,#{EQMT_ID}</if>
           <if test="FPE_ID !=null and FPE_ID !=''">,#{FPE_ID}</if>
           ,0
           ,0
           ,0
           ,0
           ,0
           )
		</insert>	
				<insert id="createInsutype2InsuList" parameterType="map">
		INSERT INTO T_INSU_INSUTYPE2INSULIST
           (ID
           ,CREATE_ID
           ,MODIFY_ID
           ,STATUS
           ,INSU_ID
           ,INTP_ID
           ,TYPE
           ,CREATE_DATE)
     VALUES
           (SEQ_T_INSU_INSUTYPE2INSULIST.NEXTVAL
           ,#{s_employeeId}
           ,#{s_employeeId}       
           ,0
           ,#{insu_id}
           ,#{intp_id}
           ,#{type} 
           ,SYSDATE)
		</insert>
		<!-- 保存保单与设备中间表 -->
		<insert id="createInsueqmt2InsuList" parameterType="map">
		INSERT INTO T_INSU_INSULIST2EMPT
		  (ID,
		   CREATE_ID,
		   CREATE_DATE,
		   STATUS,
		   EQMT_ID,
		   INSU_ID,
		   TYPE
		   <if test="RATE != null and RATE != ''">,RATE</if>
		   <if test="ESTIMATED_PREMIUMS != null and ESTIMATED_PREMIUMS != ''">,ESTIMATED_PREMIUMS</if>
		   )
     VALUES
           (SEQ_T_INSU_INSULIST2EMPT.NEXTVAL
           ,#{s_employeeId}
           ,SYSDATE
     	   ,0
           ,#{EQMT_ID}
           ,#{insu_id}
           ,#{type}
            <if test="RATE != null and RATE != ''">,#{RATE}</if>
            <if test="ESTIMATED_PREMIUMS != null and ESTIMATED_PREMIUMS != ''">,#{ESTIMATED_PREMIUMS}</if>
           )
		</insert>
		<select id="getmanager" parameterType="Map" resultType="Map">
				SELECT * FROM (SELECT  CC.*,ROWNUM ROWNO FROM (
						 SELECT I1.INCU_ID,
							       FCC.NAME          CUST_NAME,
							       C.LEASE_CODE,
							       E.PAYLIST_CODE,
							       TSDD.FLAG		 PLATFORM_TYPE,
							       TSC.COMPANY_NAME  COMPANY_NAME,
							       TSS.SUP_SHORTNAME SUPPLIERS_NAME,
							       E.ENGINE_TYPE,
							       E.CAR_SYMBOL,
							       E.SPEC_NAME,
							       E.PRODUCT_NAME,
							       CASE WHEN I1.STATUS=0 THEN '在保' ELSE '退保' END STATUS,
							       I1.INSU_PRICE
							  FROM T_INSU_INSURANCELIST  I1,
							       FIL_PROJECT_EQUIPMENT E,
							       T_INSU_INSULIST2EMPT  I2,
							       FIL_PROJECT_HEAD      C,
							       FIL_CUST_CLIENT       FCC,
							       T_SYS_COMPANY         TSC,
							       T_SYS_SUPPLIERS       TSS,
								   (SELECT *
									  FROM T_SYS_SITE_DICTIONARY
									 WHERE STATUS = 0
									   AND TYPE = '业务类型') TSDD
							 WHERE I1.INCU_ID(+) = I2.INSU_ID
							   AND E.ID(+) = I2.EQMT_ID
							   AND C.ID = E.PROJECT_ID
							   AND C.CLIENT_ID = FCC.ID
							   AND I1.STATUS != 1
							   AND E.COMPANY_ID = TSC.COMPANY_ID(+)
							   AND E.SUPPLIERS_ID = TSS.SUP_ID(+)
							   AND C.PLATFORM_TYPE=TSDD.CODE
		                 ORDER BY I1.INCU_ID DESC
			) CC  
			<where>
				<if test="COMPANY_NAME !=null and COMPANY_NAME !=''">AND CC.COMPANY_NAME =#{COMPANY_NAME}</if>
				<if test="content != null and content != ''">
			<![CDATA[
				 and (CC.INCP_NAME LIKE '%'||#{content}||'%' 
				 	OR CC.INCU_CODE LIKE '%'||#{content}||'%' 
				 	OR CC.INSU_PRICE LIKE '%'||#{content}||'%' 
				 	OR CC.CHARGE_CODE LIKE '%'||#{content}||'%' 
				 	OR CC.TO_INSU_NAME LIKE '%'||#{content}||'%' 
				 	OR CC.INSU_NAME LIKE '%'||#{content}||'%'
				 	OR CC.RECT_CODE LIKE '%'||#{content}||'%'
				 	OR CC.CUST_NAME LIKE '%'||#{content}||'%'  
				 	OR CC.PAYLIST_CODE LIKE '%'||#{content}||'%'  
				 	)
			  ]]>
		</if>
			</where>
		) CCC  WHERE CCC.ROWNO BETWEEN #{PAGE_BEGIN} AND #{PAGE_END}	
		</select>
		<select id="getmanager_count" parameterType="Map" resultType="int">
				SELECT COUNT(*) FROM (
					SELECT I1.INCU_ID,
							       FCC.NAME          CUST_NAME,
							       C.LEASE_CODE,
							       E.PAYLIST_CODE,
							       C.PLATFORM_TYPE,
							       TSC.COMPANY_NAME  COMPANY_NAME,
							       TSS.SUP_SHORTNAME SUPPLIERS_NAME,
							       E.ENGINE_TYPE,
							       E.CAR_SYMBOL,
							       I1.STATUS
							  FROM T_INSU_INSURANCELIST  I1,
							       FIL_PROJECT_EQUIPMENT E,
							       T_INSU_INSULIST2EMPT  I2,
							       FIL_PROJECT_HEAD      C,
							       FIL_CUST_CLIENT       FCC,
							       T_SYS_COMPANY         TSC,
							       T_SYS_SUPPLIERS       TSS
							
							 WHERE I1.INCU_ID(+) = I2.INSU_ID
							   AND E.ID(+) = I2.EQMT_ID
							   AND C.ID = E.PROJECT_ID
							   AND C.CLIENT_ID = FCC.ID
							   AND I1.STATUS != 1
							   AND E.COMPANY_ID = TSC.COMPANY_ID(+)
							   AND E.SUPPLIERS_ID = TSS.SUP_ID(+)
		                 ORDER BY I1.INCU_ID DESC
			) CC  
			<where>
				<if test="COMPANY_NAME !=null and COMPANY_NAME !=''">AND CC.COMPANY_NAME =#{COMPANY_NAME}</if>
				<if test="content != null and content != ''">
			<![CDATA[
				 and (CC.INCP_NAME LIKE '%'||#{content}||'%' 
				 	OR CC.INCU_CODE LIKE '%'||#{content}||'%' 
				 	OR CC.INSU_PRICE LIKE '%'||#{content}||'%' 
				 	OR CC.CHARGE_CODE LIKE '%'||#{content}||'%' 
				 	OR CC.TO_INSU_NAME LIKE '%'||#{content}||'%' 
				 	OR CC.INSU_NAME LIKE '%'||#{content}||'%'
				 	OR CC.RECT_CODE LIKE '%'||#{content}||'%'
				 	OR CC.CUST_NAME LIKE '%'||#{content}||'%'  
				 	OR CC.PAYLIST_CODE LIKE '%'||#{content}||'%'  
				 	)
			  ]]>
		</if>
			</where>
				
		</select>
		<delete id="delPolicyeq" parameterType="Map">
			DELETE FROM T_INSU_INSULIST2EMPT WHERE INSU_ID=#{ID}
		</delete>
		<delete id="delPolicyxz" parameterType="Map">
			DELETE FROM T_INSU_INSUTYPE2INSULIST WHERE INSU_ID=#{ID}
		</delete>
		<delete id="delPolicy" parameterType="Map">
			DELETE FROM T_INSU_INSURANCELIST WHERE INCU_ID=#{ID}
		</delete>
		<select id="getPolicy" parameterType="Map" resultType="Map">
			SELECT TII.CREATE_ID,
			       TII.MODIFY_ID,
			       TII.CREATE_DATE,
			       TII.MODIFY_DATE,
			       TII.STATUS,
			       TII.TYPE,
			       TII.INCU_ID,
			       TII.INCU_CODE,
			       TII.INCP_ID,
			       TII.INSU_NAME,
			       TII.INSU_ADDRESS,
			       TII.MORTGAGE,
			       TII.INSU_CERTIFICATE,
			       TII.TO_INSU_NAME,
			       TII.TO_INSU_ADDRESS,
			       TII.INSU_PRICE_TOTAL,
			       TII.INSU_PRICE,
			       to_char(TII.INSU_START_DATE, 'yyyy-mm-dd') INSU_START_DATE,
			       to_char(TII.INSU_END_DATE, 'yyyy-mm-dd') INSU_END_DATE,
			       TII.INSU_RATE,
			       TII.COEFFICIENT,
			       TII.REMARK,
			       TII.RESOLVE_STYLE,
			       TII.CHARGE_CODE,
			       TII.AFFIRM_SEIZE_DATE,
			       TII.AFFIRM_INSU_DATE,
			       TII.PRINT_INSU_DATE,
			       TII.RENEWAL_INSU_CODE,
			       TII.ENTER_NAME,
			       TII.MONEY_KIND,
			       TII.EMS_CODE,
			       TII.OUTPUT_STATUS,
			       TII.OUTPUT_DATE,
			       TII.TO_INSU_CERTIFICATE,
			       TII.RECT_CODE,
			       TII.GENERATION,
			       TII.BXNX,
			       TII.RENEWALMODE,
			       TII.ISRENEWAL,
			       TII.FPE_ID,
			       TIC.COMPANY_NAME,
			       T.INSURE_NAME,
			       TIC.CONTACT_NUM,
			       TIC.COMPANY_ADDR,
			       TII.INSU_PRICE_REBATE,
		           TII.INSU_BALANCE,
		           LX.FLAG INSU_BALANCE_REMARK
			  FROM T_INSU_INSURANCELIST TII,
			       (SELECT T1.INSU_ID, T2.INSURE_NAME
			          FROM T_INSU_INSUTYPE2INSULIST T1
			         RIGHT JOIN T_INSURE_DETAIL T2
			            ON T2.ID = T1.INTP_ID) T,
			       T_INSURE_COMPANY TIC,
		             (SELECT *
					          FROM T_SYS_DATA_DICTIONARY
					         WHERE STATUS = 0
					           AND TYPE = '保费差异原因'
					         ORDER BY LEVEL_NUM, DATA_ID, CODE) LX
			 WHERE TII.INCU_ID = T.INSU_ID
			   AND TII.INCP_ID = TIC.ID
			   AND TII.INSU_BALANCE_REMARK=LX.CODE(+)
			   AND TII.INCU_ID = #{ID}
		</select>
		<update id="updInsuList" parameterType="Map">
			UPDATE T_INSU_INSURANCELIST SET INCU_ID=#{ID}
           <if test="s_employeeId!=null and s_employeeId!=''">,CREATE_ID=#{s_employeeId}</if>
           <if test="INCU_CODE!=null and INCU_CODE!=''">,INCU_CODE=#{INCU_CODE}</if>
           <if test="INCP_ID!=null and INCP_ID!=''">,INCP_ID=#{INCP_ID}</if>
           <if test="INSU_NAME!=null and INSU_NAME!=''">,INSU_NAME=#{INSU_NAME}</if>
           <if test="INSU_ADDRESS!=null and INSU_ADDRESS!=''"> ,INSU_ADDRESS=#{INSU_ADDRESS}</if>
           <if test="MORTGAGE!=null and MORTGAGE!=''"> ,MORTGAGE=#{MORTGAGE}</if>
           <if test="INSU_CERTIFICATE!=null and INSU_CERTIFICATE!=''">,INSU_CERTIFICATE=#{INSU_CERTIFICATE}</if>
           <if test="TO_INSU_NAME!=null and TO_INSU_NAME!=''">,TO_INSU_NAME=#{TO_INSU_NAME} </if>
           <if test="TO_INSU_ADDRESS!=null and TO_INSU_ADDRESS!=''">,TO_INSU_ADDRESS=#{TO_INSU_ADDRESS} </if>
           <if test="INSU_PRICE_TOTAL!=null and INSU_PRICE_TOTAL!=''">,INSU_PRICE_TOTAL=#{INSU_PRICE_TOTAL}</if>
           <if test="INSU_PRICE!=null and INSU_PRICE!=''">,INSU_PRICE=#{INSU_PRICE}</if>
           <if test="INSU_BALANCE !=null and INSU_BALANCE !=''">,INSU_BALANCE=#{INSU_BALANCE}</if>
           <if test="INSU_BALANCE_REMARK !=null and INSU_BALANCE_REMARK !=''">,INSU_BALANCE_REMARK=#{INSU_BALANCE_REMARK}</if>
           <if test="INSU_PRICE_REBATE!=null and INSU_PRICE_REBATE!=''">,INSU_PRICE_REBATE=#{INSU_PRICE_REBATE}</if>
           <if test="INSU_START_DATE!=null and INSU_START_DATE!=''">,INSU_START_DATE=TO_DATE(#{INSU_START_DATE},'YYYY-MM-DD')</if>
           <if test="INSU_END_DATE!=null and INSU_END_DATE!=''">,INSU_END_DATE=TO_DATE(#{INSU_END_DATE},'YYYY-MM-DD')</if>
           <if test="INSU_RATE!=null and INSU_RATE!=''">,INSU_RATE=#{INSU_RATE}</if>
           <if test="COEFFICIENT!=null and COEFFICIENT!=''">,COEFFICIENT=#{COEFFICIENT}</if>
           <if test="REMARK!=null and REMARK!=''">,REMARK=#{REMARK}</if>
           <if test="CHARGE_CODE!=null and CHARGE_CODE!=''">,CHARGE_CODE=#{CHARGE_CODE} </if>
          <if test="AFFIRM_SEIZE_DATE!=null and AFFIRM_SEIZE_DATE!=''"> ,AFFIRM_SEIZE_DATE=TO_DATE(#{AFFIRM_SEIZE_DATE},'YYYY-MM-DD')</if>
           <if test="AFFIRM_INSU_DATE!=null and AFFIRM_INSU_DATE!=''">,AFFIRM_INSU_DATE=TO_DATE(#{AFFIRM_INSU_DATE},'YYYY-MM-DD')</if>
          <if test="PRINT_INSU_DATE!=null and PRINT_INSU_DATE!=''"> ,PRINT_INSU_DATE=TO_DATE(#{PRINT_INSU_DATE},'YYYY-MM-DD')</if>
           <if test="TO_INSU_CERTIFICATE!=null and TO_INSU_CERTIFICATE!=''">,TO_INSU_CERTIFICATE=#{TO_INSU_CERTIFICATE}</if>
           <if test="EQMT_ID !=null and EQMT_ID !=''">,FPE_ID=#{EQMT_ID}</if>
           WHERE INCU_ID=#{ID}
		</update>
		<select id="getCodeCount" parameterType="Map" resultType="int">
			SELECT COUNT(*) FROM T_INSU_INSURANCELIST WHERE INCP_ID=#{INCP_ID} AND INCU_CODE=#{INCU_CODE}
		</select>
		<select id="getInsurancePolicy" parameterType="Map" resultType="Map">
			SELECT TII.INCU_ID,
				   TII.INCU_CODE,
			       TID.INSURE_NAME,
			       to_char(TII.INSU_START_DATE,'yyyy-MM-dd') INSU_START_DATE,
			       to_char(TII.INSU_END_DATE,'yyyy-MM-dd') INSU_END_DATE,
			       TII.INSU_PRICE
			  FROM T_INSU_INSURANCELIST     TII,
			       T_INSU_INSUTYPE2INSULIST TII2,
			       T_INSURE_DETAIL          TID
			 WHERE TII.INCU_ID = TII2.INSU_ID
			   AND TII2.INTP_ID = TID.ID
			   AND TII.FPE_ID=#{ID}
		</select>
		<select id="getRenewal" parameterType="Map" resultType="Map">
				SELECT * FROM (SELECT  CC.*,ROWNUM ROWNO FROM (
						SELECT T1.INCU_ID,
		                        T2.COMPANY_NAME,
		                        T1.INCU_CODE,
		                        T1.INCP_ID,
		                        T1.INSU_NAME,
		                        T1.INSU_ADDRESS,
		                        T1.MORTGAGE,
		                        T1.INSU_CERTIFICATE,
		                        T1.TO_INSU_NAME,
		                        T1.TO_INSU_ADDRESS,
		                        T1.INSU_PRICE_TOTAL,
		                        T1.INSU_PRICE,
		                        TO_CHAR(T1.INSU_START_DATE, 'YYYY-MM-DD') INSU_START_DATE,
		                        TO_CHAR(T1.INSU_END_DATE, 'YYYY-MM-DD') INSU_END_DATE,
		                        T1.INSU_RATE,
		                        T1.COEFFICIENT,
		                        T1.REMARK,
		                        T1.CHARGE_CODE,
		                        T1.AFFIRM_SEIZE_DATE,
		                        T1.AFFIRM_INSU_DATE,
		                        T1.PRINT_INSU_DATE,
		                        T1.RENEWAL_INSU_CODE,
		                        T1.ENTER_NAME,
		                        T1.MONEY_KIND,
		                        T1.EMS_CODE,
		                        T1.OUTPUT_STATUS,
		                        T1.OUTPUT_DATE,
		                        T1.TO_INSU_CERTIFICATE,
		                        CASE T1.STATUS WHEN 0 THEN '在保' 
		                        ELSE '退保'
		                        END STATUS,
		                        TT.CUST_NAME,
		                        T12.INSURE_NAME,
		                        TO_CHAR(T5.SURRENDER_DATE, 'YYYY-MM-DD') SURRENDER_DATE,
		                        TO_NUMBER(T5.SURRENDER_PRICE) SURRENDER_PRICE,
		                        REPLACE(TTT.PAYLIST_CODE, ',', '&lt;BR>') PAYLIST_CODE,
		                        REPLACE(TTT.PAYLIST_CODE, ',', ' ') PAYLIST_CODE1
		                  FROM T_INSU_INSURANCELIST T1
		                  LEFT JOIN T_INSURE_COMPANY T2
		                    ON T1.INCP_ID = T2.ID
		                  LEFT JOIN (SELECT I1.INCU_ID, MAX(FCC.NAME) CUST_NAME, C.LEASE_TERM*C.LEASE_PERIOD/12 YEAR
		                               FROM T_INSU_INSURANCELIST I1,
		                                    FIL_PROJECT_EQUIPMENT E,
		                                    T_INSU_INSULIST2EMPT I2,
		                                    FIL_PROJECT_HEAD     C,
		                                    FIL_CUST_CLIENT      FCC
		                              WHERE I1.INCU_ID(+) = I2.INSU_ID
		                                AND E.ID(+) = I2.EQMT_ID
		                                AND C.ID = E.PROJECT_ID
		                                AND C.CLIENT_ID=FCC.ID
		                                AND I1.STATUS != 1
		                              GROUP BY I1.INCU_ID,C.LEASE_TERM,C.LEASE_PERIOD) TT
		                    ON TT.INCU_ID = T1.INCU_ID
		                  LEFT JOIN T_INSU_SURRENDER T5
		                    ON T1.INCU_ID = T5.INCU_ID
		                  LEFT JOIN (SELECT TII.INSU_ID,
		                                    WMSYS.WM_CONCAT(DISTINCT TBP.PAYLIST_CODE) PAYLIST_CODE
		                               FROM T_INSU_INSULIST2EMPT TII,
		                                    FIL_PROJECT_EQUIPMENT        FE,
		                                    FIL_RENT_PLAN_HEAD TBP
		                              WHERE TII.EQMT_ID = FE.ID
		                                AND FE.PAY_ID = TBP.ID
		                              GROUP BY TII.INSU_ID) TTT
		                    ON TTT.INSU_ID = T1.INCU_ID
		                  LEFT JOIN (SELECT T1.INSU_ID, T2.INSURE_NAME
		                               FROM T_INSU_INSUTYPE2INSULIST T1
		                              RIGHT JOIN T_INSURE_DETAIL T2
		                                 ON T2.ID = T1.INTP_ID) T12
		                    ON T1.INCU_ID = T12.INSU_ID
		                 WHERE T1.STATUS != 1
		                 AND TRUNC(T1.INSU_END_DATE)-TRUNC(SYSDATE) &lt;= ${XBTS}
		                 AND TT.YEAR >T1.GENERATION
		                 AND T1.ISRENEWAL=0
		                 ORDER BY T1.INCU_ID DESC
			) CC  
			<where>
				<if test="COMPANY_NAME !=null and COMPANY_NAME !=''">AND CC.COMPANY_NAME =#{COMPANY_NAME}</if>
				<if test="content != null and content != ''">
			<![CDATA[
				 and (CC.INCP_NAME LIKE '%'||#{content}||'%' 
				 	OR CC.INCU_CODE LIKE '%'||#{content}||'%' 
				 	OR CC.INSU_PRICE LIKE '%'||#{content}||'%' 
				 	OR CC.CHARGE_CODE LIKE '%'||#{content}||'%' 
				 	OR CC.TO_INSU_NAME LIKE '%'||#{content}||'%' 
				 	OR CC.INSU_NAME LIKE '%'||#{content}||'%'
				 	OR CC.RECT_CODE LIKE '%'||#{content}||'%'
				 	OR CC.CUST_NAME LIKE '%'||#{content}||'%'  
				 	OR CC.PAYLIST_CODE LIKE '%'||#{content}||'%'  
				 	)
			  ]]>
		</if>
			</where>
			ORDER BY CC.INSU_START_DATE
		) CCC  WHERE CCC.ROWNO BETWEEN #{PAGE_BEGIN} AND #{PAGE_END}	
		</select>
		<select id="getRenewal_count" parameterType="Map" resultType="int">
				SELECT COUNT(*) FROM (
					SELECT T1.INCU_ID,
		                        T2.COMPANY_NAME,
		                        T1.INCU_CODE,
		                        T1.INCP_ID,
		                        T1.INSU_NAME,
		                        T1.INSU_ADDRESS,
		                        T1.MORTGAGE,
		                        T1.INSU_CERTIFICATE,
		                        T1.TO_INSU_NAME,
		                        T1.TO_INSU_ADDRESS,
		                        T1.INSU_PRICE_TOTAL,
		                        T1.INSU_PRICE,
		                        TO_CHAR(T1.INSU_START_DATE, 'YYYY-MM-DD') INSU_START_DATE,
		                        TO_CHAR(T1.INSU_END_DATE, 'YYYY-MM-DD') INSU_END_DATE,
		                        T1.INSU_RATE,
		                        T1.COEFFICIENT,
		                        T1.REMARK,
		                        T1.CHARGE_CODE,
		                        T1.AFFIRM_SEIZE_DATE,
		                        T1.AFFIRM_INSU_DATE,
		                        T1.PRINT_INSU_DATE,
		                        T1.RENEWAL_INSU_CODE,
		                        T1.ENTER_NAME,
		                        T1.MONEY_KIND,
		                        T1.EMS_CODE,
		                        T1.OUTPUT_STATUS,
		                        T1.OUTPUT_DATE,
		                        T1.TO_INSU_CERTIFICATE,
		                        T1.STATUS,
		                        TT.CUST_NAME,
		                        T12.INSURE_NAME,
		                        TO_CHAR(T5.SURRENDER_DATE, 'YYYY-MM-DD') SURRENDER_DATE,
		                        TO_NUMBER(T5.SURRENDER_PRICE) SURRENDER_PRICE,
		                        REPLACE(TTT.PAYLIST_CODE, ',', '&lt;BR>') PAYLIST_CODE,
		                        REPLACE(TTT.PAYLIST_CODE, ',', ' ') PAYLIST_CODE1
		                  FROM T_INSU_INSURANCELIST T1
		                  LEFT JOIN T_INSURE_COMPANY T2
		                    ON T1.INCP_ID = T2.ID
		                  LEFT JOIN (SELECT I1.INCU_ID, MAX(FCC.NAME) CUST_NAME, C.LEASE_TERM*C.LEASE_PERIOD/12 YEAR
		                               FROM T_INSU_INSURANCELIST I1,
		                                    FIL_PROJECT_EQUIPMENT E,
		                                    T_INSU_INSULIST2EMPT I2,
		                                    FIL_PROJECT_HEAD     C,
		                                    FIL_CUST_CLIENT      FCC
		                              WHERE I1.INCU_ID(+) = I2.INSU_ID
		                                AND E.ID(+) = I2.EQMT_ID
		                                AND C.ID = E.PROJECT_ID
		                                AND C.CLIENT_ID=FCC.ID
		                                AND I1.STATUS != 1
		                              GROUP BY I1.INCU_ID,C.LEASE_TERM,C.LEASE_PERIOD) TT
		                    ON TT.INCU_ID = T1.INCU_ID
		                  LEFT JOIN T_INSU_SURRENDER T5
		                    ON T1.INCU_ID = T5.INCU_ID
		                  LEFT JOIN (SELECT TII.INSU_ID,
		                                    WMSYS.WM_CONCAT(DISTINCT TBP.PAYLIST_CODE) PAYLIST_CODE
		                               FROM T_INSU_INSULIST2EMPT TII,
		                                    FIL_PROJECT_EQUIPMENT        FE,
		                                    FIL_RENT_PLAN_HEAD TBP
		                              WHERE TII.EQMT_ID = FE.ID
		                                AND FE.PAY_ID = TBP.ID
		                              GROUP BY TII.INSU_ID) TTT
		                    ON TTT.INSU_ID = T1.INCU_ID
		                  LEFT JOIN (SELECT T1.INSU_ID, T2.INSURE_NAME
		                               FROM T_INSU_INSUTYPE2INSULIST T1
		                              RIGHT JOIN T_INSURE_DETAIL T2
		                                 ON T2.ID = T1.INTP_ID) T12
		                    ON T1.INCU_ID = T12.INSU_ID
		                 WHERE T1.STATUS != 1
		                 AND TRUNC(T1.INSU_END_DATE)-TRUNC(SYSDATE) &lt;=  ${XBTS}
		                 AND TT.YEAR >T1.GENERATION
		                 AND T1.ISRENEWAL=0
		                 ORDER BY T1.INCU_ID DESC
			) CC  
			<where>
				<if test="COMPANY_NAME !=null and COMPANY_NAME !=''">AND CC.COMPANY_NAME =#{COMPANY_NAME}</if>
				<if test="content != null and content != ''">
			<![CDATA[
				 and (CC.INCP_NAME LIKE '%'||#{content}||'%' 
				 	OR CC.INCU_CODE LIKE '%'||#{content}||'%' 
				 	OR CC.INSU_PRICE LIKE '%'||#{content}||'%' 
				 	OR CC.CHARGE_CODE LIKE '%'||#{content}||'%' 
				 	OR CC.TO_INSU_NAME LIKE '%'||#{content}||'%' 
				 	OR CC.INSU_NAME LIKE '%'||#{content}||'%'
				 	OR CC.RECT_CODE LIKE '%'||#{content}||'%'
				 	OR CC.CUST_NAME LIKE '%'||#{content}||'%'  
				 	OR CC.PAYLIST_CODE LIKE '%'||#{content}||'%'  
				 	)
			  ]]>
		</if>
			</where>
			ORDER BY CC.INSU_START_DATE
				
		</select>
	<update id="upISRENEWAL" parameterType="map">
		update T_INSU_INSURANCELIST set ISRENEWAL=1
		where INCU_ID=#{INCU_ID}
	</update>
	<update id="updGENERATION" parameterType="map">
		update T_INSU_INSURANCELIST set GENERATION=#{GENERATION}
		<if test="BXNX !=null and BXNX!=''">,BXNX=#{BXNX}</if>
		<if test="RENEWALMODE !=null and RENEWALMODE!=''">,RENEWALMODE=#{RENEWALMODE}</if>
		where INCU_ID=#{INCU_ID}
	</update>
	<select id="getInsureINSULIST" parameterType="map" resultType="map">
		SELECT * FROM T_INSU_INSUTYPE2INSULIST WHERE INSU_ID=#{ID}
	</select>
	<select id="getInsureEMPT" parameterType="map" resultType="map">
		SELECT * FROM T_INSU_INSULIST2EMPT WHERE INSU_ID=#{ID}
	</select>
	<!-- 查询有效保单数 added by xingzhili -->
	<select id="selectValidPolicyAmt" parameterType="map" resultType="int">
		<![CDATA[
		SELECT count(FPE_ID)
			  FROM T_INSU_INSURANCELIST TII
			 WHERE TII.INSU_END_DATE >= sysdate
			   AND TII.FPE_ID=#{ID}
		]]>
	</select>
</mapper>